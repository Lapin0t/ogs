<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" class="alectryon-standalone" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.21.2: https://docutils.sourceforge.io/" />
<title>Interaction Trees: Theory of the structure</title>
<link rel="stylesheet" href="alectryon.css" type="text/css" />
<link rel="stylesheet" href="docutils_basic.css" type="text/css" />
<link rel="stylesheet" href="pygments.css" type="text/css" />
<script type="text/javascript" src="alectryon.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/IBM-type/0.5.4/css/ibm-type.min.css" integrity="sha512-sky5cf9Ts6FY1kstGOBHSybfKqdHR41M0Ldb0BjNiv3ifltoQIsg0zIaQ+wwdwgQ0w9vKFW7Js50lxH9vqNSSw==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/firacode/5.2.0/fira_code.min.css" integrity="sha512-MbysAYimH1hH2xYzkkMHB6MqxBqfP0megxsCLknbYqHVwXTCg9IqHbk+ZP/vnhO8UEW6PaXAkKe2vQ+SWACxxA==" crossorigin="anonymous" />
<meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
<div class="alectryon-root alectryon-windowed"><div class="alectryon-banner">Built with <a href="https://github.com/cpitclaudel/alectryon/">Alectryon</a>, running Coq+SerAPI v8.17.0+0.17.3. Bubbles (<span class="alectryon-bubble"></span>) indicate interactive fragments: hover for details, tap to reveal contents. Use <kbd>Ctrl+‚Üë</kbd> <kbd>Ctrl+‚Üì</kbd> to navigate, <kbd>Ctrl+üñ±Ô∏è</kbd> to focus. On Mac, use <kbd>‚åò</kbd> instead of <kbd>Ctrl</kbd>.</div><div class="document" id="interaction-trees-theory-of-the-structure">
<h1 class="title">Interaction Trees: Theory of the structure</h1>

<p>We collect in these file the main lemmas capturing the applicative,
monadic, and (unguarded) iteration structure of itrees.</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Section</span> <span class="nf">withE</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Context</span> {<span class="nv">I</span>} {<span class="nv">E</span> : event I I}.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk0" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk0"><span class="kn">Lemma</span> <span class="nf">skip_tau</span> {<span class="nv">X</span> <span class="nv">i</span>} (<span class="nv">t</span> : itree E X i) : Tau&#39; t ‚âà t .</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Tau&#39; t ‚âà t</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk1" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk1"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Tau&#39; t ‚âà t</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk2" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk2"><span class="nb">eapply</span> (gfp_fp (it_wbisim_map E (eq·µ¢ _))); <span class="nb">econstructor</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eat i (observe (Tau&#39; t)) <span class="nl">?x1</span></div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="properties-v-chk3" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br></div><label class="goal-separator" for="properties-v-chk3"><hr></label><div class="goal-conclusion">it_eat i (observe t) <span class="nl">?x2</span></div></blockquote><input class="alectryon-extra-goal-toggle" id="properties-v-chk4" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br></div><label class="goal-separator" for="properties-v-chk4"><hr></label><div class="goal-conclusion">it_eqF E (eq·µ¢ X) (gfp (it_wbisim_map E (eq·µ¢ X))) i 
  <span class="nl">?x1</span> <span class="nl">?x2</span></div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk5" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk5">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eat i (observe (Tau&#39; t)) <span class="nl">?x1</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span> EatStep, EatRefl.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk6" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk6">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eat i (observe t) <span class="nl">?x2</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span> EatRefl.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk7" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk7">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eqF E (eq·µ¢ X) (gfp (it_wbisim_map E (eq·µ¢ X))) i
  (observe t) (observe t)</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">destruct</span> (observe t); <span class="bp">now</span> <span class="nb">econstructor</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><p><tt class="docutils literal">fmap</tt> respects strong bisimilarity.</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk8" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk8">#[<span class="kn">global</span>] <span class="kn">Instance</span> <span class="nf">fmap_eq</span> {<span class="nv">X</span> <span class="nv">RX</span> <span class="nv">Y</span> <span class="nv">RY</span>} :
    Proper (dpointwise_relation (<span class="kr">fun</span> <span class="nv">i</span> =&gt; RX i ==&gt; RY i)
              ==&gt; dpointwise_relation (<span class="kr">fun</span> <span class="nv">i</span> =&gt; it_eq RX (i:=i) ==&gt; it_eq RY (i:=i)))
      (@fmap I E X Y).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Proper
  (dpointwise_relation (<span class="kr">fun</span> <span class="nv">i</span> : I =&gt; RX i ==&gt; RY i) ==&gt;
   dpointwise_relation
     (<span class="kr">fun</span> <span class="nv">i</span> : I =&gt; it_eq RX (i:=i) ==&gt; it_eq RY (i:=i)))
  fmap</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk9" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk9"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Proper
  (dpointwise_relation (<span class="kr">fun</span> <span class="nv">i</span> : I =&gt; RX i ==&gt; RY i) ==&gt;
   dpointwise_relation
     (<span class="kr">fun</span> <span class="nv">i</span> : I =&gt; it_eq RX (i:=i) ==&gt; it_eq RY (i:=i)))
  fmap</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chka" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chka"><span class="nb">intros</span> f g H1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>dpointwise_relation
  (<span class="kr">fun</span> <span class="nv">i</span> : I =&gt; (RX i ==&gt; RY i)%signature) f g</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">dpointwise_relation
  (<span class="kr">fun</span> <span class="nv">i</span> : I =&gt;
   (it_eq RX (i:=i) ==&gt; it_eq RY (i:=i))%signature)
  (fmap f) (fmap g)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkb" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkb"><span class="nb">unfold</span> respectful, dpointwise_relation, it_eq.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>dpointwise_relation
  (<span class="kr">fun</span> <span class="nv">i</span> : I =&gt; (RX i ==&gt; RY i)%signature) f g</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_eq_map E RX) a x y -&gt;
gfp (it_eq_map E RY) a (f &lt;$&gt; x) (g &lt;$&gt; y)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkc" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkc">coinduction R CIH; <span class="nb">intros</span> i x y h.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>dpointwise_relation
  (<span class="kr">fun</span> <span class="nv">i</span> : I =&gt; (RX i ==&gt; RY i)%signature) f g</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_eq_map E RX) a x y -&gt; it_eq_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>gfp (it_eq_map E RX) i x y</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eq_bt E RY R i (f &lt;$&gt; x) (g &lt;$&gt; y)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkd" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkd"><span class="nb">apply</span> (gfp_fp (it_eq_map E RX)) <span class="kr">in</span> h.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>dpointwise_relation
  (<span class="kr">fun</span> <span class="nv">i</span> : I =&gt; (RX i ==&gt; RY i)%signature) f g</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_eq_map E RX) a x y -&gt; it_eq_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>it_eq_map E RX (gfp (it_eq_map E RX)) i x y</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eq_bt E RY R i (f &lt;$&gt; x) (g &lt;$&gt; y)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chke" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chke"><span class="nb">cbn</span> <span class="kr">in</span> *; <span class="nb">cbv</span> [observe] <span class="kr">in</span> h; <span class="nb">dependent destruction</span> h; simpl_depind; <span class="nb">eauto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I,
(RX a ==&gt; RY a)%signature (f a) (g a)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_eq_map E RX) a x y -&gt; it_eq_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r1, r2</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br><span><var>r_rel</var><span class="hyp-type"><b>: </b><span>RX i r1 r2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eqF E RY (it_eq_t E RY R) i (RetF (f i r1))
  (RetF (g i r2))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">econstructor</span>; <span class="bp">now</span> <span class="nb">apply</span> H1.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><p><tt class="docutils literal">fmap</tt> respects weak bisimilarity.</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkf" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkf">#[<span class="kn">global</span>] <span class="kn">Instance</span> <span class="nf">fmap_weq</span> {<span class="nv">X</span> <span class="nv">RX</span> <span class="nv">Y</span> <span class="nv">RY</span>} :
    Proper (dpointwise_relation (<span class="kr">fun</span> <span class="nv">i</span> =&gt; RX i ==&gt; RY i)
              ==&gt; dpointwise_relation (<span class="kr">fun</span> <span class="nv">i</span> =&gt; it_wbisim RX i ==&gt; it_wbisim RY i))
      (@fmap I E X Y).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Proper
  (dpointwise_relation (<span class="kr">fun</span> <span class="nv">i</span> : I =&gt; RX i ==&gt; RY i) ==&gt;
   dpointwise_relation
     (<span class="kr">fun</span> <span class="nv">i</span> : I =&gt; it_wbisim RX i ==&gt; it_wbisim RY i))
  fmap</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk10" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk10"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Proper
  (dpointwise_relation (<span class="kr">fun</span> <span class="nv">i</span> : I =&gt; RX i ==&gt; RY i) ==&gt;
   dpointwise_relation
     (<span class="kr">fun</span> <span class="nv">i</span> : I =&gt; it_wbisim RX i ==&gt; it_wbisim RY i))
  fmap</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk11" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk11"><span class="nb">intros</span> f g H1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>dpointwise_relation
  (<span class="kr">fun</span> <span class="nv">i</span> : I =&gt; (RX i ==&gt; RY i)%signature) f g</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">dpointwise_relation
  (<span class="kr">fun</span> <span class="nv">i</span> : I =&gt;
   (it_wbisim RX i ==&gt; it_wbisim RY i)%signature)
  (fmap f) (fmap g)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk12" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk12"><span class="nb">unfold</span> respectful, dpointwise_relation, it_wbisim.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>dpointwise_relation
  (<span class="kr">fun</span> <span class="nv">i</span> : I =&gt; (RX i ==&gt; RY i)%signature) f g</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt;
gfp (it_wbisim_map E RY) a (f &lt;$&gt; x) (g &lt;$&gt; y)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk13" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk13">coinduction R CIH; <span class="nb">intros</span> i x y h.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>dpointwise_relation
  (<span class="kr">fun</span> <span class="nv">i</span> : I =&gt; (RX i ==&gt; RY i)%signature) f g</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt; it_wbisim_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>gfp (it_wbisim_map E RX) i x y</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_wbisim_bt E RY R i (f &lt;$&gt; x) (g &lt;$&gt; y)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk14" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk14"><span class="nb">apply</span> (gfp_fp (it_wbisim_map E RX)) <span class="kr">in</span> h.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>dpointwise_relation
  (<span class="kr">fun</span> <span class="nv">i</span> : I =&gt; (RX i ==&gt; RY i)%signature) f g</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt; it_wbisim_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>it_wbisim_map E RX (gfp (it_wbisim_map E RX)) i x
  y</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_wbisim_bt E RY R i (f &lt;$&gt; x) (g &lt;$&gt; y)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk15" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk15"><span class="nb">cbn</span> <span class="kr">in</span> *; <span class="nb">cbv</span> [observe] <span class="kr">in</span> h.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I,
(RX a ==&gt; RY a)%signature (f a) (g a)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt; it_wbisim_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>h</var><span class="hyp-type"><b>: </b><span>it_wbisimF E RX (gfp (it_wbisim_map E RX)) i
  (_observe x) (_observe y)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_wbisimF E RY (it_wbisim_t E RY R) i
  <span class="kr">match</span> _observe x <span class="kr">with</span>
  | RetF r =&gt; RetF (f i r)
  | TauF t =&gt; TauF (f &lt;$&gt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; f &lt;$&gt; k r)
  <span class="kr">end</span>
  <span class="kr">match</span> _observe y <span class="kr">with</span>
  | RetF r =&gt; RetF (g i r)
  | TauF t =&gt; TauF (g &lt;$&gt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; g &lt;$&gt; k r)
  <span class="kr">end</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk16" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk16"><span class="nb">destruct</span> h.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I,
(RX a ==&gt; RY a)%signature (f a) (g a)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt; it_wbisim_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>x1, x2</var><span class="hyp-type"><b>: </b><span>itree&#39; E X i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe x) x1</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe y) x2</span></span></span><br><span><var>rr</var><span class="hyp-type"><b>: </b><span>it_eqF E RX (gfp (it_wbisim_map E RX)) i x1 x2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_wbisimF E RY (it_wbisim_t E RY R) i
  <span class="kr">match</span> _observe x <span class="kr">with</span>
  | RetF r =&gt; RetF (f i r)
  | TauF t =&gt; TauF (f &lt;$&gt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; f &lt;$&gt; k r)
  <span class="kr">end</span>
  <span class="kr">match</span> _observe y <span class="kr">with</span>
  | RetF r =&gt; RetF (g i r)
  | TauF t =&gt; TauF (g &lt;$&gt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; g &lt;$&gt; k r)
  <span class="kr">end</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk17" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk17"><span class="nb">dependent destruction</span> rr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I,
(RX a ==&gt; RY a)%signature (f a) (g a)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt; it_wbisim_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe x) (RetF r0)</span></span></span><br><span><var>r3</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe y) (RetF r3)</span></span></span><br><span><var>r_rel</var><span class="hyp-type"><b>: </b><span>RX i r0 r3</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_wbisimF E RY (it_wbisim_t E RY R) i
  <span class="kr">match</span> _observe x <span class="kr">with</span>
  | RetF r =&gt; RetF (f i r)
  | TauF t =&gt; TauF (f &lt;$&gt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; f &lt;$&gt; k r)
  <span class="kr">end</span>
  <span class="kr">match</span> _observe y <span class="kr">with</span>
  | RetF r =&gt; RetF (g i r)
  | TauF t =&gt; TauF (g &lt;$&gt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; g &lt;$&gt; k r)
  <span class="kr">end</span></div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="properties-v-chk18" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I,
(RX a ==&gt; RY a)%signature (f a) (g a)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt;
it_wbisim_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y, t1</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe x) (TauF t1)</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe y) (TauF t2)</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>gfp (it_wbisim_map E RX) i t1 t2</span></span></span><br></div><label class="goal-separator" for="properties-v-chk18"><hr></label><div class="goal-conclusion">it_wbisimF E RY (it_wbisim_t E RY R) i
  <span class="kr">match</span> _observe x <span class="kr">with</span>
  | RetF r =&gt; RetF (f i r)
  | TauF t =&gt; TauF (f &lt;$&gt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; f &lt;$&gt; k r)
  <span class="kr">end</span>
  <span class="kr">match</span> _observe y <span class="kr">with</span>
  | RetF r =&gt; RetF (g i r)
  | TauF t =&gt; TauF (g &lt;$&gt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; g &lt;$&gt; k r)
  <span class="kr">end</span></div></blockquote><input class="alectryon-extra-goal-toggle" id="properties-v-chk19" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I,
(RX a ==&gt; RY a)%signature (f a) (g a)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt;
it_wbisim_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X (e_nxt x)</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe x) (VisF q k1)</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X (e_nxt x)</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe y) (VisF q k2)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
gfp (it_wbisim_map E RX) 
  (e_nxt r) (k1 r) (k2 r)</span></span></span><br></div><label class="goal-separator" for="properties-v-chk19"><hr></label><div class="goal-conclusion">it_wbisimF E RY (it_wbisim_t E RY R) i
  <span class="kr">match</span> _observe x <span class="kr">with</span>
  | RetF r =&gt; RetF (f i r)
  | TauF t =&gt; TauF (f &lt;$&gt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; f &lt;$&gt; k r)
  <span class="kr">end</span>
  <span class="kr">match</span> _observe y <span class="kr">with</span>
  | RetF r =&gt; RetF (g i r)
  | TauF t =&gt; TauF (g &lt;$&gt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; g &lt;$&gt; k r)
  <span class="kr">end</span></div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk1a" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk1a">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I,
(RX a ==&gt; RY a)%signature (f a) (g a)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt;
it_wbisim_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe x) (RetF r0)</span></span></span><br><span><var>r3</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe y) (RetF r3)</span></span></span><br><span><var>r_rel</var><span class="hyp-type"><b>: </b><span>RX i r0 r3</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_wbisimF E RY (it_wbisim_t E RY R) i
  <span class="kr">match</span> _observe x <span class="kr">with</span>
  | RetF r =&gt; RetF (f i r)
  | TauF t =&gt; TauF (f &lt;$&gt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; f &lt;$&gt; k r)
  <span class="kr">end</span>
  <span class="kr">match</span> _observe y <span class="kr">with</span>
  | RetF r =&gt; RetF (g i r)
  | TauF t =&gt; TauF (g &lt;$&gt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; g &lt;$&gt; k r)
  <span class="kr">end</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk1b" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk1b"><span class="nb">unshelve</span> <span class="nb">econstructor</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I,
(RX a ==&gt; RY a)%signature (f a) (g a)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt;
it_wbisim_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe x) (RetF r0)</span></span></span><br><span><var>r3</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe y) (RetF r3)</span></span></span><br><span><var>r_rel</var><span class="hyp-type"><b>: </b><span>RX i r0 r3</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">itree&#39; E Y i</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="properties-v-chk1c" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I,
(RX a ==&gt; RY a)%signature (f a) (g a)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt;
it_wbisim_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe x) (RetF r0)</span></span></span><br><span><var>r3</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe y) (RetF r3)</span></span></span><br><span><var>r_rel</var><span class="hyp-type"><b>: </b><span>RX i r0 r3</span></span></span><br></div><label class="goal-separator" for="properties-v-chk1c"><hr></label><div class="goal-conclusion">itree&#39; E Y i</div></blockquote><input class="alectryon-extra-goal-toggle" id="properties-v-chk1d" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I,
(RX a ==&gt; RY a)%signature (f a) (g a)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt;
it_wbisim_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe x) (RetF r0)</span></span></span><br><span><var>r3</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe y) (RetF r3)</span></span></span><br><span><var>r_rel</var><span class="hyp-type"><b>: </b><span>RX i r0 r3</span></span></span><br></div><label class="goal-separator" for="properties-v-chk1d"><hr></label><div class="goal-conclusion">it_eat i
  <span class="kr">match</span> _observe x <span class="kr">with</span>
  | RetF r =&gt; RetF (f i r)
  | TauF t =&gt; TauF (f &lt;$&gt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; f &lt;$&gt; k r)
  <span class="kr">end</span> <span class="nl">?x1</span></div></blockquote><input class="alectryon-extra-goal-toggle" id="properties-v-chk1e" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I,
(RX a ==&gt; RY a)%signature (f a) (g a)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt;
it_wbisim_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe x) (RetF r0)</span></span></span><br><span><var>r3</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe y) (RetF r3)</span></span></span><br><span><var>r_rel</var><span class="hyp-type"><b>: </b><span>RX i r0 r3</span></span></span><br></div><label class="goal-separator" for="properties-v-chk1e"><hr></label><div class="goal-conclusion">it_eat i
  <span class="kr">match</span> _observe y <span class="kr">with</span>
  | RetF r =&gt; RetF (g i r)
  | TauF t =&gt; TauF (g &lt;$&gt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; g &lt;$&gt; k r)
  <span class="kr">end</span> <span class="nl">?x2</span></div></blockquote><input class="alectryon-extra-goal-toggle" id="properties-v-chk1f" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I,
(RX a ==&gt; RY a)%signature (f a) (g a)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt;
it_wbisim_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe x) (RetF r0)</span></span></span><br><span><var>r3</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe y) (RetF r3)</span></span></span><br><span><var>r_rel</var><span class="hyp-type"><b>: </b><span>RX i r0 r3</span></span></span><br></div><label class="goal-separator" for="properties-v-chk1f"><hr></label><div class="goal-conclusion">it_eqF E RY (it_wbisim_t E RY R) i <span class="nl">?x1</span> <span class="nl">?x2</span></div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk20" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk20">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I,
(RX a ==&gt; RY a)%signature (f a) (g a)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt;
it_wbisim_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe x) (RetF r0)</span></span></span><br><span><var>r3</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe y) (RetF r3)</span></span></span><br><span><var>r_rel</var><span class="hyp-type"><b>: </b><span>RX i r0 r3</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">itree&#39; E Y i</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">exact</span> (RetF (f i r0)).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk21" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk21">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I,
(RX a ==&gt; RY a)%signature (f a) (g a)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt;
it_wbisim_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe x) (RetF r0)</span></span></span><br><span><var>r3</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe y) (RetF r3)</span></span></span><br><span><var>r_rel</var><span class="hyp-type"><b>: </b><span>RX i r0 r3</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">itree&#39; E Y i</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">exact</span> (RetF (g i r3)).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk22" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk22">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I,
(RX a ==&gt; RY a)%signature (f a) (g a)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt;
it_wbisim_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe x) (RetF r0)</span></span></span><br><span><var>r3</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe y) (RetF r3)</span></span></span><br><span><var>r_rel</var><span class="hyp-type"><b>: </b><span>RX i r0 r3</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eat i
  <span class="kr">match</span> _observe x <span class="kr">with</span>
  | RetF r =&gt; RetF (f i r)
  | TauF t =&gt; TauF (f &lt;$&gt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; f &lt;$&gt; k r)
  <span class="kr">end</span> (RetF (f i r0))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk23" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk23"><span class="nb">clear</span> - r1; <span class="nb">remember</span> (_observe x) <span class="kr">as</span> ot; <span class="nb">clear</span> Heqot x.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br><span><var>ot</var><span class="hyp-type"><b>: </b><span>itree&#39; E X i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i ot (RetF r0)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eat i
  <span class="kr">match</span> ot <span class="kr">with</span>
  | RetF r =&gt; RetF (f i r)
  | TauF t =&gt; TauF (f &lt;$&gt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; f &lt;$&gt; k r)
  <span class="kr">end</span> (RetF (f i r0))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk24" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk24"><span class="nb">dependent induction</span> r1; <span class="nb">econstructor</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (observe t1) (RetF r0)</span></span></span><br><span><var>IHr1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">Y</span> : psh I)
  (<span class="nv">f</span> : <span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a) 
  (<span class="nv">r1</span> : X i),
RetF r0 = RetF r1 -&gt;
it_eat i
  <span class="kr">match</span> observe t1 <span class="kr">with</span>
  | RetF r =&gt; RetF (f i r)
  | TauF t =&gt; TauF (f &lt;$&gt; t)
  | VisF e k =&gt;
      VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; f &lt;$&gt; k r)
  <span class="kr">end</span> (RetF (f i r1))</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eat i (observe (f &lt;$&gt; t1)) (RetF (f i r0))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">exact</span> (IHr1 Y f r0 eq_refl).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk25" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk25">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I,
(RX a ==&gt; RY a)%signature (f a) (g a)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt;
it_wbisim_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe x) (RetF r0)</span></span></span><br><span><var>r3</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe y) (RetF r3)</span></span></span><br><span><var>r_rel</var><span class="hyp-type"><b>: </b><span>RX i r0 r3</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eat i
  <span class="kr">match</span> _observe y <span class="kr">with</span>
  | RetF r =&gt; RetF (g i r)
  | TauF t =&gt; TauF (g &lt;$&gt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; g &lt;$&gt; k r)
  <span class="kr">end</span> (RetF (g i r3))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk26" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk26"><span class="nb">clear</span> - r2; <span class="nb">remember</span> (_observe y) <span class="kr">as</span> ot; <span class="nb">clear</span> Heqot y.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>r3</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br><span><var>ot</var><span class="hyp-type"><b>: </b><span>itree&#39; E X i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i ot (RetF r3)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eat i
  <span class="kr">match</span> ot <span class="kr">with</span>
  | RetF r =&gt; RetF (g i r)
  | TauF t =&gt; TauF (g &lt;$&gt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; g &lt;$&gt; k r)
  <span class="kr">end</span> (RetF (g i r3))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk27" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk27"><span class="nb">dependent induction</span> r2; <span class="nb">econstructor</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r3</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (observe t1) (RetF r3)</span></span></span><br><span><var>IHr2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">Y</span> : psh I)
  (<span class="nv">g</span> : <span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a) 
  (<span class="nv">r4</span> : X i),
RetF r3 = RetF r4 -&gt;
it_eat i
  <span class="kr">match</span> observe t1 <span class="kr">with</span>
  | RetF r =&gt; RetF (g i r)
  | TauF t =&gt; TauF (g &lt;$&gt; t)
  | VisF e k =&gt;
      VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; g &lt;$&gt; k r)
  <span class="kr">end</span> (RetF (g i r4))</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eat i (observe (g &lt;$&gt; t1)) (RetF (g i r3))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">exact</span> (IHr2 Y g r3 eq_refl).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk28" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk28">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I,
(RX a ==&gt; RY a)%signature (f a) (g a)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt;
it_wbisim_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe x) (RetF r0)</span></span></span><br><span><var>r3</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe y) (RetF r3)</span></span></span><br><span><var>r_rel</var><span class="hyp-type"><b>: </b><span>RX i r0 r3</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eqF E RY (it_wbisim_t E RY R) i 
  (RetF (f i r0)) (RetF (g i r3))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk29" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk29"><span class="nb">econstructor</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I,
(RX a ==&gt; RY a)%signature (f a) (g a)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt;
it_wbisim_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe x) (RetF r0)</span></span></span><br><span><var>r3</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe y) (RetF r3)</span></span></span><br><span><var>r_rel</var><span class="hyp-type"><b>: </b><span>RX i r0 r3</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">RY i (f i r0) (g i r3)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">now</span> <span class="nb">apply</span> H1.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk2a" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk2a">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I,
(RX a ==&gt; RY a)%signature (f a) (g a)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt;
it_wbisim_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y, t1</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe x) (TauF t1)</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe y) (TauF t2)</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>gfp (it_wbisim_map E RX) i t1 t2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_wbisimF E RY (it_wbisim_t E RY R) i
  <span class="kr">match</span> _observe x <span class="kr">with</span>
  | RetF r =&gt; RetF (f i r)
  | TauF t =&gt; TauF (f &lt;$&gt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; f &lt;$&gt; k r)
  <span class="kr">end</span>
  <span class="kr">match</span> _observe y <span class="kr">with</span>
  | RetF r =&gt; RetF (g i r)
  | TauF t =&gt; TauF (g &lt;$&gt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; g &lt;$&gt; k r)
  <span class="kr">end</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk2b" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk2b"><span class="nb">unshelve</span> <span class="nb">econstructor</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I,
(RX a ==&gt; RY a)%signature (f a) (g a)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt;
it_wbisim_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y, t1</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe x) (TauF t1)</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe y) (TauF t2)</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>gfp (it_wbisim_map E RX) i t1 t2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">itree&#39; E Y i</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="properties-v-chk2c" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I,
(RX a ==&gt; RY a)%signature (f a) (g a)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt;
it_wbisim_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y, t1</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe x) (TauF t1)</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe y) (TauF t2)</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>gfp (it_wbisim_map E RX) i t1 t2</span></span></span><br></div><label class="goal-separator" for="properties-v-chk2c"><hr></label><div class="goal-conclusion">itree&#39; E Y i</div></blockquote><input class="alectryon-extra-goal-toggle" id="properties-v-chk2d" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I,
(RX a ==&gt; RY a)%signature (f a) (g a)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt;
it_wbisim_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y, t1</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe x) (TauF t1)</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe y) (TauF t2)</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>gfp (it_wbisim_map E RX) i t1 t2</span></span></span><br></div><label class="goal-separator" for="properties-v-chk2d"><hr></label><div class="goal-conclusion">it_eat i
  <span class="kr">match</span> _observe x <span class="kr">with</span>
  | RetF r =&gt; RetF (f i r)
  | TauF t =&gt; TauF (f &lt;$&gt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; f &lt;$&gt; k r)
  <span class="kr">end</span> <span class="nl">?x1</span></div></blockquote><input class="alectryon-extra-goal-toggle" id="properties-v-chk2e" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I,
(RX a ==&gt; RY a)%signature (f a) (g a)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt;
it_wbisim_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y, t1</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe x) (TauF t1)</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe y) (TauF t2)</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>gfp (it_wbisim_map E RX) i t1 t2</span></span></span><br></div><label class="goal-separator" for="properties-v-chk2e"><hr></label><div class="goal-conclusion">it_eat i
  <span class="kr">match</span> _observe y <span class="kr">with</span>
  | RetF r =&gt; RetF (g i r)
  | TauF t =&gt; TauF (g &lt;$&gt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; g &lt;$&gt; k r)
  <span class="kr">end</span> <span class="nl">?x2</span></div></blockquote><input class="alectryon-extra-goal-toggle" id="properties-v-chk2f" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I,
(RX a ==&gt; RY a)%signature (f a) (g a)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt;
it_wbisim_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y, t1</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe x) (TauF t1)</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe y) (TauF t2)</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>gfp (it_wbisim_map E RX) i t1 t2</span></span></span><br></div><label class="goal-separator" for="properties-v-chk2f"><hr></label><div class="goal-conclusion">it_eqF E RY (it_wbisim_t E RY R) i <span class="nl">?x1</span> <span class="nl">?x2</span></div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk30" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk30">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I,
(RX a ==&gt; RY a)%signature (f a) (g a)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt;
it_wbisim_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y, t1</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe x) (TauF t1)</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe y) (TauF t2)</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>gfp (it_wbisim_map E RX) i t1 t2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">itree&#39; E Y i</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">exact</span> (TauF (f &lt;$&gt; t1)).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk31" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk31">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I,
(RX a ==&gt; RY a)%signature (f a) (g a)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt;
it_wbisim_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y, t1</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe x) (TauF t1)</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe y) (TauF t2)</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>gfp (it_wbisim_map E RX) i t1 t2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">itree&#39; E Y i</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">exact</span> (TauF (g &lt;$&gt; t2)).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk32" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk32">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I,
(RX a ==&gt; RY a)%signature (f a) (g a)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt;
it_wbisim_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y, t1</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe x) (TauF t1)</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe y) (TauF t2)</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>gfp (it_wbisim_map E RX) i t1 t2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eat i
  <span class="kr">match</span> _observe x <span class="kr">with</span>
  | RetF r =&gt; RetF (f i r)
  | TauF t =&gt; TauF (f &lt;$&gt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; f &lt;$&gt; k r)
  <span class="kr">end</span> (TauF (f &lt;$&gt; t1))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk33" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk33"><span class="nb">clear</span> - r1; <span class="nb">remember</span> (_observe x) <span class="kr">as</span> ot; <span class="nb">clear</span> Heqot x.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>ot</var><span class="hyp-type"><b>: </b><span>itree&#39; E X i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i ot (TauF t1)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eat i
  <span class="kr">match</span> ot <span class="kr">with</span>
  | RetF r =&gt; RetF (f i r)
  | TauF t =&gt; TauF (f &lt;$&gt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; f &lt;$&gt; k r)
  <span class="kr">end</span> (TauF (f &lt;$&gt; t1))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk34" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk34"><span class="nb">dependent induction</span> r1; <span class="nb">econstructor</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t0, t1</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (observe t0) (TauF t1)</span></span></span><br><span><var>IHr1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">Y</span> : psh I)
  (<span class="nv">f</span> : <span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a)
  (<span class="nv">t2</span> : itree E X i),
TauF t1 = TauF t2 -&gt;
it_eat i
  <span class="kr">match</span> observe t0 <span class="kr">with</span>
  | RetF r =&gt; RetF (f i r)
  | TauF t =&gt; TauF (f &lt;$&gt; t)
  | VisF e k =&gt;
      VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; f &lt;$&gt; k r)
  <span class="kr">end</span> (TauF (f &lt;$&gt; t2))</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eat i (observe (f &lt;$&gt; t0)) (TauF (f &lt;$&gt; t1))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">exact</span> (IHr1 Y f t1 eq_refl).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk35" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk35">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I,
(RX a ==&gt; RY a)%signature (f a) (g a)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt;
it_wbisim_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y, t1</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe x) (TauF t1)</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe y) (TauF t2)</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>gfp (it_wbisim_map E RX) i t1 t2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eat i
  <span class="kr">match</span> _observe y <span class="kr">with</span>
  | RetF r =&gt; RetF (g i r)
  | TauF t =&gt; TauF (g &lt;$&gt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; g &lt;$&gt; k r)
  <span class="kr">end</span> (TauF (g &lt;$&gt; t2))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk36" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk36"><span class="nb">clear</span> - r2; <span class="nb">remember</span> (_observe y) <span class="kr">as</span> ot; <span class="nb">clear</span> Heqot y.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>ot</var><span class="hyp-type"><b>: </b><span>itree&#39; E X i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i ot (TauF t2)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eat i
  <span class="kr">match</span> ot <span class="kr">with</span>
  | RetF r =&gt; RetF (g i r)
  | TauF t =&gt; TauF (g &lt;$&gt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; g &lt;$&gt; k r)
  <span class="kr">end</span> (TauF (g &lt;$&gt; t2))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk37" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk37"><span class="nb">dependent induction</span> r2; <span class="nb">econstructor</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1, t2</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (observe t1) (TauF t2)</span></span></span><br><span><var>IHr2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">Y</span> : psh I)
  (<span class="nv">g</span> : <span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a)
  (<span class="nv">t3</span> : itree E X i),
TauF t2 = TauF t3 -&gt;
it_eat i
  <span class="kr">match</span> observe t1 <span class="kr">with</span>
  | RetF r =&gt; RetF (g i r)
  | TauF t =&gt; TauF (g &lt;$&gt; t)
  | VisF e k =&gt;
      VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; g &lt;$&gt; k r)
  <span class="kr">end</span> (TauF (g &lt;$&gt; t3))</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eat i (observe (g &lt;$&gt; t1)) (TauF (g &lt;$&gt; t2))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">exact</span> (IHr2 Y g t2 eq_refl).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk38" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk38">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I,
(RX a ==&gt; RY a)%signature (f a) (g a)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt;
it_wbisim_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y, t1</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe x) (TauF t1)</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe y) (TauF t2)</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>gfp (it_wbisim_map E RX) i t1 t2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eqF E RY (it_wbisim_t E RY R) i 
  (TauF (f &lt;$&gt; t1)) (TauF (g &lt;$&gt; t2))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk39" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk39"><span class="nb">econstructor</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I,
(RX a ==&gt; RY a)%signature (f a) (g a)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt;
it_wbisim_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y, t1</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe x) (TauF t1)</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe y) (TauF t2)</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>gfp (it_wbisim_map E RX) i t1 t2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_wbisim_t E RY R i (f &lt;$&gt; t1) (g &lt;$&gt; t2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">now</span> <span class="nb">apply</span> CIH.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk3a" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk3a">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I,
(RX a ==&gt; RY a)%signature (f a) (g a)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt;
it_wbisim_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X (e_nxt x)</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe x) (VisF q k1)</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X (e_nxt x)</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe y) (VisF q k2)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
gfp (it_wbisim_map E RX) 
  (e_nxt r) (k1 r) (k2 r)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_wbisimF E RY (it_wbisim_t E RY R) i
  <span class="kr">match</span> _observe x <span class="kr">with</span>
  | RetF r =&gt; RetF (f i r)
  | TauF t =&gt; TauF (f &lt;$&gt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; f &lt;$&gt; k r)
  <span class="kr">end</span>
  <span class="kr">match</span> _observe y <span class="kr">with</span>
  | RetF r =&gt; RetF (g i r)
  | TauF t =&gt; TauF (g &lt;$&gt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; g &lt;$&gt; k r)
  <span class="kr">end</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk3b" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk3b"><span class="nb">unshelve</span> <span class="nb">econstructor</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I,
(RX a ==&gt; RY a)%signature (f a) (g a)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt;
it_wbisim_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X (e_nxt x)</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe x) (VisF q k1)</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X (e_nxt x)</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe y) (VisF q k2)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
gfp (it_wbisim_map E RX) 
  (e_nxt r) (k1 r) (k2 r)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">itree&#39; E Y i</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="properties-v-chk3c" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I,
(RX a ==&gt; RY a)%signature (f a) (g a)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt;
it_wbisim_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X (e_nxt x)</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe x) (VisF q k1)</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X (e_nxt x)</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe y) (VisF q k2)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
gfp (it_wbisim_map E RX) 
  (e_nxt r) (k1 r) (k2 r)</span></span></span><br></div><label class="goal-separator" for="properties-v-chk3c"><hr></label><div class="goal-conclusion">itree&#39; E Y i</div></blockquote><input class="alectryon-extra-goal-toggle" id="properties-v-chk3d" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I,
(RX a ==&gt; RY a)%signature (f a) (g a)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt;
it_wbisim_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X (e_nxt x)</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe x) (VisF q k1)</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X (e_nxt x)</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe y) (VisF q k2)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
gfp (it_wbisim_map E RX) 
  (e_nxt r) (k1 r) (k2 r)</span></span></span><br></div><label class="goal-separator" for="properties-v-chk3d"><hr></label><div class="goal-conclusion">it_eat i
  <span class="kr">match</span> _observe x <span class="kr">with</span>
  | RetF r =&gt; RetF (f i r)
  | TauF t =&gt; TauF (f &lt;$&gt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; f &lt;$&gt; k r)
  <span class="kr">end</span> <span class="nl">?x1</span></div></blockquote><input class="alectryon-extra-goal-toggle" id="properties-v-chk3e" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I,
(RX a ==&gt; RY a)%signature (f a) (g a)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt;
it_wbisim_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X (e_nxt x)</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe x) (VisF q k1)</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X (e_nxt x)</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe y) (VisF q k2)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
gfp (it_wbisim_map E RX) 
  (e_nxt r) (k1 r) (k2 r)</span></span></span><br></div><label class="goal-separator" for="properties-v-chk3e"><hr></label><div class="goal-conclusion">it_eat i
  <span class="kr">match</span> _observe y <span class="kr">with</span>
  | RetF r =&gt; RetF (g i r)
  | TauF t =&gt; TauF (g &lt;$&gt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; g &lt;$&gt; k r)
  <span class="kr">end</span> <span class="nl">?x2</span></div></blockquote><input class="alectryon-extra-goal-toggle" id="properties-v-chk3f" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I,
(RX a ==&gt; RY a)%signature (f a) (g a)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt;
it_wbisim_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X (e_nxt x)</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe x) (VisF q k1)</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X (e_nxt x)</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe y) (VisF q k2)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
gfp (it_wbisim_map E RX) 
  (e_nxt r) (k1 r) (k2 r)</span></span></span><br></div><label class="goal-separator" for="properties-v-chk3f"><hr></label><div class="goal-conclusion">it_eqF E RY (it_wbisim_t E RY R) i <span class="nl">?x1</span> <span class="nl">?x2</span></div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk40" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk40">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I,
(RX a ==&gt; RY a)%signature (f a) (g a)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt;
it_wbisim_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X (e_nxt x)</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe x) (VisF q k1)</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X (e_nxt x)</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe y) (VisF q k2)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
gfp (it_wbisim_map E RX) 
  (e_nxt r) (k1 r) (k2 r)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">itree&#39; E Y i</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">exact</span> (VisF q (<span class="kr">fun</span> <span class="nv">r</span> =&gt; f &lt;$&gt; k1 r)).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk41" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk41">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I,
(RX a ==&gt; RY a)%signature (f a) (g a)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt;
it_wbisim_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X (e_nxt x)</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe x) (VisF q k1)</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X (e_nxt x)</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe y) (VisF q k2)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
gfp (it_wbisim_map E RX) 
  (e_nxt r) (k1 r) (k2 r)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">itree&#39; E Y i</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">exact</span> (VisF q (<span class="kr">fun</span> <span class="nv">r</span> =&gt; g &lt;$&gt; k2 r)).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk42" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk42">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I,
(RX a ==&gt; RY a)%signature (f a) (g a)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt;
it_wbisim_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X (e_nxt x)</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe x) (VisF q k1)</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X (e_nxt x)</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe y) (VisF q k2)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
gfp (it_wbisim_map E RX) 
  (e_nxt r) (k1 r) (k2 r)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eat i
  <span class="kr">match</span> _observe x <span class="kr">with</span>
  | RetF r =&gt; RetF (f i r)
  | TauF t =&gt; TauF (f &lt;$&gt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; f &lt;$&gt; k r)
  <span class="kr">end</span> (VisF q (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp q =&gt; f &lt;$&gt; k1 r))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk43" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk43"><span class="nb">clear</span> - r1; <span class="nb">remember</span> (_observe x) <span class="kr">as</span> ot; <span class="nb">clear</span> Heqot x.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X (e_nxt x)</span></span></span><br><span><var>ot</var><span class="hyp-type"><b>: </b><span>itree&#39; E X i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i ot (VisF q k1)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eat i
  <span class="kr">match</span> ot <span class="kr">with</span>
  | RetF r =&gt; RetF (f i r)
  | TauF t =&gt; TauF (f &lt;$&gt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; f &lt;$&gt; k r)
  <span class="kr">end</span> (VisF q (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp q =&gt; f &lt;$&gt; k1 r))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk44" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk44"><span class="nb">dependent induction</span> r1; <span class="nb">econstructor</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X (e_nxt x)</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (observe t1) (VisF q k1)</span></span></span><br><span><var>IHr1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">Y</span> : psh I)
  (<span class="nv">f</span> : <span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a) 
  (<span class="nv">q0</span> : e_qry i)
  (<span class="nv">k2</span> : <span class="kr">forall</span> <span class="nv">x</span> : e_rsp q0,
        itree E X (e_nxt x)),
VisF q k1 = VisF q0 k2 -&gt;
it_eat i
  <span class="kr">match</span> observe t1 <span class="kr">with</span>
  | RetF r =&gt; RetF (f i r)
  | TauF t =&gt; TauF (f &lt;$&gt; t)
  | VisF e k =&gt;
      VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; f &lt;$&gt; k r)
  <span class="kr">end</span>
  (VisF q0 (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp q0 =&gt; f &lt;$&gt; k2 r))</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eat i (observe (f &lt;$&gt; t1))
  (VisF q (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp q =&gt; f &lt;$&gt; k1 r))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">exact</span> (IHr1 Y f q k1 eq_refl).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk45" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk45">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I,
(RX a ==&gt; RY a)%signature (f a) (g a)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt;
it_wbisim_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X (e_nxt x)</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe x) (VisF q k1)</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X (e_nxt x)</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe y) (VisF q k2)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
gfp (it_wbisim_map E RX) 
  (e_nxt r) (k1 r) (k2 r)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eat i
  <span class="kr">match</span> _observe y <span class="kr">with</span>
  | RetF r =&gt; RetF (g i r)
  | TauF t =&gt; TauF (g &lt;$&gt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; g &lt;$&gt; k r)
  <span class="kr">end</span> (VisF q (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp q =&gt; g &lt;$&gt; k2 r))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk46" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk46"><span class="nb">clear</span> - r2; <span class="nb">remember</span> (_observe y) <span class="kr">as</span> ot; <span class="nb">clear</span> Heqot y.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X (e_nxt x)</span></span></span><br><span><var>ot</var><span class="hyp-type"><b>: </b><span>itree&#39; E X i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i ot (VisF q k2)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eat i
  <span class="kr">match</span> ot <span class="kr">with</span>
  | RetF r =&gt; RetF (g i r)
  | TauF t =&gt; TauF (g &lt;$&gt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; g &lt;$&gt; k r)
  <span class="kr">end</span> (VisF q (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp q =&gt; g &lt;$&gt; k2 r))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk47" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk47"><span class="nb">dependent induction</span> r2; <span class="nb">econstructor</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X (e_nxt x)</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (observe t1) (VisF q k2)</span></span></span><br><span><var>IHr2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">Y</span> : psh I)
  (<span class="nv">g</span> : <span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a) 
  (<span class="nv">q0</span> : e_qry i)
  (<span class="nv">k3</span> : <span class="kr">forall</span> <span class="nv">x</span> : e_rsp q0,
        itree E X (e_nxt x)),
VisF q k2 = VisF q0 k3 -&gt;
it_eat i
  <span class="kr">match</span> observe t1 <span class="kr">with</span>
  | RetF r =&gt; RetF (g i r)
  | TauF t =&gt; TauF (g &lt;$&gt; t)
  | VisF e k =&gt;
      VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; g &lt;$&gt; k r)
  <span class="kr">end</span>
  (VisF q0 (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp q0 =&gt; g &lt;$&gt; k3 r))</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eat i (observe (g &lt;$&gt; t1))
  (VisF q (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp q =&gt; g &lt;$&gt; k2 r))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">exact</span> (IHr2 Y g q k2 eq_refl).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk48" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk48">+</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I,
(RX a ==&gt; RY a)%signature (f a) (g a)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt;
it_wbisim_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X (e_nxt x)</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe x) (VisF q k1)</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X (e_nxt x)</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe y) (VisF q k2)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
gfp (it_wbisim_map E RX) 
  (e_nxt r) (k1 r) (k2 r)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eqF E RY (it_wbisim_t E RY R) i
  (VisF q (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp q =&gt; f &lt;$&gt; k1 r))
  (VisF q (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp q =&gt; g &lt;$&gt; k2 r))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk49" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk49"><span class="nb">econstructor</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (X x)</span></span></span><br><span><var>Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; Y a</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I,
(RX a ==&gt; RY a)%signature (f a) (g a)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_wbisim_map E RX) a x y -&gt;
it_wbisim_t E RY R a (f &lt;$&gt; x) (g &lt;$&gt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X (e_nxt x)</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe x) (VisF q k1)</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X (e_nxt x)</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe y) (VisF q k2)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
gfp (it_wbisim_map E RX) 
  (e_nxt r) (k1 r) (k2 r)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
it_wbisim_t E RY R (e_nxt r) (f &lt;$&gt; k1 r) (g &lt;$&gt; k2 r)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">intro</span> r; <span class="bp">now</span> <span class="nb">apply</span> CIH.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><p><tt class="docutils literal">subst</tt> respects strong bisimilarity.</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk4a" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk4a">#[<span class="kn">global</span>] <span class="kn">Instance</span> <span class="nf">subst_eq</span> {<span class="nv">X</span> <span class="nv">Y</span>} {<span class="nv">RX</span> : rel·µ¢ X X} {<span class="nv">RY</span> : rel·µ¢ Y Y} :
    Proper (dpointwise_relation (<span class="kr">fun</span> <span class="nv">i</span> =&gt; RX i ==&gt; it_eq RY (i:=i))
              ==&gt; dpointwise_relation (<span class="kr">fun</span> <span class="nv">i</span> =&gt; it_eq RX (i:=i) ==&gt; it_eq RY (i:=i)))
      (@<span class="nb">subst</span> I E X Y).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X X</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y Y</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Proper
  (dpointwise_relation
     (<span class="kr">fun</span> <span class="nv">i</span> : I =&gt; RX i ==&gt; it_eq RY (i:=i)) ==&gt;
   dpointwise_relation
     (<span class="kr">fun</span> <span class="nv">i</span> : I =&gt; it_eq RX (i:=i) ==&gt; it_eq RY (i:=i)))
  <span class="nb">subst</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk4b" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk4b"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X X</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y Y</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Proper
  (dpointwise_relation
     (<span class="kr">fun</span> <span class="nv">i</span> : I =&gt; RX i ==&gt; it_eq RY (i:=i)) ==&gt;
   dpointwise_relation
     (<span class="kr">fun</span> <span class="nv">i</span> : I =&gt; it_eq RX (i:=i) ==&gt; it_eq RY (i:=i)))
  <span class="nb">subst</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk4c" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk4c"><span class="nb">unfold</span> Proper, respectful, dpointwise_relation, pointwise_relation, it_eq.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X X</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y Y</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">x</span> <span class="nv">y</span> : <span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; itree E Y a,
(<span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x0</span> <span class="nv">y0</span> : X a),
 RX a x0 y0 -&gt;
 gfp (it_eq_map E RY) a (x a x0) (y a y0)) -&gt;
<span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x0</span> <span class="nv">y0</span> : itree E X a),
gfp (it_eq_map E RX) a x0 y0 -&gt;
gfp (it_eq_map E RY) a (x =&lt;&lt; x0) (y =&lt;&lt; y0)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk4d" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk4d"><span class="nb">intros</span> f g h1; coinduction R CIH; <span class="nb">intros</span> i x y h2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X X</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y Y</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; itree E Y a</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : X a),
RX a x y -&gt;
gfp (it_eq_map E RY) a (f a x) (g a y)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_eq_map E RX) a x y -&gt; it_eq_t E RY R a (f =&lt;&lt; x) (g =&lt;&lt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>gfp (it_eq_map E RX) i x y</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eq_bt E RY R i (f =&lt;&lt; x) (g =&lt;&lt; y)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk4e" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk4e"><span class="nb">apply</span> (gfp_fp (it_eq_map E RX)) <span class="kr">in</span> h2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X X</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y Y</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; itree E Y a</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : X a),
RX a x y -&gt;
gfp (it_eq_map E RY) a (f a x) (g a y)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_eq_map E RX) a x y -&gt; it_eq_t E RY R a (f =&lt;&lt; x) (g =&lt;&lt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>h2</var><span class="hyp-type"><b>: </b><span>it_eq_map E RX (gfp (it_eq_map E RX)) i x y</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eq_bt E RY R i (f =&lt;&lt; x) (g =&lt;&lt; y)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk4f" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk4f"><span class="nb">cbn</span> <span class="kr">in</span> *; <span class="nb">cbv</span> [observe] <span class="kr">in</span> h2; <span class="nb">dependent destruction</span> h2; simpl_depind; <span class="nb">eauto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X X</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y Y</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; itree E Y a</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : X a),
RX a x y -&gt;
gfp (it_eq_map E RY) a (f a x) (g a y)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_eq_map E RX) a x y -&gt; it_eq_t E RY R a (f =&lt;&lt; x) (g =&lt;&lt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r1, r2</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br><span><var>r_rel</var><span class="hyp-type"><b>: </b><span>RX i r1 r2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eqF E RY (it_eq_t E RY R) i (_observe (f i r1))
  (_observe (g i r2))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk50" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk50"><span class="nb">pose</span> (h3 := h1 i _ _ r_rel).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X X</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y Y</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; itree E Y a</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : X a),
RX a x y -&gt;
gfp (it_eq_map E RY) a (f a x) (g a y)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_eq_map E RX) a x y -&gt;
it_eq_t E RY R a (f =&lt;&lt; x) (g =&lt;&lt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r1, r2</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br><span><var>r_rel</var><span class="hyp-type"><b>: </b><span>RX i r1 r2</span></span></span><br><span><var>h3</var><span><span class="hyp-body"><b>:= </b><span>h1 i r1 r2 r_rel</span></span><span class="hyp-type"><b>: </b><span>gfp (it_eq_map E RY) i (f i r1) (g i r2)</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eqF E RY (it_eq_t E RY R) i 
  (_observe (f i r1)) (_observe (g i r2))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk51" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk51"><span class="nb">apply</span> (gfp_fp (it_eq_map E RY)) <span class="kr">in</span> h3.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X X</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y Y</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; itree E Y a</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : X a),
RX a x y -&gt;
gfp (it_eq_map E RY) a (f a x) (g a y)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_eq_map E RX) a x y -&gt;
it_eq_t E RY R a (f =&lt;&lt; x) (g =&lt;&lt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r1, r2</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br><span><var>r_rel</var><span class="hyp-type"><b>: </b><span>RX i r1 r2</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>it_eq_map E RY (gfp (it_eq_map E RY)) i 
  (f i r1) (g i r2)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eqF E RY (it_eq_t E RY R) i 
  (_observe (f i r1)) (_observe (g i r2))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk52" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk52"><span class="nb">cbn</span> <span class="kr">in</span> h3; <span class="nb">cbv</span> [observe] <span class="kr">in</span> h3.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X X</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y Y</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; itree E Y a</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : X a),
RX a x y -&gt;
gfp (it_eq_map E RY) a (f a x) (g a y)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_eq_map E RX) a x y -&gt;
it_eq_t E RY R a (f =&lt;&lt; x) (g =&lt;&lt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r1, r2</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br><span><var>r_rel</var><span class="hyp-type"><b>: </b><span>RX i r1 r2</span></span></span><br><span><var>h3</var><span class="hyp-type"><b>: </b><span>it_eqF E RY (gfp (it_eq_map E RY)) i
  (_observe (f i r1)) (_observe (g i r2))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eqF E RY (it_eq_t E RY R) i 
  (_observe (f i r1)) (_observe (g i r2))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk53" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk53"><span class="nb">dependent destruction</span> h3; simpl_depind; <span class="nb">econstructor</span>; <span class="nb">eauto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X X</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y Y</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; itree E Y a</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : X a),
RX a x y -&gt;
gfp (it_eq_map E RY) a (f a x) (g a y)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_eq_map E RX) a x y -&gt;
it_eq_t E RY R a (f =&lt;&lt; x) (g =&lt;&lt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r1, r2</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br><span><var>r_rel</var><span class="hyp-type"><b>: </b><span>RX i r1 r2</span></span></span><br><span><var>t1, t2</var><span class="hyp-type"><b>: </b><span>itree E Y i</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>gfp (it_eq_map E RY) i t1 t2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eq_t E RY R i t1 t2</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="properties-v-chk54" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X X</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y Y</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; itree E Y a</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : X a),
RX a x y -&gt;
gfp (it_eq_map E RY) a (f a x) (g a y)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_eq_map E RX) a x y -&gt;
it_eq_t E RY R a (f =&lt;&lt; x) (g =&lt;&lt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r1, r2</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br><span><var>r_rel</var><span class="hyp-type"><b>: </b><span>RX i r1 r2</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i</span></span></span><br><span><var>k1, k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E Y (e_nxt x)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
gfp (it_eq_map E RY) (e_nxt r) (k1 r) (k2 r)</span></span></span><br></div><label class="goal-separator" for="properties-v-chk54"><hr></label><div class="goal-conclusion"><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
it_eq_t E RY R (e_nxt r) (k1 r) (k2 r)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk55" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk55"><span class="mi">2</span>: <span class="nb">intro</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X X</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y Y</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; itree E Y a</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : X a),
RX a x y -&gt;
gfp (it_eq_map E RY) a (f a x) (g a y)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_eq_map E RX) a x y -&gt;
it_eq_t E RY R a (f =&lt;&lt; x) (g =&lt;&lt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r1, r2</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br><span><var>r_rel</var><span class="hyp-type"><b>: </b><span>RX i r1 r2</span></span></span><br><span><var>t1, t2</var><span class="hyp-type"><b>: </b><span>itree E Y i</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>gfp (it_eq_map E RY) i t1 t2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eq_t E RY R i t1 t2</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="properties-v-chk56" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X X</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y Y</span></span></span><br><span><var>f, g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">a</span> : I, X a -&gt; itree E Y a</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : X a),
RX a x y -&gt;
gfp (it_eq_map E RY) a (f a x) (g a y)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">a</span> : I) (<span class="nv">x</span> <span class="nv">y</span> : itree E X a),
gfp (it_eq_map E RX) a x y -&gt;
it_eq_t E RY R a (f =&lt;&lt; x) (g =&lt;&lt; y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r1, r2</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br><span><var>r_rel</var><span class="hyp-type"><b>: </b><span>RX i r1 r2</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i</span></span></span><br><span><var>k1, k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E Y (e_nxt x)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
gfp (it_eq_map E RY) (e_nxt r) (k1 r) (k2 r)</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>e_rsp q</span></span></span><br></div><label class="goal-separator" for="properties-v-chk56"><hr></label><div class="goal-conclusion">it_eq_t E RY R (e_nxt r) (k1 r) (k2 r)</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kp">all</span>: <span class="bp">now</span> <span class="nb">apply</span> (gfp_t (it_eq_map E RY)).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><p>A slight generalization of the monad law <tt class="docutils literal">t ‚âä t &gt;&gt;= Œ∑</tt>.</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk57" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk57"><span class="kn">Lemma</span> <span class="nf">bind_ret</span> {<span class="nv">X</span> <span class="nv">Y</span>} {<span class="nv">RX</span> : rel·µ¢ Y Y} {<span class="nv">_</span> : Reflexive·µ¢ RX} (<span class="nv">f</span> : X ‚áí·µ¢ Y) {<span class="nv">i</span>}
    (<span class="nv">t</span> : itree E X i)
    : it_eq RX (fmap f i t) (bind t (<span class="kr">fun</span> <span class="nv">i</span> <span class="nv">x</span> =&gt; Ret&#39; (f i x))).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y Y</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Reflexive·µ¢ RX</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>X ‚áí·µ¢ Y</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eq RX (f &lt;$&gt; t)
  (t &gt;&gt;= (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">x</span> : X i) =&gt; Ret&#39; (f i x)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk58" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk58"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y Y</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Reflexive·µ¢ RX</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>X ‚áí·µ¢ Y</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eq RX (f &lt;$&gt; t)
  (t &gt;&gt;= (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">x</span> : X i) =&gt; Ret&#39; (f i x)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk59" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk59"><span class="nb">revert</span> i t; <span class="nb">unfold</span> it_eq; coinduction R CIH; <span class="nb">intros</span> i t.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y Y</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>Reflexive·µ¢ RX</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>X ‚áí·µ¢ Y</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y) (itree E Y)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">t0</span> : itree E X i),
it_eq_t E RX R i (f &lt;$&gt; t0)
(t0 &gt;&gt;= (<span class="kr">fun</span> (<span class="nv">i0</span> : I) (<span class="nv">x</span> : X i0) =&gt; Ret&#39; (f i0 x)))</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eq_bt E RX R i (f &lt;$&gt; t)
  (t &gt;&gt;= (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">x</span> : X i) =&gt; Ret&#39; (f i x)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">cbn</span>; <span class="nb">destruct</span> (_observe t); <span class="nb">auto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk5a" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk5a">#[<span class="kn">global</span>] <span class="kn">Instance</span> <span class="nf">subst_eat</span> {<span class="nv">X</span> <span class="nv">Y</span>} (<span class="nv">f</span> : X ‚áí·µ¢ itree E Y) {<span class="nv">i</span>} :
    Proper (it_eat&#39; i ==&gt; it_eat&#39; i) (<span class="nb">subst</span> f i).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>X ‚áí·µ¢ itree E Y</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Proper (it_eat&#39; i ==&gt; it_eat&#39; i) (<span class="nb">subst</span> f i)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk5b" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk5b"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>X ‚áí·µ¢ itree E Y</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">Proper (it_eat&#39; i ==&gt; it_eat&#39; i) (<span class="nb">subst</span> f i)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk5c" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk5c"><span class="nb">intros</span> ? ? H; <span class="nb">unfold</span> it_eat&#39; <span class="kr">in</span> *; <span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>X ‚áí·µ¢ itree E Y</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe x) (_observe y)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eat i
  <span class="kr">match</span> _observe x <span class="kr">with</span>
  | RetF r =&gt; _observe (f i r)
  | TauF t =&gt; TauF (f =&lt;&lt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; f =&lt;&lt; k r)
  <span class="kr">end</span>
  <span class="kr">match</span> _observe y <span class="kr">with</span>
  | RetF r =&gt; _observe (f i r)
  | TauF t =&gt; TauF (f =&lt;&lt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; f =&lt;&lt; k r)
  <span class="kr">end</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk5d" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk5d"><span class="nb">remember</span> (_observe x) <span class="kr">as</span> _x <span class="nb">eqn</span>:Hx; <span class="nb">clear</span> Hx.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>X ‚áí·µ¢ itree E Y</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>_x</var><span class="hyp-type"><b>: </b><span>itree&#39; E X i</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>it_eat i _x (_observe y)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eat i
  <span class="kr">match</span> _x <span class="kr">with</span>
  | RetF r =&gt; _observe (f i r)
  | TauF t =&gt; TauF (f =&lt;&lt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; f =&lt;&lt; k r)
  <span class="kr">end</span>
  <span class="kr">match</span> _observe y <span class="kr">with</span>
  | RetF r =&gt; _observe (f i r)
  | TauF t =&gt; TauF (f =&lt;&lt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; f =&lt;&lt; k r)
  <span class="kr">end</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk5e" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk5e"><span class="nb">remember</span> (_observe y) <span class="kr">as</span> _y <span class="nb">eqn</span>:Hy; <span class="nb">clear</span> Hy.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>X ‚áí·µ¢ itree E Y</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x, y</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>_x, _y</var><span class="hyp-type"><b>: </b><span>itree&#39; E X i</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span>it_eat i _x _y</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eat i
  <span class="kr">match</span> _x <span class="kr">with</span>
  | RetF r =&gt; _observe (f i r)
  | TauF t =&gt; TauF (f =&lt;&lt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; f =&lt;&lt; k r)
  <span class="kr">end</span>
  <span class="kr">match</span> _y <span class="kr">with</span>
  | RetF r =&gt; _observe (f i r)
  | TauF t =&gt; TauF (f =&lt;&lt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; f =&lt;&lt; k r)
  <span class="kr">end</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">dependent induction</span> H; <span class="bp">now</span> <span class="nb">econstructor</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><p>Composition law of <tt class="docutils literal">bind</tt>.</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk5f" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk5f"><span class="kn">Lemma</span> <span class="nf">bind_bind_com</span> {<span class="nv">X</span> <span class="nv">Y</span> <span class="nv">Z</span> <span class="nv">RZ</span>} `{Reflexive·µ¢ RZ}
    {f : X ‚áí·µ¢ itree E Y} {g : Y ‚áí·µ¢ itree E Z} {i} {x : itree E X i} :
    it_eq RZ (bind (bind x f) g) (bind x (kcomp f g)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y, Z</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RZ</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Z x)</span></span></span><br><span><var>Reflexive·µ¢0</var><span class="hyp-type"><b>: </b><span>Reflexive·µ¢ RZ</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>X ‚áí·µ¢ itree E Y</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span>Y ‚áí·µ¢ itree E Z</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eq RZ ((x &gt;&gt;= f) &gt;&gt;= g) (x &gt;&gt;= (f &gt;=&gt; g))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk60" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk60"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y, Z</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RZ</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Z x)</span></span></span><br><span><var>Reflexive·µ¢0</var><span class="hyp-type"><b>: </b><span>Reflexive·µ¢ RZ</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>X ‚áí·µ¢ itree E Y</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span>Y ‚áí·µ¢ itree E Z</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eq RZ ((x &gt;&gt;= f) &gt;&gt;= g) (x &gt;&gt;= (f &gt;=&gt; g))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk61" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk61"><span class="nb">revert</span> i x; <span class="nb">unfold</span> it_eq; coinduction R CIH; <span class="nb">intros</span> i x.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y, Z</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RZ</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Z x)</span></span></span><br><span><var>Reflexive·µ¢0</var><span class="hyp-type"><b>: </b><span>Reflexive·µ¢ RZ</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>X ‚áí·µ¢ itree E Y</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span>Y ‚áí·µ¢ itree E Z</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Z) (itree E Z)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x</span> : itree E X i),
it_eq_t E RZ R i ((x &gt;&gt;= f) &gt;&gt;= g)
  (x &gt;&gt;= (f &gt;=&gt; g))</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eq_bt E RZ R i ((x &gt;&gt;= f) &gt;&gt;= g) (x &gt;&gt;= (f &gt;=&gt; g))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk62" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk62"><span class="nb">cbn</span>; <span class="nb">destruct</span> (x.(_observe)); <span class="nb">eauto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y, Z</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RZ</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Z x)</span></span></span><br><span><var>Reflexive·µ¢0</var><span class="hyp-type"><b>: </b><span>Reflexive·µ¢ RZ</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>X ‚áí·µ¢ itree E Y</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span>Y ‚áí·µ¢ itree E Z</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Z) (itree E Z)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x</span> : itree E X i),
it_eq_t E RZ R i ((x &gt;&gt;= f) &gt;&gt;= g)
  (x &gt;&gt;= (f &gt;=&gt; g))</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eqF E RZ (it_eq_t E RZ R) i
  <span class="kr">match</span> _observe (f i r) <span class="kr">with</span>
  | RetF r =&gt; _observe (g i r)
  | TauF t =&gt; TauF (g =&lt;&lt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; g =&lt;&lt; k r)
  <span class="kr">end</span>
  <span class="kr">match</span> _observe (f i r) <span class="kr">with</span>
  | RetF r =&gt; _observe (g i r)
  | TauF t =&gt; TauF (g =&lt;&lt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; g =&lt;&lt; k r)
  <span class="kr">end</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk63" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk63"><span class="nb">destruct</span> ((f i r).(_observe)); <span class="nb">eauto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y, Z</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RZ</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Z x)</span></span></span><br><span><var>Reflexive·µ¢0</var><span class="hyp-type"><b>: </b><span>Reflexive·µ¢ RZ</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>X ‚áí·µ¢ itree E Y</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span>Y ‚áí·µ¢ itree E Z</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Z) (itree E Z)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x</span> : itree E X i),
it_eq_t E RZ R i ((x &gt;&gt;= f) &gt;&gt;= g)
  (x &gt;&gt;= (f &gt;=&gt; g))</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>Y i</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eqF E RZ (it_eq_t E RZ R) i 
  (_observe (g i r0)) 
  (_observe (g i r0))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">destruct</span> ((g i r0).(_observe)); <span class="nb">eauto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><p>Composition law of <tt class="docutils literal">fmap</tt>.</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk64" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk64"><span class="kn">Lemma</span> <span class="nf">fmap_fmap_com</span> {<span class="nv">X</span> <span class="nv">Y</span> <span class="nv">Z</span> <span class="nv">RZ</span>} `{Reflexive·µ¢ RZ}
    {f : X ‚áí·µ¢ Y} {g : Y ‚áí·µ¢ Z} {i} {x : itree E X i} :
    it_eq RZ (fmap g i (fmap f i x)) (fmap (<span class="kr">fun</span> <span class="nv">i</span> <span class="nv">x</span> =&gt; g i (f i x)) i x).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y, Z</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RZ</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Z x)</span></span></span><br><span><var>Reflexive·µ¢0</var><span class="hyp-type"><b>: </b><span>Reflexive·µ¢ RZ</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>X ‚áí·µ¢ Y</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span>Y ‚áí·µ¢ Z</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eq RZ (g &lt;$&gt; (f &lt;$&gt; x))
  ((<span class="kr">fun</span> <span class="nv">i</span> : I =&gt; g i ‚àò f i) &lt;$&gt; x)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk65" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk65"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y, Z</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RZ</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Z x)</span></span></span><br><span><var>Reflexive·µ¢0</var><span class="hyp-type"><b>: </b><span>Reflexive·µ¢ RZ</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>X ‚áí·µ¢ Y</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span>Y ‚áí·µ¢ Z</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eq RZ (g &lt;$&gt; (f &lt;$&gt; x))
  ((<span class="kr">fun</span> <span class="nv">i</span> : I =&gt; g i ‚àò f i) &lt;$&gt; x)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk66" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk66"><span class="nb">revert</span> i x; <span class="nb">unfold</span> it_eq; coinduction R CIH; <span class="nb">intros</span> i x.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y, Z</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RZ</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Z x)</span></span></span><br><span><var>Reflexive·µ¢0</var><span class="hyp-type"><b>: </b><span>Reflexive·µ¢ RZ</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>X ‚áí·µ¢ Y</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span>Y ‚áí·µ¢ Z</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Z) (itree E Z)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x</span> : itree E X i),
it_eq_t E RZ R i (g &lt;$&gt; (f &lt;$&gt; x))
  ((<span class="kr">fun</span> <span class="nv">i0</span> : I =&gt; g i0 ‚àò f i0) &lt;$&gt; x)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eq_bt E RZ R i (g &lt;$&gt; (f &lt;$&gt; x))
  ((<span class="kr">fun</span> <span class="nv">i</span> : I =&gt; g i ‚àò f i) &lt;$&gt; x)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">cbn</span>; <span class="nb">destruct</span> (x.(_observe)); <span class="nb">eauto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><p><tt class="docutils literal">bind</tt> and <tt class="docutils literal">fmap</tt> interaction.</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk67" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk67"><span class="kn">Lemma</span> <span class="nf">fmap_bind_com</span> {<span class="nv">X</span> <span class="nv">Y</span> <span class="nv">Z</span> <span class="nv">RZ</span>} `{Reflexive·µ¢ RZ}
    {f : X ‚áí·µ¢ Y} {g : Y ‚áí·µ¢ itree E Z} {i} {x : itree E X i} :
    it_eq RZ (bind (fmap f _ x) g) (bind x (<span class="kr">fun</span> <span class="nv">i</span> <span class="nv">x</span> =&gt; g i (f i x))).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y, Z</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RZ</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Z x)</span></span></span><br><span><var>Reflexive·µ¢0</var><span class="hyp-type"><b>: </b><span>Reflexive·µ¢ RZ</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>X ‚áí·µ¢ Y</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span>Y ‚áí·µ¢ itree E Z</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eq RZ ((f &lt;$&gt; x) &gt;&gt;= g)
  (x &gt;&gt;= (<span class="kr">fun</span> <span class="nv">i</span> : I =&gt; g i ‚àò f i))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk68" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk68"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y, Z</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RZ</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Z x)</span></span></span><br><span><var>Reflexive·µ¢0</var><span class="hyp-type"><b>: </b><span>Reflexive·µ¢ RZ</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>X ‚áí·µ¢ Y</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span>Y ‚áí·µ¢ itree E Z</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eq RZ ((f &lt;$&gt; x) &gt;&gt;= g)
  (x &gt;&gt;= (<span class="kr">fun</span> <span class="nv">i</span> : I =&gt; g i ‚àò f i))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk69" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk69"><span class="nb">revert</span> i x; <span class="nb">unfold</span> it_eq; coinduction R CIH; <span class="nb">intros</span> i x.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y, Z</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RZ</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Z x)</span></span></span><br><span><var>Reflexive·µ¢0</var><span class="hyp-type"><b>: </b><span>Reflexive·µ¢ RZ</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>X ‚áí·µ¢ Y</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span>Y ‚áí·µ¢ itree E Z</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Z) (itree E Z)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x</span> : itree E X i),
it_eq_t E RZ R i ((f &lt;$&gt; x) &gt;&gt;= g)
  (x &gt;&gt;= (<span class="kr">fun</span> <span class="nv">i0</span> : I =&gt; g i0 ‚àò f i0))</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eq_bt E RZ R i ((f &lt;$&gt; x) &gt;&gt;= g)
  (x &gt;&gt;= (<span class="kr">fun</span> <span class="nv">i</span> : I =&gt; g i ‚àò f i))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk6a" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk6a"><span class="nb">cbn</span>; <span class="nb">destruct</span> (x.(_observe)); <span class="nb">eauto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y, Z</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RZ</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Z x)</span></span></span><br><span><var>Reflexive·µ¢0</var><span class="hyp-type"><b>: </b><span>Reflexive·µ¢ RZ</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>X ‚áí·µ¢ Y</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span>Y ‚áí·µ¢ itree E Z</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Z) (itree E Z)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x</span> : itree E X i),
it_eq_t E RZ R i ((f &lt;$&gt; x) &gt;&gt;= g)
  (x &gt;&gt;= (<span class="kr">fun</span> <span class="nv">i0</span> : I =&gt; g i0 ‚àò f i0))</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eqF E RZ (it_eq_t E RZ R) i
  (_observe (g i (f i r))) 
  (_observe (g i (f i r)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">destruct</span> ((g i (f i r)).(_observe)); <span class="nb">eauto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk6b" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk6b"><span class="kn">Lemma</span> <span class="nf">bind_fmap_com</span> {<span class="nv">X</span> <span class="nv">Y</span> <span class="nv">Z</span> <span class="nv">RZ</span>} `{Reflexive·µ¢ RZ}
    {f : X ‚áí·µ¢ itree E Y} {g : Y ‚áí·µ¢ Z} {i} {x : itree E X i} :
    it_eq RZ (fmap g _ (bind x f)) (bind x (<span class="kr">fun</span> <span class="nv">i</span> <span class="nv">x</span> =&gt; fmap g i (f i x))).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y, Z</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RZ</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Z x)</span></span></span><br><span><var>Reflexive·µ¢0</var><span class="hyp-type"><b>: </b><span>Reflexive·µ¢ RZ</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>X ‚áí·µ¢ itree E Y</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span>Y ‚áí·µ¢ Z</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eq RZ (g &lt;$&gt; (x &gt;&gt;= f))
  (x &gt;&gt;= (<span class="kr">fun</span> <span class="nv">i</span> : I =&gt; fmap g i ‚àò f i))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk6c" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk6c"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y, Z</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RZ</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Z x)</span></span></span><br><span><var>Reflexive·µ¢0</var><span class="hyp-type"><b>: </b><span>Reflexive·µ¢ RZ</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>X ‚áí·µ¢ itree E Y</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span>Y ‚áí·µ¢ Z</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eq RZ (g &lt;$&gt; (x &gt;&gt;= f))
  (x &gt;&gt;= (<span class="kr">fun</span> <span class="nv">i</span> : I =&gt; fmap g i ‚àò f i))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk6d" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk6d"><span class="nb">revert</span> i x; <span class="nb">unfold</span> it_eq; coinduction R CIH; <span class="nb">intros</span> i x.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y, Z</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RZ</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Z x)</span></span></span><br><span><var>Reflexive·µ¢0</var><span class="hyp-type"><b>: </b><span>Reflexive·µ¢ RZ</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>X ‚áí·µ¢ itree E Y</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span>Y ‚áí·µ¢ Z</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Z) (itree E Z)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x</span> : itree E X i),
it_eq_t E RZ R i (g &lt;$&gt; (x &gt;&gt;= f))
  (x &gt;&gt;= (<span class="kr">fun</span> <span class="nv">i0</span> : I =&gt; fmap g i0 ‚àò f i0))</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eq_bt E RZ R i (g &lt;$&gt; (x &gt;&gt;= f))
  (x &gt;&gt;= (<span class="kr">fun</span> <span class="nv">i</span> : I =&gt; fmap g i ‚àò f i))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk6e" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk6e"><span class="nb">cbn</span>; <span class="nb">destruct</span> (x.(_observe)); <span class="nb">eauto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y, Z</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RZ</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Z x)</span></span></span><br><span><var>Reflexive·µ¢0</var><span class="hyp-type"><b>: </b><span>Reflexive·µ¢ RZ</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>X ‚áí·µ¢ itree E Y</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span>Y ‚áí·µ¢ Z</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Z) (itree E Z)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x</span> : itree E X i),
it_eq_t E RZ R i (g &lt;$&gt; (x &gt;&gt;= f))
  (x &gt;&gt;= (<span class="kr">fun</span> <span class="nv">i0</span> : I =&gt; fmap g i0 ‚àò f i0))</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eqF E RZ (it_eq_t E RZ R) i
  <span class="kr">match</span> _observe (f i r) <span class="kr">with</span>
  | RetF r =&gt; RetF (g i r)
  | TauF t =&gt; TauF (g &lt;$&gt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; g &lt;$&gt; k r)
  <span class="kr">end</span>
  <span class="kr">match</span> _observe (f i r) <span class="kr">with</span>
  | RetF r =&gt; RetF (g i r)
  | TauF t =&gt; TauF (g &lt;$&gt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; g &lt;$&gt; k r)
  <span class="kr">end</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">destruct</span> ((f i r).(_observe)); <span class="nb">eauto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><p>Rewording the composition law of <tt class="docutils literal">bind</tt>.</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk6f" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk6f"><span class="kn">Lemma</span> <span class="nf">subst_subst</span> {<span class="nv">X</span> <span class="nv">Y</span> <span class="nv">Z</span>}
    (<span class="nv">f</span> : Y ‚áí·µ¢ itree E Z) (<span class="nv">g</span> : X ‚áí·µ¢ itree E Y) {<span class="nv">i</span>} (<span class="nv">x</span> : itree E X i) :
    ((x &gt;&gt;= g) &gt;&gt;= f) ‚âä (x &gt;&gt;= (g &gt;=&gt; f)) .</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y, Z</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>Y ‚áí·µ¢ itree E Z</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span>X ‚áí·µ¢ itree E Y</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">((x &gt;&gt;= g) &gt;&gt;= f) ‚âä (x &gt;&gt;= (g &gt;=&gt; f))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk70" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk70"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y, Z</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>Y ‚áí·µ¢ itree E Z</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span>X ‚áí·µ¢ itree E Y</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E X i</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">((x &gt;&gt;= g) &gt;&gt;= f) ‚âä (x &gt;&gt;= (g &gt;=&gt; f))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">apply</span> bind_bind_com.</span><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><p>Proof of the up-to <tt class="docutils literal">bind</tt> principle: we may close bisimulation candidates by prefixing
related elements by bisimilar computations.</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Variant</span> <span class="nf">bindR</span> {<span class="nv">X1</span> <span class="nv">X2</span> <span class="nv">Y1</span> <span class="nv">Y2</span>} (<span class="nv">RX</span> : rel·µ¢ X1 X2)
    (<span class="nv">R</span> : rel·µ¢ (itree E X1) (itree E X2))
    (<span class="nv">S</span> : rel·µ¢ (itree E Y1) (itree E Y2)) :
    rel·µ¢ (itree E Y1) (itree E Y2) :=
    | BindR {i t1 t2 k1 k2}
        (u : R i t1 t2)
        (v : <span class="kr">forall</span> <span class="nv">i</span> <span class="nv">x1</span> <span class="nv">x2</span>, RX i x1 x2 -&gt; S i (k1 i x1) (k2 i x2))
      : bindR RX R S i (t1 &gt;&gt;= k1) (t2 &gt;&gt;= k2).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Arguments</span> BindR {X1 X2 Y1 Y2 RX R S i t1 t2 k1 k2}.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Hint Constructors</span> bindR : core.</span></span></pre><p>Up-to <tt class="docutils literal">bind</tt> is valid for strong bisimilarity.</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Program Definition</span> <span class="nf">bindR_eq_map</span> {<span class="nv">X1</span> <span class="nv">X2</span> <span class="nv">Y1</span> <span class="nv">Y2</span>} (<span class="nv">RX</span> : rel·µ¢ X1 X2) : mon (rel·µ¢ (itree E Y1) (itree E Y2)) :=
    {| body S := bindR RX (@it_eq _ E _ _ RX) S ;
       Hbody _ _ H _ _ _ &#39;(BindR u v) := BindR u (<span class="kr">fun</span> <span class="nv">i</span> <span class="nv">_</span> <span class="nv">_</span> <span class="nv">r</span> =&gt; H _ _ _ (v i _ _ r)) |}.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk71" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk71"><span class="kn">Lemma</span> <span class="nf">it_eq_up2bind_t</span> {<span class="nv">X1</span> <span class="nv">X2</span> <span class="nv">Y1</span> <span class="nv">Y2</span>} <span class="nv">RX</span> <span class="nv">RY</span> :
    @bindR_eq_map X1 X2 Y1 Y2 RX &lt;= it_eq_t E RY.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">bindR_eq_map RX &lt;= it_eq_t E RY</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk72" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk72"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">bindR_eq_map RX &lt;= it_eq_t E RY</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk73" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk73"><span class="nb">apply</span> Coinduction; <span class="nb">intros</span> R i x y [ ? ? ? ? ? u v].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E Y1 i</span></span></span><br><span><var>y</var><span class="hyp-type"><b>: </b><span>itree E Y2 i</span></span></span><br><span><var>i0</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E Y1 x</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E Y2 x</span></span></span><br><span><var>u</var><span class="hyp-type"><b>: </b><span>it_eq RX t1 t2</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : X1 i) (<span class="nv">x2</span> : X2 i),
RX i x1 x2 -&gt;
it_eq_map E RY R i (k1 i x1) (k2 i x2)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">bT (it_eq_map E RY) (bindR_eq_map RX) R i0 (t1 &gt;&gt;= k1)
  (t2 &gt;&gt;= k2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk74" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk74"><span class="nb">unfold</span> it_eq <span class="kr">in</span> u; <span class="nb">apply</span> (gfp_fp (it_eq_map E RX)) <span class="kr">in</span> u.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E Y1 i</span></span></span><br><span><var>y</var><span class="hyp-type"><b>: </b><span>itree E Y2 i</span></span></span><br><span><var>i0</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E Y1 x</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E Y2 x</span></span></span><br><span><var>u</var><span class="hyp-type"><b>: </b><span>it_eq_map E RX (gfp (it_eq_map E RX)) i0 t1 t2</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : X1 i) (<span class="nv">x2</span> : X2 i),
RX i x1 x2 -&gt;
it_eq_map E RY R i (k1 i x1) (k2 i x2)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">bT (it_eq_map E RY) (bindR_eq_map RX) R i0 (t1 &gt;&gt;= k1)
  (t2 &gt;&gt;= k2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk75" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk75"><span class="nb">cbn</span> <span class="kr">in</span> *; <span class="nb">cbv</span> [observe] <span class="kr">in</span> u.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E Y1 i</span></span></span><br><span><var>y</var><span class="hyp-type"><b>: </b><span>itree E Y2 i</span></span></span><br><span><var>i0</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E Y1 x</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E Y2 x</span></span></span><br><span><var>u</var><span class="hyp-type"><b>: </b><span>it_eqF E RX (gfp (it_eq_map E RX)) i0
  (_observe t1) (_observe t2)</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : X1 i) (<span class="nv">x2</span> : X2 i),
RX i x1 x2 -&gt;
it_eqF E RY R i (observe (k1 i x1))
  (observe (k2 i x2))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eqF E RY (it_eq_T E RY (bindR_eq_map RX) R) i0
  <span class="kr">match</span> _observe t1 <span class="kr">with</span>
  | RetF r =&gt; _observe (k1 i0 r)
  | TauF t =&gt; TauF (k1 =&lt;&lt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; k1 =&lt;&lt; k r)
  <span class="kr">end</span>
  <span class="kr">match</span> _observe t2 <span class="kr">with</span>
  | RetF r =&gt; _observe (k2 i0 r)
  | TauF t =&gt; TauF (k2 =&lt;&lt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; k2 =&lt;&lt; k r)
  <span class="kr">end</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk76" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk76"><span class="nb">dependent destruction</span> u; simpl_depind.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>itree E Y1 i</span></span></span><br><span><var>y</var><span class="hyp-type"><b>: </b><span>itree E Y2 i</span></span></span><br><span><var>i0</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E Y1 x</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E Y2 x</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>X1 i0</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>X2 i0</span></span></span><br><span><var>r_rel</var><span class="hyp-type"><b>: </b><span>RX i0 r1 r2</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : X1 i) (<span class="nv">x2</span> : X2 i),
RX i x1 x2 -&gt;
it_eqF E RY R i (observe (k1 i x1))
  (observe (k2 i x2))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eqF E RY (it_eq_T E RY (bindR_eq_map RX) R) i0
  (_observe (k1 i0 r1)) (_observe (k2 i0 r2))</div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="properties-v-chk77" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>itree E Y1 i</span></span></span><br><span><var>y</var><span class="hyp-type"><b>: </b><span>itree E Y2 i</span></span></span><br><span><var>i0</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E Y1 x</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E Y2 x</span></span></span><br><span><var>t0</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>t3</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>gfp (it_eq_map E RX) i0 t0 t3</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : X1 i) (<span class="nv">x2</span> : X2 i),
RX i x1 x2 -&gt;
it_eqF E RY R i (observe (k1 i x1))
  (observe (k2 i x2))</span></span></span><br></div><label class="goal-separator" for="properties-v-chk77"><hr></label><div class="goal-conclusion">it_eqF E RY (it_eq_T E RY (bindR_eq_map RX) R) i0
  (TauF (k1 =&lt;&lt; t0)) (TauF (k2 =&lt;&lt; t3))</div></blockquote><input class="alectryon-extra-goal-toggle" id="properties-v-chk78" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>itree E Y1 i</span></span></span><br><span><var>y</var><span class="hyp-type"><b>: </b><span>itree E Y2 i</span></span></span><br><span><var>i0</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E Y1 x</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E Y2 x</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i0</span></span></span><br><span><var>k0</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X1 (e_nxt x)</span></span></span><br><span><var>k3</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X2 (e_nxt x)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
gfp (it_eq_map E RX) (e_nxt r) (k0 r) (k3 r)</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : X1 i) (<span class="nv">x2</span> : X2 i),
RX i x1 x2 -&gt;
it_eqF E RY R i (observe (k1 i x1))
  (observe (k2 i x2))</span></span></span><br></div><label class="goal-separator" for="properties-v-chk78"><hr></label><div class="goal-conclusion">it_eqF E RY (it_eq_T E RY (bindR_eq_map RX) R) i0
  (VisF q (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp q =&gt; k1 =&lt;&lt; k0 r))
  (VisF q (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp q =&gt; k2 =&lt;&lt; k3 r))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk79" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk79">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>itree E Y1 i</span></span></span><br><span><var>y</var><span class="hyp-type"><b>: </b><span>itree E Y2 i</span></span></span><br><span><var>i0</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E Y1 x</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E Y2 x</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>X1 i0</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>X2 i0</span></span></span><br><span><var>r_rel</var><span class="hyp-type"><b>: </b><span>RX i0 r1 r2</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : X1 i) (<span class="nv">x2</span> : X2 i),
RX i x1 x2 -&gt;
it_eqF E RY R i (observe (k1 i x1))
  (observe (k2 i x2))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eqF E RY (it_eq_T E RY (bindR_eq_map RX) R) i0
  (_observe (k1 i0 r1)) 
  (_observe (k2 i0 r2))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">refine</span> (it_eqF_mon _ _ (id_T _ _ R) _ _ _ (v i0 _ _ r_rel)).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk7a" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk7a">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>itree E Y1 i</span></span></span><br><span><var>y</var><span class="hyp-type"><b>: </b><span>itree E Y2 i</span></span></span><br><span><var>i0</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E Y1 x</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E Y2 x</span></span></span><br><span><var>t0</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>t3</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>gfp (it_eq_map E RX) i0 t0 t3</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : X1 i) (<span class="nv">x2</span> : X2 i),
RX i x1 x2 -&gt;
it_eqF E RY R i (observe (k1 i x1))
  (observe (k2 i x2))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eqF E RY (it_eq_T E RY (bindR_eq_map RX) R) i0
  (TauF (k1 =&lt;&lt; t0)) (TauF (k2 =&lt;&lt; t3))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk7b" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk7b"><span class="nb">econstructor</span>; <span class="nb">apply</span> (fTf_Tf (it_eq_map E RY)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>itree E Y1 i</span></span></span><br><span><var>y</var><span class="hyp-type"><b>: </b><span>itree E Y2 i</span></span></span><br><span><var>i0</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E Y1 x</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E Y2 x</span></span></span><br><span><var>t0</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>t3</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>gfp (it_eq_map E RX) i0 t0 t3</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : X1 i) (<span class="nv">x2</span> : X2 i),
RX i x1 x2 -&gt;
it_eqF E RY R i (observe (k1 i x1))
  (observe (k2 i x2))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(bindR_eq_map RX ¬∞ it_eq_T E RY (bindR_eq_map RX)) R
  i0 (k1 =&lt;&lt; t0) (k2 =&lt;&lt; t3)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">refine</span> (BindR t_rel (<span class="kr">fun</span> <span class="nv">i</span> <span class="nv">_</span> <span class="nv">_</span> <span class="nv">r</span> =&gt; b_T (it_eq_map E RY) _ _ _ _ _ (v i _ _ r))).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk7c" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk7c">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>itree E Y1 i</span></span></span><br><span><var>y</var><span class="hyp-type"><b>: </b><span>itree E Y2 i</span></span></span><br><span><var>i0</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E Y1 x</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E Y2 x</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i0</span></span></span><br><span><var>k0</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X1 (e_nxt x)</span></span></span><br><span><var>k3</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X2 (e_nxt x)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
gfp (it_eq_map E RX) (e_nxt r) (k0 r) (k3 r)</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : X1 i) (<span class="nv">x2</span> : X2 i),
RX i x1 x2 -&gt;
it_eqF E RY R i (observe (k1 i x1))
  (observe (k2 i x2))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eqF E RY (it_eq_T E RY (bindR_eq_map RX) R) i0
  (VisF q (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp q =&gt; k1 =&lt;&lt; k0 r))
  (VisF q (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp q =&gt; k2 =&lt;&lt; k3 r))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk7d" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk7d"><span class="nb">econstructor</span>; <span class="nb">intros</span> r; <span class="nb">apply</span> (fTf_Tf (it_eq_map E RY)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>itree E Y1 i</span></span></span><br><span><var>y</var><span class="hyp-type"><b>: </b><span>itree E Y2 i</span></span></span><br><span><var>i0</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E Y1 x</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E Y2 x</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i0</span></span></span><br><span><var>k0</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X1 (e_nxt x)</span></span></span><br><span><var>k3</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X2 (e_nxt x)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
gfp (it_eq_map E RX) (e_nxt r) (k0 r) (k3 r)</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : X1 i) (<span class="nv">x2</span> : X2 i),
RX i x1 x2 -&gt;
it_eqF E RY R i (observe (k1 i x1))
  (observe (k2 i x2))</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>e_rsp q</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(bindR_eq_map RX ¬∞ it_eq_T E RY (bindR_eq_map RX)) R
  (e_nxt r) (k1 =&lt;&lt; k0 r) 
  (k2 =&lt;&lt; k3 r)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">refine</span> (BindR (k_rel r) (<span class="kr">fun</span> <span class="nv">i</span> <span class="nv">_</span> <span class="nv">_</span> <span class="nv">r</span> =&gt; b_T (it_eq_map E RY) _ _ _ _ _ (v i _ _ r))).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><p>Up-to <tt class="docutils literal">bind</tt> is valid for weak bisimilarity.</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Program Definition</span> <span class="nf">bindR_w_map</span> {<span class="nv">X1</span> <span class="nv">X2</span> <span class="nv">Y1</span> <span class="nv">Y2</span>} (<span class="nv">RX</span> : rel·µ¢ X1 X2) : mon (rel·µ¢ (itree E Y1) (itree E Y2)) :=
    {| body S := bindR RX (@it_wbisim _ E _ _ RX) S ;
       Hbody _ _ H _ _ _ &#39;(BindR u v) := BindR u (<span class="kr">fun</span> <span class="nv">i</span> <span class="nv">_</span> <span class="nv">_</span> <span class="nv">r</span> =&gt; H _ _ _ (v i _ _ r)) |}.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk7e" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk7e"><span class="kn">Lemma</span> <span class="nf">it_wbisim_up2bind_t</span> {<span class="nv">X1</span> <span class="nv">X2</span> <span class="nv">Y1</span> <span class="nv">Y2</span>} <span class="nv">RX</span> <span class="nv">RY</span> :
    @bindR_w_map X1 X2 Y1 Y2 RX &lt;= it_wbisim_t E RY.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">bindR_w_map RX &lt;= it_wbisim_t E RY</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk7f" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk7f"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">bindR_w_map RX &lt;= it_wbisim_t E RY</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk80" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk80"><span class="nb">apply</span> Coinduction; <span class="nb">intros</span> R i x y [ ? ? ? ? ? u v].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E Y1 i</span></span></span><br><span><var>y</var><span class="hyp-type"><b>: </b><span>itree E Y2 i</span></span></span><br><span><var>i0</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E Y1 x</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E Y2 x</span></span></span><br><span><var>u</var><span class="hyp-type"><b>: </b><span>it_wbisim RX i0 t1 t2</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : X1 i) (<span class="nv">x2</span> : X2 i),
RX i x1 x2 -&gt;
it_wbisim_map E RY R i (k1 i x1) (k2 i x2)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">bT (it_wbisim_map E RY) (bindR_w_map RX) R i0
  (t1 &gt;&gt;= k1) (t2 &gt;&gt;= k2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk81" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk81"><span class="nb">unfold</span> it_wbisim <span class="kr">in</span> u; <span class="nb">apply</span> (gfp_fp (it_wbisim_map E RX)) <span class="kr">in</span> u.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E Y1 i</span></span></span><br><span><var>y</var><span class="hyp-type"><b>: </b><span>itree E Y2 i</span></span></span><br><span><var>i0</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E Y1 x</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E Y2 x</span></span></span><br><span><var>u</var><span class="hyp-type"><b>: </b><span>it_wbisim_map E RX (gfp (it_wbisim_map E RX)) i0
  t1 t2</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : X1 i) (<span class="nv">x2</span> : X2 i),
RX i x1 x2 -&gt;
it_wbisim_map E RY R i (k1 i x1) (k2 i x2)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">bT (it_wbisim_map E RY) (bindR_w_map RX) R i0
  (t1 &gt;&gt;= k1) (t2 &gt;&gt;= k2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk82" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk82"><span class="nb">cbn</span> <span class="kr">in</span> *; <span class="nb">cbv</span> [observe] <span class="kr">in</span> u.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E Y1 i</span></span></span><br><span><var>y</var><span class="hyp-type"><b>: </b><span>itree E Y2 i</span></span></span><br><span><var>i0</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E Y1 x</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E Y2 x</span></span></span><br><span><var>u</var><span class="hyp-type"><b>: </b><span>it_wbisimF E RX (gfp (it_wbisim_map E RX)) i0
  (_observe t1) (_observe t2)</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : X1 i) (<span class="nv">x2</span> : X2 i),
RX i x1 x2 -&gt;
it_wbisimF E RY R i (observe (k1 i x1))
  (observe (k2 i x2))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_wbisimF E RY (it_wbisim_T E RY (bindR_w_map RX) R)
  i0
  <span class="kr">match</span> _observe t1 <span class="kr">with</span>
  | RetF r =&gt; _observe (k1 i0 r)
  | TauF t =&gt; TauF (k1 =&lt;&lt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; k1 =&lt;&lt; k r)
  <span class="kr">end</span>
  <span class="kr">match</span> _observe t2 <span class="kr">with</span>
  | RetF r =&gt; _observe (k2 i0 r)
  | TauF t =&gt; TauF (k2 =&lt;&lt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; k2 =&lt;&lt; k r)
  <span class="kr">end</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk83" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk83"><span class="nb">destruct</span> u <span class="kr">as</span> [? ? r1 r2 rr]; <span class="nb">dependent destruction</span> rr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E Y1 i</span></span></span><br><span><var>y</var><span class="hyp-type"><b>: </b><span>itree E Y2 i</span></span></span><br><span><var>i0</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E Y1 x</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E Y2 x</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>X1 i0</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t1) (RetF r0)</span></span></span><br><span><var>r3</var><span class="hyp-type"><b>: </b><span>X2 i0</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t2) (RetF r3)</span></span></span><br><span><var>r_rel</var><span class="hyp-type"><b>: </b><span>RX i0 r0 r3</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : X1 i) (<span class="nv">x2</span> : X2 i),
RX i x1 x2 -&gt;
it_wbisimF E RY R i (observe (k1 i x1))
  (observe (k2 i x2))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_wbisimF E RY (it_wbisim_T E RY (bindR_w_map RX) R)
  i0
  <span class="kr">match</span> _observe t1 <span class="kr">with</span>
  | RetF r =&gt; _observe (k1 i0 r)
  | TauF t =&gt; TauF (k1 =&lt;&lt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; k1 =&lt;&lt; k r)
  <span class="kr">end</span>
  <span class="kr">match</span> _observe t2 <span class="kr">with</span>
  | RetF r =&gt; _observe (k2 i0 r)
  | TauF t =&gt; TauF (k2 =&lt;&lt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; k2 =&lt;&lt; k r)
  <span class="kr">end</span></div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="properties-v-chk84" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E Y1 i</span></span></span><br><span><var>y</var><span class="hyp-type"><b>: </b><span>itree E Y2 i</span></span></span><br><span><var>i0</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E Y1 x</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E Y2 x</span></span></span><br><span><var>t0</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t1) (TauF t0)</span></span></span><br><span><var>t3</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t2) (TauF t3)</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>gfp (it_wbisim_map E RX) i0 t0 t3</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : X1 i) (<span class="nv">x2</span> : X2 i),
RX i x1 x2 -&gt;
it_wbisimF E RY R i (observe (k1 i x1))
  (observe (k2 i x2))</span></span></span><br></div><label class="goal-separator" for="properties-v-chk84"><hr></label><div class="goal-conclusion">it_wbisimF E RY (it_wbisim_T E RY (bindR_w_map RX) R)
  i0
  <span class="kr">match</span> _observe t1 <span class="kr">with</span>
  | RetF r =&gt; _observe (k1 i0 r)
  | TauF t =&gt; TauF (k1 =&lt;&lt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; k1 =&lt;&lt; k r)
  <span class="kr">end</span>
  <span class="kr">match</span> _observe t2 <span class="kr">with</span>
  | RetF r =&gt; _observe (k2 i0 r)
  | TauF t =&gt; TauF (k2 =&lt;&lt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; k2 =&lt;&lt; k r)
  <span class="kr">end</span></div></blockquote><input class="alectryon-extra-goal-toggle" id="properties-v-chk85" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E Y1 i</span></span></span><br><span><var>y</var><span class="hyp-type"><b>: </b><span>itree E Y2 i</span></span></span><br><span><var>i0</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E Y1 x</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E Y2 x</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i0</span></span></span><br><span><var>k0</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X1 (e_nxt x)</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t1) (VisF q k0)</span></span></span><br><span><var>k3</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X2 (e_nxt x)</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t2) (VisF q k3)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
gfp (it_wbisim_map E RX) 
  (e_nxt r) (k0 r) (k3 r)</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : X1 i) (<span class="nv">x2</span> : X2 i),
RX i x1 x2 -&gt;
it_wbisimF E RY R i (observe (k1 i x1))
  (observe (k2 i x2))</span></span></span><br></div><label class="goal-separator" for="properties-v-chk85"><hr></label><div class="goal-conclusion">it_wbisimF E RY (it_wbisim_T E RY (bindR_w_map RX) R)
  i0
  <span class="kr">match</span> _observe t1 <span class="kr">with</span>
  | RetF r =&gt; _observe (k1 i0 r)
  | TauF t =&gt; TauF (k1 =&lt;&lt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; k1 =&lt;&lt; k r)
  <span class="kr">end</span>
  <span class="kr">match</span> _observe t2 <span class="kr">with</span>
  | RetF r =&gt; _observe (k2 i0 r)
  | TauF t =&gt; TauF (k2 =&lt;&lt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; k2 =&lt;&lt; k r)
  <span class="kr">end</span></div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk86" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk86">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E Y1 i</span></span></span><br><span><var>y</var><span class="hyp-type"><b>: </b><span>itree E Y2 i</span></span></span><br><span><var>i0</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E Y1 x</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E Y2 x</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>X1 i0</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t1) (RetF r0)</span></span></span><br><span><var>r3</var><span class="hyp-type"><b>: </b><span>X2 i0</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t2) (RetF r3)</span></span></span><br><span><var>r_rel</var><span class="hyp-type"><b>: </b><span>RX i0 r0 r3</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : X1 i) (<span class="nv">x2</span> : X2 i),
RX i x1 x2 -&gt;
it_wbisimF E RY R i (observe (k1 i x1))
  (observe (k2 i x2))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_wbisimF E RY (it_wbisim_T E RY (bindR_w_map RX) R)
  i0
  <span class="kr">match</span> _observe t1 <span class="kr">with</span>
  | RetF r =&gt; _observe (k1 i0 r)
  | TauF t =&gt; TauF (k1 =&lt;&lt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; k1 =&lt;&lt; k r)
  <span class="kr">end</span>
  <span class="kr">match</span> _observe t2 <span class="kr">with</span>
  | RetF r =&gt; _observe (k2 i0 r)
  | TauF t =&gt; TauF (k2 =&lt;&lt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; k2 =&lt;&lt; k r)
  <span class="kr">end</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk87" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk87"><span class="nb">destruct</span> (v _ _ _ r_rel) <span class="kr">as</span> [ ? ? s1 s2 ss]; <span class="nb">econstructor</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E Y1 i</span></span></span><br><span><var>y</var><span class="hyp-type"><b>: </b><span>itree E Y2 i</span></span></span><br><span><var>i0</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E Y1 x</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E Y2 x</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>X1 i0</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t1) (RetF r0)</span></span></span><br><span><var>r3</var><span class="hyp-type"><b>: </b><span>X2 i0</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t2) (RetF r3)</span></span></span><br><span><var>r_rel</var><span class="hyp-type"><b>: </b><span>RX i0 r0 r3</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : X1 i) (<span class="nv">x2</span> : X2 i),
RX i x1 x2 -&gt;
it_wbisimF E RY R i (observe (k1 i x1))
  (observe (k2 i x2))</span></span></span><br><span><var>x1</var><span class="hyp-type"><b>: </b><span>itree&#39; E Y1 i0</span></span></span><br><span><var>x2</var><span class="hyp-type"><b>: </b><span>itree&#39; E Y2 i0</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>it_eat i0 (observe (k1 i0 r0)) x1</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>it_eat i0 (observe (k2 i0 r3)) x2</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>it_eqF E RY R i0 x1 x2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eat i0
  <span class="kr">match</span> _observe t1 <span class="kr">with</span>
  | RetF r =&gt; _observe (k1 i0 r)
  | TauF t =&gt; TauF (k1 =&lt;&lt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; k1 =&lt;&lt; k r)
  <span class="kr">end</span> <span class="nl">?x1</span></div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="properties-v-chk88" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E Y1 i</span></span></span><br><span><var>y</var><span class="hyp-type"><b>: </b><span>itree E Y2 i</span></span></span><br><span><var>i0</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E Y1 x</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E Y2 x</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>X1 i0</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t1) (RetF r0)</span></span></span><br><span><var>r3</var><span class="hyp-type"><b>: </b><span>X2 i0</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t2) (RetF r3)</span></span></span><br><span><var>r_rel</var><span class="hyp-type"><b>: </b><span>RX i0 r0 r3</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : X1 i) (<span class="nv">x2</span> : X2 i),
RX i x1 x2 -&gt;
it_wbisimF E RY R i (observe (k1 i x1))
  (observe (k2 i x2))</span></span></span><br><span><var>x1</var><span class="hyp-type"><b>: </b><span>itree&#39; E Y1 i0</span></span></span><br><span><var>x2</var><span class="hyp-type"><b>: </b><span>itree&#39; E Y2 i0</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>it_eat i0 (observe (k1 i0 r0)) x1</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>it_eat i0 (observe (k2 i0 r3)) x2</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>it_eqF E RY R i0 x1 x2</span></span></span><br></div><label class="goal-separator" for="properties-v-chk88"><hr></label><div class="goal-conclusion">it_eat i0
  <span class="kr">match</span> _observe t2 <span class="kr">with</span>
  | RetF r =&gt; _observe (k2 i0 r)
  | TauF t =&gt; TauF (k2 =&lt;&lt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; k2 =&lt;&lt; k r)
  <span class="kr">end</span> <span class="nl">?x2</span></div></blockquote><input class="alectryon-extra-goal-toggle" id="properties-v-chk89" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E Y1 i</span></span></span><br><span><var>y</var><span class="hyp-type"><b>: </b><span>itree E Y2 i</span></span></span><br><span><var>i0</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E Y1 x</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E Y2 x</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>X1 i0</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t1) (RetF r0)</span></span></span><br><span><var>r3</var><span class="hyp-type"><b>: </b><span>X2 i0</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t2) (RetF r3)</span></span></span><br><span><var>r_rel</var><span class="hyp-type"><b>: </b><span>RX i0 r0 r3</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : X1 i) (<span class="nv">x2</span> : X2 i),
RX i x1 x2 -&gt;
it_wbisimF E RY R i (observe (k1 i x1))
  (observe (k2 i x2))</span></span></span><br><span><var>x1</var><span class="hyp-type"><b>: </b><span>itree&#39; E Y1 i0</span></span></span><br><span><var>x2</var><span class="hyp-type"><b>: </b><span>itree&#39; E Y2 i0</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>it_eat i0 (observe (k1 i0 r0)) x1</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>it_eat i0 (observe (k2 i0 r3)) x2</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>it_eqF E RY R i0 x1 x2</span></span></span><br></div><label class="goal-separator" for="properties-v-chk89"><hr></label><div class="goal-conclusion">it_eqF E RY (it_wbisim_T E RY (bindR_w_map RX) R) i0
  <span class="nl">?x1</span> <span class="nl">?x2</span></div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk8a" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk8a"><span class="nb">etransitivity</span>; [ <span class="bp">exact</span> (subst_eat _ _ (Ret&#39; _) r1) | <span class="bp">exact</span> s1 ].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E Y1 i</span></span></span><br><span><var>y</var><span class="hyp-type"><b>: </b><span>itree E Y2 i</span></span></span><br><span><var>i0</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E Y1 x</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E Y2 x</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>X1 i0</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t1) (RetF r0)</span></span></span><br><span><var>r3</var><span class="hyp-type"><b>: </b><span>X2 i0</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t2) (RetF r3)</span></span></span><br><span><var>r_rel</var><span class="hyp-type"><b>: </b><span>RX i0 r0 r3</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : X1 i) (<span class="nv">x2</span> : X2 i),
RX i x1 x2 -&gt;
it_wbisimF E RY R i (observe (k1 i x1))
  (observe (k2 i x2))</span></span></span><br><span><var>x1</var><span class="hyp-type"><b>: </b><span>itree&#39; E Y1 i0</span></span></span><br><span><var>x2</var><span class="hyp-type"><b>: </b><span>itree&#39; E Y2 i0</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>it_eat i0 (observe (k1 i0 r0)) x1</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>it_eat i0 (observe (k2 i0 r3)) x2</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>it_eqF E RY R i0 x1 x2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eat i0
  <span class="kr">match</span> _observe t2 <span class="kr">with</span>
  | RetF r =&gt; _observe (k2 i0 r)
  | TauF t =&gt; TauF (k2 =&lt;&lt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; k2 =&lt;&lt; k r)
  <span class="kr">end</span> <span class="nl">?x2</span></div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="properties-v-chk8b" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E Y1 i</span></span></span><br><span><var>y</var><span class="hyp-type"><b>: </b><span>itree E Y2 i</span></span></span><br><span><var>i0</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E Y1 x</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E Y2 x</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>X1 i0</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t1) (RetF r0)</span></span></span><br><span><var>r3</var><span class="hyp-type"><b>: </b><span>X2 i0</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t2) (RetF r3)</span></span></span><br><span><var>r_rel</var><span class="hyp-type"><b>: </b><span>RX i0 r0 r3</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : X1 i) (<span class="nv">x2</span> : X2 i),
RX i x1 x2 -&gt;
it_wbisimF E RY R i (observe (k1 i x1))
  (observe (k2 i x2))</span></span></span><br><span><var>x1</var><span class="hyp-type"><b>: </b><span>itree&#39; E Y1 i0</span></span></span><br><span><var>x2</var><span class="hyp-type"><b>: </b><span>itree&#39; E Y2 i0</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>it_eat i0 (observe (k1 i0 r0)) x1</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>it_eat i0 (observe (k2 i0 r3)) x2</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>it_eqF E RY R i0 x1 x2</span></span></span><br></div><label class="goal-separator" for="properties-v-chk8b"><hr></label><div class="goal-conclusion">it_eqF E RY (it_wbisim_T E RY (bindR_w_map RX) R) i0
  x1 <span class="nl">?x2</span></div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk8c" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk8c"><span class="nb">etransitivity</span>; [ <span class="bp">exact</span> (subst_eat _ _ (Ret&#39; _) r2) | <span class="bp">exact</span> s2 ].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E Y1 i</span></span></span><br><span><var>y</var><span class="hyp-type"><b>: </b><span>itree E Y2 i</span></span></span><br><span><var>i0</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E Y1 x</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E Y2 x</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>X1 i0</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t1) (RetF r0)</span></span></span><br><span><var>r3</var><span class="hyp-type"><b>: </b><span>X2 i0</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t2) (RetF r3)</span></span></span><br><span><var>r_rel</var><span class="hyp-type"><b>: </b><span>RX i0 r0 r3</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : X1 i) (<span class="nv">x2</span> : X2 i),
RX i x1 x2 -&gt;
it_wbisimF E RY R i (observe (k1 i x1))
  (observe (k2 i x2))</span></span></span><br><span><var>x1</var><span class="hyp-type"><b>: </b><span>itree&#39; E Y1 i0</span></span></span><br><span><var>x2</var><span class="hyp-type"><b>: </b><span>itree&#39; E Y2 i0</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>it_eat i0 (observe (k1 i0 r0)) x1</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>it_eat i0 (observe (k2 i0 r3)) x2</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>it_eqF E RY R i0 x1 x2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eqF E RY (it_wbisim_T E RY (bindR_w_map RX) R) i0
  x1 x2</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">now</span> <span class="nb">apply</span> (it_eqF_mon _ _ (id_T _ _ R)).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">   </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk8d" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk8d">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E Y1 i</span></span></span><br><span><var>y</var><span class="hyp-type"><b>: </b><span>itree E Y2 i</span></span></span><br><span><var>i0</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E Y1 x</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E Y2 x</span></span></span><br><span><var>t0</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t1) (TauF t0)</span></span></span><br><span><var>t3</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t2) (TauF t3)</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>gfp (it_wbisim_map E RX) i0 t0 t3</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : X1 i) (<span class="nv">x2</span> : X2 i),
RX i x1 x2 -&gt;
it_wbisimF E RY R i (observe (k1 i x1))
  (observe (k2 i x2))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_wbisimF E RY (it_wbisim_T E RY (bindR_w_map RX) R)
  i0
  <span class="kr">match</span> _observe t1 <span class="kr">with</span>
  | RetF r =&gt; _observe (k1 i0 r)
  | TauF t =&gt; TauF (k1 =&lt;&lt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; k1 =&lt;&lt; k r)
  <span class="kr">end</span>
  <span class="kr">match</span> _observe t2 <span class="kr">with</span>
  | RetF r =&gt; _observe (k2 i0 r)
  | TauF t =&gt; TauF (k2 =&lt;&lt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; k2 =&lt;&lt; k r)
  <span class="kr">end</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk8e" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk8e"><span class="nb">econstructor</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E Y1 i</span></span></span><br><span><var>y</var><span class="hyp-type"><b>: </b><span>itree E Y2 i</span></span></span><br><span><var>i0</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E Y1 x</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E Y2 x</span></span></span><br><span><var>t0</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t1) (TauF t0)</span></span></span><br><span><var>t3</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t2) (TauF t3)</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>gfp (it_wbisim_map E RX) i0 t0 t3</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : X1 i) (<span class="nv">x2</span> : X2 i),
RX i x1 x2 -&gt;
it_wbisimF E RY R i (observe (k1 i x1))
  (observe (k2 i x2))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eat i0
  <span class="kr">match</span> _observe t1 <span class="kr">with</span>
  | RetF r =&gt; _observe (k1 i0 r)
  | TauF t =&gt; TauF (k1 =&lt;&lt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; k1 =&lt;&lt; k r)
  <span class="kr">end</span> <span class="nl">?x1</span></div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="properties-v-chk8f" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E Y1 i</span></span></span><br><span><var>y</var><span class="hyp-type"><b>: </b><span>itree E Y2 i</span></span></span><br><span><var>i0</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E Y1 x</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E Y2 x</span></span></span><br><span><var>t0</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t1) (TauF t0)</span></span></span><br><span><var>t3</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t2) (TauF t3)</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>gfp (it_wbisim_map E RX) i0 t0 t3</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : X1 i) (<span class="nv">x2</span> : X2 i),
RX i x1 x2 -&gt;
it_wbisimF E RY R i (observe (k1 i x1))
  (observe (k2 i x2))</span></span></span><br></div><label class="goal-separator" for="properties-v-chk8f"><hr></label><div class="goal-conclusion">it_eat i0
  <span class="kr">match</span> _observe t2 <span class="kr">with</span>
  | RetF r =&gt; _observe (k2 i0 r)
  | TauF t =&gt; TauF (k2 =&lt;&lt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; k2 =&lt;&lt; k r)
  <span class="kr">end</span> <span class="nl">?x2</span></div></blockquote><input class="alectryon-extra-goal-toggle" id="properties-v-chk90" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E Y1 i</span></span></span><br><span><var>y</var><span class="hyp-type"><b>: </b><span>itree E Y2 i</span></span></span><br><span><var>i0</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E Y1 x</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E Y2 x</span></span></span><br><span><var>t0</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t1) (TauF t0)</span></span></span><br><span><var>t3</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t2) (TauF t3)</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>gfp (it_wbisim_map E RX) i0 t0 t3</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : X1 i) (<span class="nv">x2</span> : X2 i),
RX i x1 x2 -&gt;
it_wbisimF E RY R i (observe (k1 i x1))
  (observe (k2 i x2))</span></span></span><br></div><label class="goal-separator" for="properties-v-chk90"><hr></label><div class="goal-conclusion">it_eqF E RY (it_wbisim_T E RY (bindR_w_map RX) R) i0
  <span class="nl">?x1</span> <span class="nl">?x2</span></div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">     </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk91" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk91"><span class="bp">exact</span> (subst_eat _ _ (Tau&#39; _) r1).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E Y1 i</span></span></span><br><span><var>y</var><span class="hyp-type"><b>: </b><span>itree E Y2 i</span></span></span><br><span><var>i0</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E Y1 x</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E Y2 x</span></span></span><br><span><var>t0</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t1) (TauF t0)</span></span></span><br><span><var>t3</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t2) (TauF t3)</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>gfp (it_wbisim_map E RX) i0 t0 t3</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : X1 i) (<span class="nv">x2</span> : X2 i),
RX i x1 x2 -&gt;
it_wbisimF E RY R i (observe (k1 i x1))
  (observe (k2 i x2))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eat i0
  <span class="kr">match</span> _observe t2 <span class="kr">with</span>
  | RetF r =&gt; _observe (k2 i0 r)
  | TauF t =&gt; TauF (k2 =&lt;&lt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; k2 =&lt;&lt; k r)
  <span class="kr">end</span> <span class="nl">?x2</span></div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="properties-v-chk92" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E Y1 i</span></span></span><br><span><var>y</var><span class="hyp-type"><b>: </b><span>itree E Y2 i</span></span></span><br><span><var>i0</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E Y1 x</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E Y2 x</span></span></span><br><span><var>t0</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t1) (TauF t0)</span></span></span><br><span><var>t3</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t2) (TauF t3)</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>gfp (it_wbisim_map E RX) i0 t0 t3</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : X1 i) (<span class="nv">x2</span> : X2 i),
RX i x1 x2 -&gt;
it_wbisimF E RY R i (observe (k1 i x1))
  (observe (k2 i x2))</span></span></span><br></div><label class="goal-separator" for="properties-v-chk92"><hr></label><div class="goal-conclusion">it_eqF E RY (it_wbisim_T E RY (bindR_w_map RX) R) i0
  (_observe (k1 =&lt;&lt; Tau&#39; t0)) 
  <span class="nl">?x2</span></div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">     </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk93" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk93"><span class="bp">exact</span> (subst_eat _ _ (Tau&#39; _) r2).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E Y1 i</span></span></span><br><span><var>y</var><span class="hyp-type"><b>: </b><span>itree E Y2 i</span></span></span><br><span><var>i0</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E Y1 x</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E Y2 x</span></span></span><br><span><var>t0</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t1) (TauF t0)</span></span></span><br><span><var>t3</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t2) (TauF t3)</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>gfp (it_wbisim_map E RX) i0 t0 t3</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : X1 i) (<span class="nv">x2</span> : X2 i),
RX i x1 x2 -&gt;
it_wbisimF E RY R i (observe (k1 i x1))
  (observe (k2 i x2))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eqF E RY (it_wbisim_T E RY (bindR_w_map RX) R) i0
  (_observe (k1 =&lt;&lt; Tau&#39; t0))
  (_observe (k2 =&lt;&lt; Tau&#39; t3))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">     </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk94" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk94"><span class="nb">cbn</span>; <span class="nb">econstructor</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E Y1 i</span></span></span><br><span><var>y</var><span class="hyp-type"><b>: </b><span>itree E Y2 i</span></span></span><br><span><var>i0</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E Y1 x</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E Y2 x</span></span></span><br><span><var>t0</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t1) (TauF t0)</span></span></span><br><span><var>t3</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t2) (TauF t3)</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>gfp (it_wbisim_map E RX) i0 t0 t3</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : X1 i) (<span class="nv">x2</span> : X2 i),
RX i x1 x2 -&gt;
it_wbisimF E RY R i (observe (k1 i x1))
  (observe (k2 i x2))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_wbisim_T E RY (bindR_w_map RX) R i0 
  (k1 =&lt;&lt; t0) (k2 =&lt;&lt; t3)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">     </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk95" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk95"><span class="nb">apply</span> (fTf_Tf (it_wbisim_map E RY)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E Y1 i</span></span></span><br><span><var>y</var><span class="hyp-type"><b>: </b><span>itree E Y2 i</span></span></span><br><span><var>i0</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E Y1 x</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E Y2 x</span></span></span><br><span><var>t0</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t1) (TauF t0)</span></span></span><br><span><var>t3</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t2) (TauF t3)</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>gfp (it_wbisim_map E RX) i0 t0 t3</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : X1 i) (<span class="nv">x2</span> : X2 i),
RX i x1 x2 -&gt;
it_wbisimF E RY R i (observe (k1 i x1))
  (observe (k2 i x2))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(bindR_w_map RX ¬∞ it_wbisim_T E RY (bindR_w_map RX)) R
  i0 (k1 =&lt;&lt; t0) (k2 =&lt;&lt; t3)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">     </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">econstructor</span>; [ <span class="nb">apply</span> t_rel | <span class="nb">intros</span>; <span class="bp">now</span> <span class="nb">apply</span> (b_T (it_wbisim_map E RY)), v ].</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">   </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk96" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk96">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E Y1 i</span></span></span><br><span><var>y</var><span class="hyp-type"><b>: </b><span>itree E Y2 i</span></span></span><br><span><var>i0</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E Y1 x</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E Y2 x</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i0</span></span></span><br><span><var>k0</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X1 (e_nxt x)</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t1) (VisF q k0)</span></span></span><br><span><var>k3</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X2 (e_nxt x)</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t2) (VisF q k3)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
gfp (it_wbisim_map E RX) 
  (e_nxt r) (k0 r) (k3 r)</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : X1 i) (<span class="nv">x2</span> : X2 i),
RX i x1 x2 -&gt;
it_wbisimF E RY R i (observe (k1 i x1))
  (observe (k2 i x2))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_wbisimF E RY (it_wbisim_T E RY (bindR_w_map RX) R)
  i0
  <span class="kr">match</span> _observe t1 <span class="kr">with</span>
  | RetF r =&gt; _observe (k1 i0 r)
  | TauF t =&gt; TauF (k1 =&lt;&lt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; k1 =&lt;&lt; k r)
  <span class="kr">end</span>
  <span class="kr">match</span> _observe t2 <span class="kr">with</span>
  | RetF r =&gt; _observe (k2 i0 r)
  | TauF t =&gt; TauF (k2 =&lt;&lt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; k2 =&lt;&lt; k r)
  <span class="kr">end</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk97" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk97"><span class="nb">econstructor</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E Y1 i</span></span></span><br><span><var>y</var><span class="hyp-type"><b>: </b><span>itree E Y2 i</span></span></span><br><span><var>i0</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E Y1 x</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E Y2 x</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i0</span></span></span><br><span><var>k0</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X1 (e_nxt x)</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t1) (VisF q k0)</span></span></span><br><span><var>k3</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X2 (e_nxt x)</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t2) (VisF q k3)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
gfp (it_wbisim_map E RX) 
  (e_nxt r) (k0 r) (k3 r)</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : X1 i) (<span class="nv">x2</span> : X2 i),
RX i x1 x2 -&gt;
it_wbisimF E RY R i (observe (k1 i x1))
  (observe (k2 i x2))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eat i0
  <span class="kr">match</span> _observe t1 <span class="kr">with</span>
  | RetF r =&gt; _observe (k1 i0 r)
  | TauF t =&gt; TauF (k1 =&lt;&lt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; k1 =&lt;&lt; k r)
  <span class="kr">end</span> <span class="nl">?x1</span></div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="properties-v-chk98" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E Y1 i</span></span></span><br><span><var>y</var><span class="hyp-type"><b>: </b><span>itree E Y2 i</span></span></span><br><span><var>i0</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E Y1 x</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E Y2 x</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i0</span></span></span><br><span><var>k0</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X1 (e_nxt x)</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t1) (VisF q k0)</span></span></span><br><span><var>k3</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X2 (e_nxt x)</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t2) (VisF q k3)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
gfp (it_wbisim_map E RX) 
  (e_nxt r) (k0 r) (k3 r)</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : X1 i) (<span class="nv">x2</span> : X2 i),
RX i x1 x2 -&gt;
it_wbisimF E RY R i (observe (k1 i x1))
  (observe (k2 i x2))</span></span></span><br></div><label class="goal-separator" for="properties-v-chk98"><hr></label><div class="goal-conclusion">it_eat i0
  <span class="kr">match</span> _observe t2 <span class="kr">with</span>
  | RetF r =&gt; _observe (k2 i0 r)
  | TauF t =&gt; TauF (k2 =&lt;&lt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; k2 =&lt;&lt; k r)
  <span class="kr">end</span> <span class="nl">?x2</span></div></blockquote><input class="alectryon-extra-goal-toggle" id="properties-v-chk99" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E Y1 i</span></span></span><br><span><var>y</var><span class="hyp-type"><b>: </b><span>itree E Y2 i</span></span></span><br><span><var>i0</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E Y1 x</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E Y2 x</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i0</span></span></span><br><span><var>k0</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X1 (e_nxt x)</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t1) (VisF q k0)</span></span></span><br><span><var>k3</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X2 (e_nxt x)</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t2) (VisF q k3)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
gfp (it_wbisim_map E RX) 
  (e_nxt r) (k0 r) (k3 r)</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : X1 i) (<span class="nv">x2</span> : X2 i),
RX i x1 x2 -&gt;
it_wbisimF E RY R i (observe (k1 i x1))
  (observe (k2 i x2))</span></span></span><br></div><label class="goal-separator" for="properties-v-chk99"><hr></label><div class="goal-conclusion">it_eqF E RY (it_wbisim_T E RY (bindR_w_map RX) R) i0
  <span class="nl">?x1</span> <span class="nl">?x2</span></div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">     </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk9a" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk9a"><span class="bp">exact</span> (subst_eat _ _ (Vis&#39; _ _) r1).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E Y1 i</span></span></span><br><span><var>y</var><span class="hyp-type"><b>: </b><span>itree E Y2 i</span></span></span><br><span><var>i0</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E Y1 x</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E Y2 x</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i0</span></span></span><br><span><var>k0</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X1 (e_nxt x)</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t1) (VisF q k0)</span></span></span><br><span><var>k3</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X2 (e_nxt x)</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t2) (VisF q k3)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
gfp (it_wbisim_map E RX) 
  (e_nxt r) (k0 r) (k3 r)</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : X1 i) (<span class="nv">x2</span> : X2 i),
RX i x1 x2 -&gt;
it_wbisimF E RY R i (observe (k1 i x1))
  (observe (k2 i x2))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eat i0
  <span class="kr">match</span> _observe t2 <span class="kr">with</span>
  | RetF r =&gt; _observe (k2 i0 r)
  | TauF t =&gt; TauF (k2 =&lt;&lt; t)
  | VisF e k =&gt; VisF e (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt; k2 =&lt;&lt; k r)
  <span class="kr">end</span> <span class="nl">?x2</span></div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="properties-v-chk9b" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E Y1 i</span></span></span><br><span><var>y</var><span class="hyp-type"><b>: </b><span>itree E Y2 i</span></span></span><br><span><var>i0</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E Y1 x</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E Y2 x</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i0</span></span></span><br><span><var>k0</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X1 (e_nxt x)</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t1) (VisF q k0)</span></span></span><br><span><var>k3</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X2 (e_nxt x)</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t2) (VisF q k3)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
gfp (it_wbisim_map E RX) 
  (e_nxt r) (k0 r) (k3 r)</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : X1 i) (<span class="nv">x2</span> : X2 i),
RX i x1 x2 -&gt;
it_wbisimF E RY R i (observe (k1 i x1))
  (observe (k2 i x2))</span></span></span><br></div><label class="goal-separator" for="properties-v-chk9b"><hr></label><div class="goal-conclusion">it_eqF E RY (it_wbisim_T E RY (bindR_w_map RX) R) i0
  (_observe (k1 =&lt;&lt; Vis&#39; q k0)) 
  <span class="nl">?x2</span></div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">     </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk9c" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk9c"><span class="bp">exact</span> (subst_eat _ _ (Vis&#39; _ _) r2).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E Y1 i</span></span></span><br><span><var>y</var><span class="hyp-type"><b>: </b><span>itree E Y2 i</span></span></span><br><span><var>i0</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E Y1 x</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E Y2 x</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i0</span></span></span><br><span><var>k0</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X1 (e_nxt x)</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t1) (VisF q k0)</span></span></span><br><span><var>k3</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X2 (e_nxt x)</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t2) (VisF q k3)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
gfp (it_wbisim_map E RX) 
  (e_nxt r) (k0 r) (k3 r)</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : X1 i) (<span class="nv">x2</span> : X2 i),
RX i x1 x2 -&gt;
it_wbisimF E RY R i (observe (k1 i x1))
  (observe (k2 i x2))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eqF E RY (it_wbisim_T E RY (bindR_w_map RX) R) i0
  (_observe (k1 =&lt;&lt; Vis&#39; q k0))
  (_observe (k2 =&lt;&lt; Vis&#39; q k3))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">     </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk9d" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk9d"><span class="nb">cbn</span>; <span class="nb">econstructor</span>; <span class="nb">intro</span> r.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E Y1 i</span></span></span><br><span><var>y</var><span class="hyp-type"><b>: </b><span>itree E Y2 i</span></span></span><br><span><var>i0</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E Y1 x</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E Y2 x</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i0</span></span></span><br><span><var>k0</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X1 (e_nxt x)</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t1) (VisF q k0)</span></span></span><br><span><var>k3</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X2 (e_nxt x)</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t2) (VisF q k3)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
gfp (it_wbisim_map E RX) 
  (e_nxt r) (k0 r) (k3 r)</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : X1 i) (<span class="nv">x2</span> : X2 i),
RX i x1 x2 -&gt;
it_wbisimF E RY R i (observe (k1 i x1))
  (observe (k2 i x2))</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>e_rsp q</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_wbisim_T E RY (bindR_w_map RX) R 
  (e_nxt r) (k1 =&lt;&lt; k0 r) 
  (k2 =&lt;&lt; k3 r)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">     </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk9e" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk9e"><span class="nb">apply</span> (fTf_Tf (it_wbisim_map E RY)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>itree E Y1 i</span></span></span><br><span><var>y</var><span class="hyp-type"><b>: </b><span>itree E Y2 i</span></span></span><br><span><var>i0</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E X1 i0</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E X2 i0</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E Y1 x</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E Y2 x</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i0</span></span></span><br><span><var>k0</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X1 (e_nxt x)</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t1) (VisF q k0)</span></span></span><br><span><var>k3</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E X2 (e_nxt x)</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i0 (_observe t2) (VisF q k3)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
gfp (it_wbisim_map E RX) 
  (e_nxt r) (k0 r) (k3 r)</span></span></span><br><span><var>v</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : X1 i) (<span class="nv">x2</span> : X2 i),
RX i x1 x2 -&gt;
it_wbisimF E RY R i (observe (k1 i x1))
  (observe (k2 i x2))</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>e_rsp q</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(bindR_w_map RX ¬∞ it_wbisim_T E RY (bindR_w_map RX)) R
  (e_nxt r) (k1 =&lt;&lt; k0 r) 
  (k2 =&lt;&lt; k3 r)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">     </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">econstructor</span>; [ <span class="nb">apply</span> k_rel | <span class="nb">intros</span>; <span class="bp">now</span> <span class="nb">apply</span> (b_T (it_wbisim_map E RY)), v ].</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp"> </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><p>Pointwise strongly bisimilar equations have strongly bisimilar iteration.</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chk9f" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chk9f"><span class="kn">Lemma</span> <span class="nf">iter_cong_strong</span> {<span class="nv">X1</span> <span class="nv">X2</span> <span class="nv">Y1</span> <span class="nv">Y2</span>} {<span class="nv">RX</span> : rel·µ¢ X1 X2} {<span class="nv">RY</span> : rel·µ¢ Y1 Y2}
    <span class="nv">f</span> <span class="nv">g</span> (<span class="nv">_</span> : <span class="kr">forall</span> <span class="nv">i</span> <span class="nv">a</span> <span class="nv">b</span>, RX i a b -&gt;  it_eq (sum·µ£ RX RY) (f i a) (g i b)) :
    <span class="kr">forall</span> <span class="nv">i</span> <span class="nv">a</span> <span class="nv">b</span>, RX i a b -&gt; it_eq (E:=E) RY (iter f i a) (iter g i b).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt; it_eq (sum·µ£ RX RY) (f i a) (g i b)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt; it_eq RY (iter f i a) (iter g i b)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chka0" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chka0"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt; it_eq (sum·µ£ RX RY) (f i a) (g i b)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt; it_eq RY (iter f i a) (iter g i b)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chka1" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chka1"><span class="nb">unfold</span> it_eq; coinduction R CIH; <span class="nb">intros</span> i a b r.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt; it_eq (sum·µ£ RX RY) (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt; it_eq_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eq_bt E RY R i (iter f i a) (iter g i b)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chka2" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chka2"><span class="nb">pose</span> (h1 := H i a b r).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt; it_eq (sum·µ£ RX RY) (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt; it_eq_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>h1</var><span><span class="hyp-body"><b>:= </b><span>H i a b r</span></span><span class="hyp-type"><b>: </b><span>it_eq (sum·µ£ RX RY) (f i a) (g i b)</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eq_bt E RY R i (iter f i a) (iter g i b)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chka3" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chka3"><span class="nb">apply</span> it_eq_step <span class="kr">in</span> h1; <span class="nb">cbn</span> <span class="kr">in</span> *; <span class="nb">cbv</span> [observe] <span class="kr">in</span> h1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt; it_eq (sum·µ£ RX RY) (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt; it_eq_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>h1</var><span class="hyp-type"><b>: </b><span>it_eqF E (sum·µ£ RX RY) (it_eq (sum·µ£ RX RY)) i
  (_observe (f i a)) (_observe (g i b))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eqF E RY (it_eq_t E RY R) i
  <span class="kr">match</span> _observe (f i a) <span class="kr">with</span>
  | RetF (inl x) =&gt; TauF (iter f i x)
  | RetF (inr y) =&gt; RetF y
  | TauF t =&gt;
      TauF
        ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X1 +·µ¢ Y1) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r <span class="kr">with</span>
              | inl x =&gt; TauF (iter f i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; t)
  | VisF e k =&gt;
      VisF e
        (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt;
         (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X1 +·µ¢ Y1) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r0 <span class="kr">with</span>
              | inl x =&gt; TauF (iter f i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; k r)
  <span class="kr">end</span>
  <span class="kr">match</span> _observe (g i b) <span class="kr">with</span>
  | RetF (inl x) =&gt; TauF (iter g i x)
  | RetF (inr y) =&gt; RetF y
  | TauF t =&gt;
      TauF
        ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; t)
  | VisF e k =&gt;
      VisF e
        (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt;
         (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r0 <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; k r)
  <span class="kr">end</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chka4" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chka4"><span class="nb">dependent destruction</span> h1; simpl_depind.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt; it_eq (sum·µ£ RX RY) (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt; it_eq_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>(X1 +·µ¢ Y1) i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>(X2 +·µ¢ Y2) i</span></span></span><br><span><var>r_rel</var><span class="hyp-type"><b>: </b><span>sum·µ£ RX RY i r1 r2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eqF E RY (it_eq_t E RY R) i
  <span class="kr">match</span> r1 <span class="kr">with</span>
  | inl x =&gt; TauF (iter f i x)
  | inr y =&gt; RetF y
  <span class="kr">end</span>
  <span class="kr">match</span> r2 <span class="kr">with</span>
  | inl x =&gt; TauF (iter g i x)
  | inr y =&gt; RetF y
  <span class="kr">end</span></div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="properties-v-chka5" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt; it_eq (sum·µ£ RX RY) (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_eq_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E (X1 +·µ¢ Y1) i</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E (X2 +·µ¢ Y2) i</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>it_eq (sum·µ£ RX RY) t1 t2</span></span></span><br></div><label class="goal-separator" for="properties-v-chka5"><hr></label><div class="goal-conclusion">it_eqF E RY (it_eq_t E RY R) i
  (TauF
     ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X1 +·µ¢ Y1) i) =&gt;
       {|
         _observe :=
           <span class="kr">match</span> r <span class="kr">with</span>
           | inl x =&gt; TauF (iter f i x)
           | inr y =&gt; RetF y
           <span class="kr">end</span>
       |}) =&lt;&lt; t1))
  (TauF
     ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X2 +·µ¢ Y2) i) =&gt;
       {|
         _observe :=
           <span class="kr">match</span> r <span class="kr">with</span>
           | inl x =&gt; TauF (iter g i x)
           | inr y =&gt; RetF y
           <span class="kr">end</span>
       |}) =&lt;&lt; t2))</div></blockquote><input class="alectryon-extra-goal-toggle" id="properties-v-chka6" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt; it_eq (sum·µ£ RX RY) (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_eq_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E (X1 +·µ¢ Y1) (e_nxt x)</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E (X2 +·µ¢ Y2) (e_nxt x)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
it_eq (sum·µ£ RX RY) (k1 r) (k2 r)</span></span></span><br></div><label class="goal-separator" for="properties-v-chka6"><hr></label><div class="goal-conclusion">it_eqF E RY (it_eq_t E RY R) i
  (VisF q
     (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp q =&gt;
      (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X1 +·µ¢ Y1) i) =&gt;
       {|
         _observe :=
           <span class="kr">match</span> r0 <span class="kr">with</span>
           | inl x =&gt; TauF (iter f i x)
           | inr y =&gt; RetF y
           <span class="kr">end</span>
       |}) =&lt;&lt; k1 r))
  (VisF q
     (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp q =&gt;
      (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X2 +·µ¢ Y2) i) =&gt;
       {|
         _observe :=
           <span class="kr">match</span> r0 <span class="kr">with</span>
           | inl x =&gt; TauF (iter g i x)
           | inr y =&gt; RetF y
           <span class="kr">end</span>
       |}) =&lt;&lt; k2 r))</div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chka7" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chka7">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt; it_eq (sum·µ£ RX RY) (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_eq_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>(X1 +·µ¢ Y1) i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>(X2 +·µ¢ Y2) i</span></span></span><br><span><var>r_rel</var><span class="hyp-type"><b>: </b><span>sum·µ£ RX RY i r1 r2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eqF E RY (it_eq_t E RY R) i
  <span class="kr">match</span> r1 <span class="kr">with</span>
  | inl x =&gt; TauF (iter f i x)
  | inr y =&gt; RetF y
  <span class="kr">end</span>
  <span class="kr">match</span> r2 <span class="kr">with</span>
  | inl x =&gt; TauF (iter g i x)
  | inr y =&gt; RetF y
  <span class="kr">end</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">destruct</span> r_rel; <span class="nb">eauto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chka8" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chka8">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt; it_eq (sum·µ£ RX RY) (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_eq_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E (X1 +·µ¢ Y1) i</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E (X2 +·µ¢ Y2) i</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>it_eq (sum·µ£ RX RY) t1 t2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eqF E RY (it_eq_t E RY R) i
  (TauF
     ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X1 +·µ¢ Y1) i) =&gt;
       {|
         _observe :=
           <span class="kr">match</span> r <span class="kr">with</span>
           | inl x =&gt; TauF (iter f i x)
           | inr y =&gt; RetF y
           <span class="kr">end</span>
       |}) =&lt;&lt; t1))
  (TauF
     ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X2 +·µ¢ Y2) i) =&gt;
       {|
         _observe :=
           <span class="kr">match</span> r <span class="kr">with</span>
           | inl x =&gt; TauF (iter g i x)
           | inr y =&gt; RetF y
           <span class="kr">end</span>
       |}) =&lt;&lt; t2))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chka9" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chka9"><span class="nb">econstructor</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt; it_eq (sum·µ£ RX RY) (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_eq_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E (X1 +·µ¢ Y1) i</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E (X2 +·µ¢ Y2) i</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>it_eq (sum·µ£ RX RY) t1 t2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eq_t E RY R i
  ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X1 +·µ¢ Y1) i) =&gt;
    {|
      _observe :=
        <span class="kr">match</span> r <span class="kr">with</span>
        | inl x =&gt; TauF (iter f i x)
        | inr y =&gt; RetF y
        <span class="kr">end</span>
    |}) =&lt;&lt; t1)
  ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X2 +·µ¢ Y2) i) =&gt;
    {|
      _observe :=
        <span class="kr">match</span> r <span class="kr">with</span>
        | inl x =&gt; TauF (iter g i x)
        | inr y =&gt; RetF y
        <span class="kr">end</span>
    |}) =&lt;&lt; t2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkaa" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkaa"><span class="nb">apply</span> (tt_t (it_eq_map E _)); <span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt; it_eq (sum·µ£ RX RY) (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_eq_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E (X1 +·µ¢ Y1) i</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E (X2 +·µ¢ Y2) i</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>it_eq (sum·µ£ RX RY) t1 t2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eq_t E RY (it_eq_t E RY R) i
  ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X1 +·µ¢ Y1) i) =&gt;
    {|
      _observe :=
        <span class="kr">match</span> r <span class="kr">with</span>
        | inl x =&gt; TauF (iter f i x)
        | inr y =&gt; RetF y
        <span class="kr">end</span>
    |}) =&lt;&lt; t1)
  ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X2 +·µ¢ Y2) i) =&gt;
    {|
      _observe :=
        <span class="kr">match</span> r <span class="kr">with</span>
        | inl x =&gt; TauF (iter g i x)
        | inr y =&gt; RetF y
        <span class="kr">end</span>
    |}) =&lt;&lt; t2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkab" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkab"><span class="nb">apply</span> (it_eq_up2bind_t (sum·µ£ RX RY) RY); <span class="nb">econstructor</span>; <span class="nb">eauto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt; it_eq (sum·µ£ RX RY) (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_eq_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E (X1 +·µ¢ Y1) i</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E (X2 +·µ¢ Y2) i</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>it_eq (sum·µ£ RX RY) t1 t2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : (X1 +·µ¢ Y1) i) (<span class="nv">x2</span> : (X2 +·µ¢ Y2) i),
sum·µ£ RX RY i x1 x2 -&gt;
it_eq_t E RY R i
  {|
    _observe :=
      <span class="kr">match</span> x1 <span class="kr">with</span>
      | inl x =&gt; TauF (iter f i x)
      | inr y =&gt; RetF y
      <span class="kr">end</span>
  |}
  {|
    _observe :=
      <span class="kr">match</span> x2 <span class="kr">with</span>
      | inl x =&gt; TauF (iter g i x)
      | inr y =&gt; RetF y
      <span class="kr">end</span>
  |}</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">intros</span> ? ? ? []; <span class="nb">apply</span> (tt_t (it_eq_map E RY)), (b_t (it_eq_map E RY)); <span class="nb">cbn</span>; <span class="nb">eauto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkac" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkac">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt; it_eq (sum·µ£ RX RY) (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_eq_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E (X1 +·µ¢ Y1) (e_nxt x)</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E (X2 +·µ¢ Y2) (e_nxt x)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
it_eq (sum·µ£ RX RY) (k1 r) (k2 r)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eqF E RY (it_eq_t E RY R) i
  (VisF q
     (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp q =&gt;
      (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X1 +·µ¢ Y1) i) =&gt;
       {|
         _observe :=
           <span class="kr">match</span> r0 <span class="kr">with</span>
           | inl x =&gt; TauF (iter f i x)
           | inr y =&gt; RetF y
           <span class="kr">end</span>
       |}) =&lt;&lt; k1 r))
  (VisF q
     (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp q =&gt;
      (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X2 +·µ¢ Y2) i) =&gt;
       {|
         _observe :=
           <span class="kr">match</span> r0 <span class="kr">with</span>
           | inl x =&gt; TauF (iter g i x)
           | inr y =&gt; RetF y
           <span class="kr">end</span>
       |}) =&lt;&lt; k2 r))</div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkad" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkad"><span class="nb">econstructor</span>; <span class="nb">intro</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt; it_eq (sum·µ£ RX RY) (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_eq_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E (X1 +·µ¢ Y1) (e_nxt x)</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E (X2 +·µ¢ Y2) (e_nxt x)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
it_eq (sum·µ£ RX RY) (k1 r) (k2 r)</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>e_rsp q</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eq_t E RY R (e_nxt r0)
  ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X1 +·µ¢ Y1) i) =&gt;
    {|
      _observe :=
        <span class="kr">match</span> r <span class="kr">with</span>
        | inl x =&gt; TauF (iter f i x)
        | inr y =&gt; RetF y
        <span class="kr">end</span>
    |}) =&lt;&lt; k1 r0)
  ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X2 +·µ¢ Y2) i) =&gt;
    {|
      _observe :=
        <span class="kr">match</span> r <span class="kr">with</span>
        | inl x =&gt; TauF (iter g i x)
        | inr y =&gt; RetF y
        <span class="kr">end</span>
    |}) =&lt;&lt; k2 r0)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkae" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkae"><span class="nb">apply</span> (tt_t (it_eq_map E _)); <span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt; it_eq (sum·µ£ RX RY) (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_eq_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E (X1 +·µ¢ Y1) (e_nxt x)</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E (X2 +·µ¢ Y2) (e_nxt x)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
it_eq (sum·µ£ RX RY) (k1 r) (k2 r)</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>e_rsp q</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eq_t E RY (it_eq_t E RY R) 
  (e_nxt r0)
  ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X1 +·µ¢ Y1) i) =&gt;
    {|
      _observe :=
        <span class="kr">match</span> r <span class="kr">with</span>
        | inl x =&gt; TauF (iter f i x)
        | inr y =&gt; RetF y
        <span class="kr">end</span>
    |}) =&lt;&lt; k1 r0)
  ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X2 +·µ¢ Y2) i) =&gt;
    {|
      _observe :=
        <span class="kr">match</span> r <span class="kr">with</span>
        | inl x =&gt; TauF (iter g i x)
        | inr y =&gt; RetF y
        <span class="kr">end</span>
    |}) =&lt;&lt; k2 r0)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkaf" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkaf"><span class="nb">apply</span> (it_eq_up2bind_t (sum·µ£ RX RY) RY); <span class="nb">econstructor</span>; <span class="nb">eauto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt; it_eq (sum·µ£ RX RY) (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_eq_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E (X1 +·µ¢ Y1) (e_nxt x)</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E (X2 +·µ¢ Y2) (e_nxt x)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
it_eq (sum·µ£ RX RY) (k1 r) (k2 r)</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>e_rsp q</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : (X1 +·µ¢ Y1) i) (<span class="nv">x2</span> : (X2 +·µ¢ Y2) i),
sum·µ£ RX RY i x1 x2 -&gt;
it_eq_t E RY R i
  {|
    _observe :=
      <span class="kr">match</span> x1 <span class="kr">with</span>
      | inl x =&gt; TauF (iter f i x)
      | inr y =&gt; RetF y
      <span class="kr">end</span>
  |}
  {|
    _observe :=
      <span class="kr">match</span> x2 <span class="kr">with</span>
      | inl x =&gt; TauF (iter g i x)
      | inr y =&gt; RetF y
      <span class="kr">end</span>
  |}</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">intros</span> ? ? ? []; <span class="nb">apply</span> (bt_t (it_eq_map E RY)); <span class="nb">cbn</span>; <span class="nb">eauto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input">#[<span class="kn">global</span>] <span class="kn">Instance</span> <span class="nf">iter_proper_strong</span> {<span class="nv">X</span> <span class="nv">Y</span>} {<span class="nv">RX</span> : rel·µ¢ X X} {<span class="nv">RY</span> : rel·µ¢ Y Y} :
    Proper (dpointwise_relation (<span class="kr">fun</span> <span class="nv">i</span> =&gt; RX i ==&gt; it_eq (sum·µ£ RX RY) (i:=i))
              ==&gt; dpointwise_relation (<span class="kr">fun</span> <span class="nv">i</span> =&gt; RX i ==&gt; it_eq RY (i:=i)))
      (@iter I E X Y)
    := iter_cong_strong.</span></span></pre><p>Pointwise weakly bisimilar equations have weakly bisimilar iteration.</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkb0" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkb0"><span class="kn">Lemma</span> <span class="nf">iter_cong_weak</span> {<span class="nv">X1</span> <span class="nv">X2</span> <span class="nv">Y1</span> <span class="nv">Y2</span>} {<span class="nv">RX</span> : rel·µ¢ X1 X2} {<span class="nv">RY</span> : rel·µ¢ Y1 Y2}
    <span class="nv">f</span> <span class="nv">g</span> (<span class="nv">_</span> : <span class="kr">forall</span> <span class="nv">i</span> <span class="nv">a</span> <span class="nv">b</span>, RX i a b -&gt; it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)) :
    <span class="kr">forall</span> <span class="nv">i</span> <span class="nv">a</span> <span class="nv">b</span>, RX i a b -&gt; it_wbisim (E:=E) RY i (iter f i a) (iter g i b).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt; it_wbisim RY i (iter f i a) (iter g i b)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkb1" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkb1"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt; it_wbisim RY i (iter f i a) (iter g i b)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkb2" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkb2"><span class="nb">unfold</span> it_wbisim; coinduction R CIH; <span class="nb">intros</span> i a b r.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt; it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_wbisim_bt E RY R i (iter f i a) (iter g i b)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkb3" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkb3"><span class="nb">pose</span> (H1 := H i a b r).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt; it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>H1</var><span><span class="hyp-body"><b>:= </b><span>H i a b r</span></span><span class="hyp-type"><b>: </b><span>it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_wbisim_bt E RY R i (iter f i a) (iter g i b)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkb4" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkb4"><span class="nb">apply</span> it_wbisim_step <span class="kr">in</span> H1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt; it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>it_wbisim_map E (sum·µ£ RX RY)
  (it_wbisim (sum·µ£ RX RY)) i (f i a) (g i b)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_wbisim_bt E RY R i (iter f i a) (iter g i b)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkb5" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkb5"><span class="nb">cbn</span> <span class="kr">in</span> *; <span class="nb">cbv</span> [observe] <span class="kr">in</span> H1.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt; it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>H1</var><span class="hyp-type"><b>: </b><span>it_wbisimF E (sum·µ£ RX RY)
  (it_wbisim (sum·µ£ RX RY)) i (_observe (f i a))
  (_observe (g i b))</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_wbisimF E RY (it_wbisim_t E RY R) i
  <span class="kr">match</span> _observe (f i a) <span class="kr">with</span>
  | RetF (inl x) =&gt; TauF (iter f i x)
  | RetF (inr y) =&gt; RetF y
  | TauF t =&gt;
      TauF
        ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X1 +·µ¢ Y1) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r <span class="kr">with</span>
              | inl x =&gt; TauF (iter f i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; t)
  | VisF e k =&gt;
      VisF e
        (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt;
         (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X1 +·µ¢ Y1) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r0 <span class="kr">with</span>
              | inl x =&gt; TauF (iter f i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; k r)
  <span class="kr">end</span>
  <span class="kr">match</span> _observe (g i b) <span class="kr">with</span>
  | RetF (inl x) =&gt; TauF (iter g i x)
  | RetF (inr y) =&gt; RetF y
  | TauF t =&gt;
      TauF
        ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; t)
  | VisF e k =&gt;
      VisF e
        (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt;
         (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r0 <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; k r)
  <span class="kr">end</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkb6" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkb6"><span class="nb">destruct</span> H1 <span class="kr">as</span> [ ? ? r1 r2 rr ]; <span class="nb">dependent destruction</span> rr.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt; it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>(X1 +·µ¢ Y1) i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (RetF r0)</span></span></span><br><span><var>r3</var><span class="hyp-type"><b>: </b><span>(X2 +·µ¢ Y2) i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (RetF r3)</span></span></span><br><span><var>r_rel</var><span class="hyp-type"><b>: </b><span>sum·µ£ RX RY i r0 r3</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_wbisimF E RY (it_wbisim_t E RY R) i
  <span class="kr">match</span> _observe (f i a) <span class="kr">with</span>
  | RetF (inl x) =&gt; TauF (iter f i x)
  | RetF (inr y) =&gt; RetF y
  | TauF t =&gt;
      TauF
        ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X1 +·µ¢ Y1) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r <span class="kr">with</span>
              | inl x =&gt; TauF (iter f i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; t)
  | VisF e k =&gt;
      VisF e
        (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt;
         (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X1 +·µ¢ Y1) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r0 <span class="kr">with</span>
              | inl x =&gt; TauF (iter f i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; k r)
  <span class="kr">end</span>
  <span class="kr">match</span> _observe (g i b) <span class="kr">with</span>
  | RetF (inl x) =&gt; TauF (iter g i x)
  | RetF (inr y) =&gt; RetF y
  | TauF t =&gt;
      TauF
        ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; t)
  | VisF e k =&gt;
      VisF e
        (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt;
         (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r0 <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; k r)
  <span class="kr">end</span></div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="properties-v-chkb7" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E (X1 +·µ¢ Y1) i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (TauF t1)</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E (X2 +·µ¢ Y2) i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (TauF t2)</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>it_wbisim (sum·µ£ RX RY) i t1 t2</span></span></span><br></div><label class="goal-separator" for="properties-v-chkb7"><hr></label><div class="goal-conclusion">it_wbisimF E RY (it_wbisim_t E RY R) i
  <span class="kr">match</span> _observe (f i a) <span class="kr">with</span>
  | RetF (inl x) =&gt; TauF (iter f i x)
  | RetF (inr y) =&gt; RetF y
  | TauF t =&gt;
      TauF
        ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X1 +·µ¢ Y1) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r <span class="kr">with</span>
              | inl x =&gt; TauF (iter f i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; t)
  | VisF e k =&gt;
      VisF e
        (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt;
         (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X1 +·µ¢ Y1) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r0 <span class="kr">with</span>
              | inl x =&gt; TauF (iter f i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; k r)
  <span class="kr">end</span>
  <span class="kr">match</span> _observe (g i b) <span class="kr">with</span>
  | RetF (inl x) =&gt; TauF (iter g i x)
  | RetF (inr y) =&gt; RetF y
  | TauF t =&gt;
      TauF
        ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; t)
  | VisF e k =&gt;
      VisF e
        (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt;
         (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r0 <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; k r)
  <span class="kr">end</span></div></blockquote><input class="alectryon-extra-goal-toggle" id="properties-v-chkb8" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E (X1 +·µ¢ Y1) (e_nxt x)</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (VisF q k1)</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E (X2 +·µ¢ Y2) (e_nxt x)</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (VisF q k2)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
it_wbisim (sum·µ£ RX RY) (e_nxt r) (k1 r) (k2 r)</span></span></span><br></div><label class="goal-separator" for="properties-v-chkb8"><hr></label><div class="goal-conclusion">it_wbisimF E RY (it_wbisim_t E RY R) i
  <span class="kr">match</span> _observe (f i a) <span class="kr">with</span>
  | RetF (inl x) =&gt; TauF (iter f i x)
  | RetF (inr y) =&gt; RetF y
  | TauF t =&gt;
      TauF
        ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X1 +·µ¢ Y1) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r <span class="kr">with</span>
              | inl x =&gt; TauF (iter f i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; t)
  | VisF e k =&gt;
      VisF e
        (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt;
         (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X1 +·µ¢ Y1) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r0 <span class="kr">with</span>
              | inl x =&gt; TauF (iter f i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; k r)
  <span class="kr">end</span>
  <span class="kr">match</span> _observe (g i b) <span class="kr">with</span>
  | RetF (inl x) =&gt; TauF (iter g i x)
  | RetF (inr y) =&gt; RetF y
  | TauF t =&gt;
      TauF
        ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; t)
  | VisF e k =&gt;
      VisF e
        (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt;
         (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r0 <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; k r)
  <span class="kr">end</span></div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkb9" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkb9">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>(X1 +·µ¢ Y1) i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (RetF r0)</span></span></span><br><span><var>r3</var><span class="hyp-type"><b>: </b><span>(X2 +·µ¢ Y2) i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (RetF r3)</span></span></span><br><span><var>r_rel</var><span class="hyp-type"><b>: </b><span>sum·µ£ RX RY i r0 r3</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_wbisimF E RY (it_wbisim_t E RY R) i
  <span class="kr">match</span> _observe (f i a) <span class="kr">with</span>
  | RetF (inl x) =&gt; TauF (iter f i x)
  | RetF (inr y) =&gt; RetF y
  | TauF t =&gt;
      TauF
        ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X1 +·µ¢ Y1) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r <span class="kr">with</span>
              | inl x =&gt; TauF (iter f i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; t)
  | VisF e k =&gt;
      VisF e
        (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt;
         (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X1 +·µ¢ Y1) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r0 <span class="kr">with</span>
              | inl x =&gt; TauF (iter f i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; k r)
  <span class="kr">end</span>
  <span class="kr">match</span> _observe (g i b) <span class="kr">with</span>
  | RetF (inl x) =&gt; TauF (iter g i x)
  | RetF (inr y) =&gt; RetF y
  | TauF t =&gt;
      TauF
        ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; t)
  | VisF e k =&gt;
      VisF e
        (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt;
         (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r0 <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; k r)
  <span class="kr">end</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkba" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkba"><span class="nb">destruct</span> r_rel.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>x1</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (RetF (inl x1))</span></span></span><br><span><var>x2</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (RetF (inl x2))</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>RX i x1 x2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_wbisimF E RY (it_wbisim_t E RY R) i
  <span class="kr">match</span> _observe (f i a) <span class="kr">with</span>
  | RetF (inl x) =&gt; TauF (iter f i x)
  | RetF (inr y) =&gt; RetF y
  | TauF t =&gt;
      TauF
        ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X1 +·µ¢ Y1) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r <span class="kr">with</span>
              | inl x =&gt; TauF (iter f i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; t)
  | VisF e k =&gt;
      VisF e
        (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt;
         (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X1 +·µ¢ Y1) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r0 <span class="kr">with</span>
              | inl x =&gt; TauF (iter f i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; k r)
  <span class="kr">end</span>
  <span class="kr">match</span> _observe (g i b) <span class="kr">with</span>
  | RetF (inl x) =&gt; TauF (iter g i x)
  | RetF (inr y) =&gt; RetF y
  | TauF t =&gt;
      TauF
        ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; t)
  | VisF e k =&gt;
      VisF e
        (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt;
         (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r0 <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; k r)
  <span class="kr">end</span></div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="properties-v-chkbb" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>y1</var><span class="hyp-type"><b>: </b><span>Y1 i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (RetF (inr y1))</span></span></span><br><span><var>y2</var><span class="hyp-type"><b>: </b><span>Y2 i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (RetF (inr y2))</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>RY i y1 y2</span></span></span><br></div><label class="goal-separator" for="properties-v-chkbb"><hr></label><div class="goal-conclusion">it_wbisimF E RY (it_wbisim_t E RY R) i
  <span class="kr">match</span> _observe (f i a) <span class="kr">with</span>
  | RetF (inl x) =&gt; TauF (iter f i x)
  | RetF (inr y) =&gt; RetF y
  | TauF t =&gt;
      TauF
        ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X1 +·µ¢ Y1) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r <span class="kr">with</span>
              | inl x =&gt; TauF (iter f i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; t)
  | VisF e k =&gt;
      VisF e
        (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt;
         (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X1 +·µ¢ Y1) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r0 <span class="kr">with</span>
              | inl x =&gt; TauF (iter f i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; k r)
  <span class="kr">end</span>
  <span class="kr">match</span> _observe (g i b) <span class="kr">with</span>
  | RetF (inl x) =&gt; TauF (iter g i x)
  | RetF (inr y) =&gt; RetF y
  | TauF t =&gt;
      TauF
        ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; t)
  | VisF e k =&gt;
      VisF e
        (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt;
         (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r0 <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; k r)
  <span class="kr">end</span></div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkbc" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkbc">*</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>x1</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (RetF (inl x1))</span></span></span><br><span><var>x2</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (RetF (inl x2))</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>RX i x1 x2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_wbisimF E RY (it_wbisim_t E RY R) i
  <span class="kr">match</span> _observe (f i a) <span class="kr">with</span>
  | RetF (inl x) =&gt; TauF (iter f i x)
  | RetF (inr y) =&gt; RetF y
  | TauF t =&gt;
      TauF
        ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X1 +·µ¢ Y1) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r <span class="kr">with</span>
              | inl x =&gt; TauF (iter f i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; t)
  | VisF e k =&gt;
      VisF e
        (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt;
         (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X1 +·µ¢ Y1) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r0 <span class="kr">with</span>
              | inl x =&gt; TauF (iter f i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; k r)
  <span class="kr">end</span>
  <span class="kr">match</span> _observe (g i b) <span class="kr">with</span>
  | RetF (inl x) =&gt; TauF (iter g i x)
  | RetF (inr y) =&gt; RetF y
  | TauF t =&gt;
      TauF
        ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; t)
  | VisF e k =&gt;
      VisF e
        (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt;
         (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r0 <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; k r)
  <span class="kr">end</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkbd" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkbd"><span class="nb">pose</span> (H2 := H _ _ _ H0).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>x1</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (RetF (inl x1))</span></span></span><br><span><var>x2</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (RetF (inl x2))</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>RX i x1 x2</span></span></span><br><span><var>H2</var><span><span class="hyp-body"><b>:= </b><span>H i x1 x2 H0</span></span><span class="hyp-type"><b>: </b><span>it_wbisim (sum·µ£ RX RY) i (f i x1) (g i x2)</span></span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_wbisimF E RY (it_wbisim_t E RY R) i
  <span class="kr">match</span> _observe (f i a) <span class="kr">with</span>
  | RetF (inl x) =&gt; TauF (iter f i x)
  | RetF (inr y) =&gt; RetF y
  | TauF t =&gt;
      TauF
        ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X1 +·µ¢ Y1) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r <span class="kr">with</span>
              | inl x =&gt; TauF (iter f i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; t)
  | VisF e k =&gt;
      VisF e
        (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt;
         (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X1 +·µ¢ Y1) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r0 <span class="kr">with</span>
              | inl x =&gt; TauF (iter f i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; k r)
  <span class="kr">end</span>
  <span class="kr">match</span> _observe (g i b) <span class="kr">with</span>
  | RetF (inl x) =&gt; TauF (iter g i x)
  | RetF (inr y) =&gt; RetF y
  | TauF t =&gt;
      TauF
        ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; t)
  | VisF e k =&gt;
      VisF e
        (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt;
         (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r0 <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; k r)
  <span class="kr">end</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkbe" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkbe"><span class="nb">apply</span> it_wbisim_step <span class="kr">in</span> H2.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>x1</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (RetF (inl x1))</span></span></span><br><span><var>x2</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (RetF (inl x2))</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>RX i x1 x2</span></span></span><br><span><var>H2</var><span class="hyp-type"><b>: </b><span>it_wbisim_map E (sum·µ£ RX RY)
  (it_wbisim (sum·µ£ RX RY)) i 
  (f i x1) (g i x2)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_wbisimF E RY (it_wbisim_t E RY R) i
  <span class="kr">match</span> _observe (f i a) <span class="kr">with</span>
  | RetF (inl x) =&gt; TauF (iter f i x)
  | RetF (inr y) =&gt; RetF y
  | TauF t =&gt;
      TauF
        ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X1 +·µ¢ Y1) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r <span class="kr">with</span>
              | inl x =&gt; TauF (iter f i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; t)
  | VisF e k =&gt;
      VisF e
        (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt;
         (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X1 +·µ¢ Y1) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r0 <span class="kr">with</span>
              | inl x =&gt; TauF (iter f i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; k r)
  <span class="kr">end</span>
  <span class="kr">match</span> _observe (g i b) <span class="kr">with</span>
  | RetF (inl x) =&gt; TauF (iter g i x)
  | RetF (inr y) =&gt; RetF y
  | TauF t =&gt;
      TauF
        ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; t)
  | VisF e k =&gt;
      VisF e
        (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt;
         (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r0 <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; k r)
  <span class="kr">end</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkbf" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkbf"><span class="nb">destruct</span> H2 <span class="kr">as</span> [ ? ? s1 s2 ss ].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>x1</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (RetF (inl x1))</span></span></span><br><span><var>x2</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (RetF (inl x2))</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>RX i x1 x2</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>itree&#39; E (X1 +·µ¢ Y1) i</span></span></span><br><span><var>x3</var><span class="hyp-type"><b>: </b><span>itree&#39; E (X2 +·µ¢ Y2) i</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>it_eat i (observe (f i x1)) x0</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>it_eat i (observe (g i x2)) x3</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>it_eqF E (sum·µ£ RX RY) (it_wbisim (sum·µ£ RX RY)) i
  x0 x3</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_wbisimF E RY (it_wbisim_t E RY R) i
  <span class="kr">match</span> _observe (f i a) <span class="kr">with</span>
  | RetF (inl x) =&gt; TauF (iter f i x)
  | RetF (inr y) =&gt; RetF y
  | TauF t =&gt;
      TauF
        ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X1 +·µ¢ Y1) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r <span class="kr">with</span>
              | inl x =&gt; TauF (iter f i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; t)
  | VisF e k =&gt;
      VisF e
        (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt;
         (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X1 +·µ¢ Y1) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r0 <span class="kr">with</span>
              | inl x =&gt; TauF (iter f i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; k r)
  <span class="kr">end</span>
  <span class="kr">match</span> _observe (g i b) <span class="kr">with</span>
  | RetF (inl x) =&gt; TauF (iter g i x)
  | RetF (inr y) =&gt; RetF y
  | TauF t =&gt;
      TauF
        ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; t)
  | VisF e k =&gt;
      VisF e
        (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt;
         (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r0 <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; k r)
  <span class="kr">end</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkc0" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkc0"><span class="nb">econstructor</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>x1</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (RetF (inl x1))</span></span></span><br><span><var>x2</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (RetF (inl x2))</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>RX i x1 x2</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>itree&#39; E (X1 +·µ¢ Y1) i</span></span></span><br><span><var>x3</var><span class="hyp-type"><b>: </b><span>itree&#39; E (X2 +·µ¢ Y2) i</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>it_eat i (observe (f i x1)) x0</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>it_eat i (observe (g i x2)) x3</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>it_eqF E (sum·µ£ RX RY) (it_wbisim (sum·µ£ RX RY)) i
  x0 x3</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eat i
  <span class="kr">match</span> _observe (f i a) <span class="kr">with</span>
  | RetF (inl x) =&gt; TauF (iter f i x)
  | RetF (inr y) =&gt; RetF y
  | TauF t =&gt;
      TauF
        ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X1 +·µ¢ Y1) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r <span class="kr">with</span>
              | inl x =&gt; TauF (iter f i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; t)
  | VisF e k =&gt;
      VisF e
        (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt;
         (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X1 +·µ¢ Y1) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r0 <span class="kr">with</span>
              | inl x =&gt; TauF (iter f i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; k r)
  <span class="kr">end</span> <span class="nl">?x1</span></div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="properties-v-chkc1" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>x1</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (RetF (inl x1))</span></span></span><br><span><var>x2</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (RetF (inl x2))</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>RX i x1 x2</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>itree&#39; E (X1 +·µ¢ Y1) i</span></span></span><br><span><var>x3</var><span class="hyp-type"><b>: </b><span>itree&#39; E (X2 +·µ¢ Y2) i</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>it_eat i (observe (f i x1)) x0</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>it_eat i (observe (g i x2)) x3</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>it_eqF E (sum·µ£ RX RY) (it_wbisim (sum·µ£ RX RY)) i
  x0 x3</span></span></span><br></div><label class="goal-separator" for="properties-v-chkc1"><hr></label><div class="goal-conclusion">it_eat i
  <span class="kr">match</span> _observe (g i b) <span class="kr">with</span>
  | RetF (inl x) =&gt; TauF (iter g i x)
  | RetF (inr y) =&gt; RetF y
  | TauF t =&gt;
      TauF
        ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; t)
  | VisF e k =&gt;
      VisF e
        (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt;
         (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r0 <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; k r)
  <span class="kr">end</span> <span class="nl">?x2</span></div></blockquote><input class="alectryon-extra-goal-toggle" id="properties-v-chkc2" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>x1</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (RetF (inl x1))</span></span></span><br><span><var>x2</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (RetF (inl x2))</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>RX i x1 x2</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>itree&#39; E (X1 +·µ¢ Y1) i</span></span></span><br><span><var>x3</var><span class="hyp-type"><b>: </b><span>itree&#39; E (X2 +·µ¢ Y2) i</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>it_eat i (observe (f i x1)) x0</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>it_eat i (observe (g i x2)) x3</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>it_eqF E (sum·µ£ RX RY) (it_wbisim (sum·µ£ RX RY)) i
  x0 x3</span></span></span><br></div><label class="goal-separator" for="properties-v-chkc2"><hr></label><div class="goal-conclusion">it_eqF E RY (it_wbisim_t E RY R) i <span class="nl">?x1</span> <span class="nl">?x2</span></div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkc3" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkc3"><span class="bp">exact</span> (subst_eat _ _ (Ret&#39; _) r1).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>x1</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (RetF (inl x1))</span></span></span><br><span><var>x2</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (RetF (inl x2))</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>RX i x1 x2</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>itree&#39; E (X1 +·µ¢ Y1) i</span></span></span><br><span><var>x3</var><span class="hyp-type"><b>: </b><span>itree&#39; E (X2 +·µ¢ Y2) i</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>it_eat i (observe (f i x1)) x0</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>it_eat i (observe (g i x2)) x3</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>it_eqF E (sum·µ£ RX RY) (it_wbisim (sum·µ£ RX RY)) i
  x0 x3</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eat i
  <span class="kr">match</span> _observe (g i b) <span class="kr">with</span>
  | RetF (inl x) =&gt; TauF (iter g i x)
  | RetF (inr y) =&gt; RetF y
  | TauF t =&gt;
      TauF
        ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; t)
  | VisF e k =&gt;
      VisF e
        (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt;
         (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r0 <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; k r)
  <span class="kr">end</span> <span class="nl">?x2</span></div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="properties-v-chkc4" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>x1</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (RetF (inl x1))</span></span></span><br><span><var>x2</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (RetF (inl x2))</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>RX i x1 x2</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>itree&#39; E (X1 +·µ¢ Y1) i</span></span></span><br><span><var>x3</var><span class="hyp-type"><b>: </b><span>itree&#39; E (X2 +·µ¢ Y2) i</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>it_eat i (observe (f i x1)) x0</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>it_eat i (observe (g i x2)) x3</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>it_eqF E (sum·µ£ RX RY) (it_wbisim (sum·µ£ RX RY)) i
  x0 x3</span></span></span><br></div><label class="goal-separator" for="properties-v-chkc4"><hr></label><div class="goal-conclusion">it_eqF E RY (it_wbisim_t E RY R) i
  (_observe
     ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X1 +·µ¢ Y1) i) =&gt;
       {|
         _observe :=
           <span class="kr">match</span> r <span class="kr">with</span>
           | inl x =&gt; TauF (iter f i x)
           | inr y =&gt; RetF y
           <span class="kr">end</span>
       |}) =&lt;&lt; Ret&#39; (inl x1))) 
  <span class="nl">?x2</span></div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkc5" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkc5"><span class="bp">exact</span> (subst_eat _ _ (Ret&#39; _) r2).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>x1</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (RetF (inl x1))</span></span></span><br><span><var>x2</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (RetF (inl x2))</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>RX i x1 x2</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>itree&#39; E (X1 +·µ¢ Y1) i</span></span></span><br><span><var>x3</var><span class="hyp-type"><b>: </b><span>itree&#39; E (X2 +·µ¢ Y2) i</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>it_eat i (observe (f i x1)) x0</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>it_eat i (observe (g i x2)) x3</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>it_eqF E (sum·µ£ RX RY) (it_wbisim (sum·µ£ RX RY)) i
  x0 x3</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eqF E RY (it_wbisim_t E RY R) i
  (_observe
     ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X1 +·µ¢ Y1) i) =&gt;
       {|
         _observe :=
           <span class="kr">match</span> r <span class="kr">with</span>
           | inl x =&gt; TauF (iter f i x)
           | inr y =&gt; RetF y
           <span class="kr">end</span>
       |}) =&lt;&lt; Ret&#39; (inl x1)))
  (_observe
     ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X2 +·µ¢ Y2) i) =&gt;
       {|
         _observe :=
           <span class="kr">match</span> r <span class="kr">with</span>
           | inl x =&gt; TauF (iter g i x)
           | inr y =&gt; RetF y
           <span class="kr">end</span>
       |}) =&lt;&lt; Ret&#39; (inl x2)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkc6" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkc6"><span class="nb">cbn</span>; <span class="nb">econstructor</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>x1</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (RetF (inl x1))</span></span></span><br><span><var>x2</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (RetF (inl x2))</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>RX i x1 x2</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>itree&#39; E (X1 +·µ¢ Y1) i</span></span></span><br><span><var>x3</var><span class="hyp-type"><b>: </b><span>itree&#39; E (X2 +·µ¢ Y2) i</span></span></span><br><span><var>s1</var><span class="hyp-type"><b>: </b><span>it_eat i (observe (f i x1)) x0</span></span></span><br><span><var>s2</var><span class="hyp-type"><b>: </b><span>it_eat i (observe (g i x2)) x3</span></span></span><br><span><var>ss</var><span class="hyp-type"><b>: </b><span>it_eqF E (sum·µ£ RX RY) (it_wbisim (sum·µ£ RX RY)) i
  x0 x3</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_wbisim_t E RY R i (iter f i x1) (iter g i x2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">now</span> <span class="nb">apply</span> CIH.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkc7" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkc7">*</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>y1</var><span class="hyp-type"><b>: </b><span>Y1 i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (RetF (inr y1))</span></span></span><br><span><var>y2</var><span class="hyp-type"><b>: </b><span>Y2 i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (RetF (inr y2))</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>RY i y1 y2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_wbisimF E RY (it_wbisim_t E RY R) i
  <span class="kr">match</span> _observe (f i a) <span class="kr">with</span>
  | RetF (inl x) =&gt; TauF (iter f i x)
  | RetF (inr y) =&gt; RetF y
  | TauF t =&gt;
      TauF
        ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X1 +·µ¢ Y1) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r <span class="kr">with</span>
              | inl x =&gt; TauF (iter f i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; t)
  | VisF e k =&gt;
      VisF e
        (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt;
         (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X1 +·µ¢ Y1) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r0 <span class="kr">with</span>
              | inl x =&gt; TauF (iter f i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; k r)
  <span class="kr">end</span>
  <span class="kr">match</span> _observe (g i b) <span class="kr">with</span>
  | RetF (inl x) =&gt; TauF (iter g i x)
  | RetF (inr y) =&gt; RetF y
  | TauF t =&gt;
      TauF
        ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; t)
  | VisF e k =&gt;
      VisF e
        (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt;
         (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r0 <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; k r)
  <span class="kr">end</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkc8" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkc8"><span class="nb">econstructor</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>y1</var><span class="hyp-type"><b>: </b><span>Y1 i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (RetF (inr y1))</span></span></span><br><span><var>y2</var><span class="hyp-type"><b>: </b><span>Y2 i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (RetF (inr y2))</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>RY i y1 y2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eat i
  <span class="kr">match</span> _observe (f i a) <span class="kr">with</span>
  | RetF (inl x) =&gt; TauF (iter f i x)
  | RetF (inr y) =&gt; RetF y
  | TauF t =&gt;
      TauF
        ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X1 +·µ¢ Y1) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r <span class="kr">with</span>
              | inl x =&gt; TauF (iter f i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; t)
  | VisF e k =&gt;
      VisF e
        (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt;
         (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X1 +·µ¢ Y1) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r0 <span class="kr">with</span>
              | inl x =&gt; TauF (iter f i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; k r)
  <span class="kr">end</span> <span class="nl">?x1</span></div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="properties-v-chkc9" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>y1</var><span class="hyp-type"><b>: </b><span>Y1 i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (RetF (inr y1))</span></span></span><br><span><var>y2</var><span class="hyp-type"><b>: </b><span>Y2 i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (RetF (inr y2))</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>RY i y1 y2</span></span></span><br></div><label class="goal-separator" for="properties-v-chkc9"><hr></label><div class="goal-conclusion">it_eat i
  <span class="kr">match</span> _observe (g i b) <span class="kr">with</span>
  | RetF (inl x) =&gt; TauF (iter g i x)
  | RetF (inr y) =&gt; RetF y
  | TauF t =&gt;
      TauF
        ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; t)
  | VisF e k =&gt;
      VisF e
        (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt;
         (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r0 <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; k r)
  <span class="kr">end</span> <span class="nl">?x2</span></div></blockquote><input class="alectryon-extra-goal-toggle" id="properties-v-chkca" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>y1</var><span class="hyp-type"><b>: </b><span>Y1 i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (RetF (inr y1))</span></span></span><br><span><var>y2</var><span class="hyp-type"><b>: </b><span>Y2 i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (RetF (inr y2))</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>RY i y1 y2</span></span></span><br></div><label class="goal-separator" for="properties-v-chkca"><hr></label><div class="goal-conclusion">it_eqF E RY (it_wbisim_t E RY R) i <span class="nl">?x1</span> <span class="nl">?x2</span></div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkcb" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkcb"><span class="bp">exact</span> (subst_eat _ _ (Ret&#39; _) r1).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>y1</var><span class="hyp-type"><b>: </b><span>Y1 i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (RetF (inr y1))</span></span></span><br><span><var>y2</var><span class="hyp-type"><b>: </b><span>Y2 i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (RetF (inr y2))</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>RY i y1 y2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eat i
  <span class="kr">match</span> _observe (g i b) <span class="kr">with</span>
  | RetF (inl x) =&gt; TauF (iter g i x)
  | RetF (inr y) =&gt; RetF y
  | TauF t =&gt;
      TauF
        ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; t)
  | VisF e k =&gt;
      VisF e
        (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt;
         (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r0 <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; k r)
  <span class="kr">end</span> <span class="nl">?x2</span></div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="properties-v-chkcc" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>y1</var><span class="hyp-type"><b>: </b><span>Y1 i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (RetF (inr y1))</span></span></span><br><span><var>y2</var><span class="hyp-type"><b>: </b><span>Y2 i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (RetF (inr y2))</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>RY i y1 y2</span></span></span><br></div><label class="goal-separator" for="properties-v-chkcc"><hr></label><div class="goal-conclusion">it_eqF E RY (it_wbisim_t E RY R) i
  (_observe
     ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X1 +·µ¢ Y1) i) =&gt;
       {|
         _observe :=
           <span class="kr">match</span> r <span class="kr">with</span>
           | inl x =&gt; TauF (iter f i x)
           | inr y =&gt; RetF y
           <span class="kr">end</span>
       |}) =&lt;&lt; Ret&#39; (inr y1))) 
  <span class="nl">?x2</span></div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkcd" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkcd"><span class="bp">exact</span> (subst_eat _ _ (Ret&#39; _) r2).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>y1</var><span class="hyp-type"><b>: </b><span>Y1 i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (RetF (inr y1))</span></span></span><br><span><var>y2</var><span class="hyp-type"><b>: </b><span>Y2 i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (RetF (inr y2))</span></span></span><br><span><var>H0</var><span class="hyp-type"><b>: </b><span>RY i y1 y2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eqF E RY (it_wbisim_t E RY R) i
  (_observe
     ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X1 +·µ¢ Y1) i) =&gt;
       {|
         _observe :=
           <span class="kr">match</span> r <span class="kr">with</span>
           | inl x =&gt; TauF (iter f i x)
           | inr y =&gt; RetF y
           <span class="kr">end</span>
       |}) =&lt;&lt; Ret&#39; (inr y1)))
  (_observe
     ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X2 +·µ¢ Y2) i) =&gt;
       {|
         _observe :=
           <span class="kr">match</span> r <span class="kr">with</span>
           | inl x =&gt; TauF (iter g i x)
           | inr y =&gt; RetF y
           <span class="kr">end</span>
       |}) =&lt;&lt; Ret&#39; (inr y2)))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">        </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">now</span> <span class="nb">cbn</span>; <span class="nb">econstructor</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkce" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkce">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E (X1 +·µ¢ Y1) i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (TauF t1)</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E (X2 +·µ¢ Y2) i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (TauF t2)</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>it_wbisim (sum·µ£ RX RY) i t1 t2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_wbisimF E RY (it_wbisim_t E RY R) i
  <span class="kr">match</span> _observe (f i a) <span class="kr">with</span>
  | RetF (inl x) =&gt; TauF (iter f i x)
  | RetF (inr y) =&gt; RetF y
  | TauF t =&gt;
      TauF
        ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X1 +·µ¢ Y1) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r <span class="kr">with</span>
              | inl x =&gt; TauF (iter f i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; t)
  | VisF e k =&gt;
      VisF e
        (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt;
         (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X1 +·µ¢ Y1) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r0 <span class="kr">with</span>
              | inl x =&gt; TauF (iter f i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; k r)
  <span class="kr">end</span>
  <span class="kr">match</span> _observe (g i b) <span class="kr">with</span>
  | RetF (inl x) =&gt; TauF (iter g i x)
  | RetF (inr y) =&gt; RetF y
  | TauF t =&gt;
      TauF
        ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; t)
  | VisF e k =&gt;
      VisF e
        (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt;
         (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r0 <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; k r)
  <span class="kr">end</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkcf" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkcf"><span class="nb">econstructor</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E (X1 +·µ¢ Y1) i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (TauF t1)</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E (X2 +·µ¢ Y2) i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (TauF t2)</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>it_wbisim (sum·µ£ RX RY) i t1 t2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eat i
  <span class="kr">match</span> _observe (f i a) <span class="kr">with</span>
  | RetF (inl x) =&gt; TauF (iter f i x)
  | RetF (inr y) =&gt; RetF y
  | TauF t =&gt;
      TauF
        ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X1 +·µ¢ Y1) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r <span class="kr">with</span>
              | inl x =&gt; TauF (iter f i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; t)
  | VisF e k =&gt;
      VisF e
        (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt;
         (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X1 +·µ¢ Y1) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r0 <span class="kr">with</span>
              | inl x =&gt; TauF (iter f i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; k r)
  <span class="kr">end</span> <span class="nl">?x1</span></div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="properties-v-chkd0" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E (X1 +·µ¢ Y1) i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (TauF t1)</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E (X2 +·µ¢ Y2) i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (TauF t2)</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>it_wbisim (sum·µ£ RX RY) i t1 t2</span></span></span><br></div><label class="goal-separator" for="properties-v-chkd0"><hr></label><div class="goal-conclusion">it_eat i
  <span class="kr">match</span> _observe (g i b) <span class="kr">with</span>
  | RetF (inl x) =&gt; TauF (iter g i x)
  | RetF (inr y) =&gt; RetF y
  | TauF t =&gt;
      TauF
        ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; t)
  | VisF e k =&gt;
      VisF e
        (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt;
         (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r0 <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; k r)
  <span class="kr">end</span> <span class="nl">?x2</span></div></blockquote><input class="alectryon-extra-goal-toggle" id="properties-v-chkd1" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E (X1 +·µ¢ Y1) i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (TauF t1)</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E (X2 +·µ¢ Y2) i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (TauF t2)</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>it_wbisim (sum·µ£ RX RY) i t1 t2</span></span></span><br></div><label class="goal-separator" for="properties-v-chkd1"><hr></label><div class="goal-conclusion">it_eqF E RY (it_wbisim_t E RY R) i <span class="nl">?x1</span> <span class="nl">?x2</span></div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkd2" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkd2"><span class="bp">exact</span> (subst_eat _ _ (Tau&#39; _) r1).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E (X1 +·µ¢ Y1) i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (TauF t1)</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E (X2 +·µ¢ Y2) i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (TauF t2)</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>it_wbisim (sum·µ£ RX RY) i t1 t2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eat i
  <span class="kr">match</span> _observe (g i b) <span class="kr">with</span>
  | RetF (inl x) =&gt; TauF (iter g i x)
  | RetF (inr y) =&gt; RetF y
  | TauF t =&gt;
      TauF
        ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; t)
  | VisF e k =&gt;
      VisF e
        (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt;
         (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r0 <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; k r)
  <span class="kr">end</span> <span class="nl">?x2</span></div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="properties-v-chkd3" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E (X1 +·µ¢ Y1) i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (TauF t1)</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E (X2 +·µ¢ Y2) i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (TauF t2)</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>it_wbisim (sum·µ£ RX RY) i t1 t2</span></span></span><br></div><label class="goal-separator" for="properties-v-chkd3"><hr></label><div class="goal-conclusion">it_eqF E RY (it_wbisim_t E RY R) i
  (_observe
     ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X1 +·µ¢ Y1) i) =&gt;
       {|
         _observe :=
           <span class="kr">match</span> r <span class="kr">with</span>
           | inl x =&gt; TauF (iter f i x)
           | inr y =&gt; RetF y
           <span class="kr">end</span>
       |}) =&lt;&lt; Tau&#39; t1)) 
  <span class="nl">?x2</span></div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkd4" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkd4"><span class="bp">exact</span> (subst_eat _ _ (Tau&#39; _) r2).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E (X1 +·µ¢ Y1) i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (TauF t1)</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E (X2 +·µ¢ Y2) i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (TauF t2)</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>it_wbisim (sum·µ£ RX RY) i t1 t2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eqF E RY (it_wbisim_t E RY R) i
  (_observe
     ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X1 +·µ¢ Y1) i) =&gt;
       {|
         _observe :=
           <span class="kr">match</span> r <span class="kr">with</span>
           | inl x =&gt; TauF (iter f i x)
           | inr y =&gt; RetF y
           <span class="kr">end</span>
       |}) =&lt;&lt; Tau&#39; t1))
  (_observe
     ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X2 +·µ¢ Y2) i) =&gt;
       {|
         _observe :=
           <span class="kr">match</span> r <span class="kr">with</span>
           | inl x =&gt; TauF (iter g i x)
           | inr y =&gt; RetF y
           <span class="kr">end</span>
       |}) =&lt;&lt; Tau&#39; t2))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkd5" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkd5"><span class="nb">cbn</span>; <span class="nb">econstructor</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E (X1 +·µ¢ Y1) i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (TauF t1)</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E (X2 +·µ¢ Y2) i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (TauF t2)</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>it_wbisim (sum·µ£ RX RY) i t1 t2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_wbisim_t E RY R i
  ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X1 +·µ¢ Y1) i) =&gt;
    {|
      _observe :=
        <span class="kr">match</span> r <span class="kr">with</span>
        | inl x =&gt; TauF (iter f i x)
        | inr y =&gt; RetF y
        <span class="kr">end</span>
    |}) =&lt;&lt; t1)
  ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X2 +·µ¢ Y2) i) =&gt;
    {|
      _observe :=
        <span class="kr">match</span> r <span class="kr">with</span>
        | inl x =&gt; TauF (iter g i x)
        | inr y =&gt; RetF y
        <span class="kr">end</span>
    |}) =&lt;&lt; t2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkd6" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkd6"><span class="nb">apply</span> (tt_t (it_wbisim_map E _)); <span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E (X1 +·µ¢ Y1) i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (TauF t1)</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E (X2 +·µ¢ Y2) i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (TauF t2)</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>it_wbisim (sum·µ£ RX RY) i t1 t2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_wbisim_t E RY (it_wbisim_t E RY R) i
  ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X1 +·µ¢ Y1) i) =&gt;
    {|
      _observe :=
        <span class="kr">match</span> r <span class="kr">with</span>
        | inl x =&gt; TauF (iter f i x)
        | inr y =&gt; RetF y
        <span class="kr">end</span>
    |}) =&lt;&lt; t1)
  ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X2 +·µ¢ Y2) i) =&gt;
    {|
      _observe :=
        <span class="kr">match</span> r <span class="kr">with</span>
        | inl x =&gt; TauF (iter g i x)
        | inr y =&gt; RetF y
        <span class="kr">end</span>
    |}) =&lt;&lt; t2)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkd7" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkd7"><span class="nb">apply</span> (it_wbisim_up2bind_t (sum·µ£ RX RY) RY); <span class="nb">econstructor</span>; <span class="nb">eauto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>t1</var><span class="hyp-type"><b>: </b><span>itree E (X1 +·µ¢ Y1) i</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (TauF t1)</span></span></span><br><span><var>t2</var><span class="hyp-type"><b>: </b><span>itree E (X2 +·µ¢ Y2) i</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (TauF t2)</span></span></span><br><span><var>t_rel</var><span class="hyp-type"><b>: </b><span>it_wbisim (sum·µ£ RX RY) i t1 t2</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : (X1 +·µ¢ Y1) i) (<span class="nv">x2</span> : (X2 +·µ¢ Y2) i),
sum·µ£ RX RY i x1 x2 -&gt;
it_wbisim_t E RY R i
  {|
    _observe :=
      <span class="kr">match</span> x1 <span class="kr">with</span>
      | inl x =&gt; TauF (iter f i x)
      | inr y =&gt; RetF y
      <span class="kr">end</span>
  |}
  {|
    _observe :=
      <span class="kr">match</span> x2 <span class="kr">with</span>
      | inl x =&gt; TauF (iter g i x)
      | inr y =&gt; RetF y
      <span class="kr">end</span>
  |}</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">intros</span> ? ? ? []; <span class="nb">apply</span> (tt_t (it_wbisim_map E RY)), (b_t (it_wbisim_map E RY)); <span class="nb">cbn</span>; <span class="nb">eauto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkd8" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkd8">-</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E (X1 +·µ¢ Y1) (e_nxt x)</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (VisF q k1)</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E (X2 +·µ¢ Y2) (e_nxt x)</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (VisF q k2)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
it_wbisim (sum·µ£ RX RY) (e_nxt r) (k1 r) (k2 r)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_wbisimF E RY (it_wbisim_t E RY R) i
  <span class="kr">match</span> _observe (f i a) <span class="kr">with</span>
  | RetF (inl x) =&gt; TauF (iter f i x)
  | RetF (inr y) =&gt; RetF y
  | TauF t =&gt;
      TauF
        ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X1 +·µ¢ Y1) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r <span class="kr">with</span>
              | inl x =&gt; TauF (iter f i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; t)
  | VisF e k =&gt;
      VisF e
        (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt;
         (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X1 +·µ¢ Y1) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r0 <span class="kr">with</span>
              | inl x =&gt; TauF (iter f i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; k r)
  <span class="kr">end</span>
  <span class="kr">match</span> _observe (g i b) <span class="kr">with</span>
  | RetF (inl x) =&gt; TauF (iter g i x)
  | RetF (inr y) =&gt; RetF y
  | TauF t =&gt;
      TauF
        ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; t)
  | VisF e k =&gt;
      VisF e
        (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt;
         (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r0 <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; k r)
  <span class="kr">end</span></div></blockquote></div></div></small><span class="alectryon-wsp"> </span></span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkd9" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkd9"><span class="nb">econstructor</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E (X1 +·µ¢ Y1) (e_nxt x)</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (VisF q k1)</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E (X2 +·µ¢ Y2) (e_nxt x)</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (VisF q k2)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
it_wbisim (sum·µ£ RX RY) (e_nxt r) (k1 r) (k2 r)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eat i
  <span class="kr">match</span> _observe (f i a) <span class="kr">with</span>
  | RetF (inl x) =&gt; TauF (iter f i x)
  | RetF (inr y) =&gt; RetF y
  | TauF t =&gt;
      TauF
        ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X1 +·µ¢ Y1) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r <span class="kr">with</span>
              | inl x =&gt; TauF (iter f i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; t)
  | VisF e k =&gt;
      VisF e
        (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt;
         (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X1 +·µ¢ Y1) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r0 <span class="kr">with</span>
              | inl x =&gt; TauF (iter f i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; k r)
  <span class="kr">end</span> <span class="nl">?x1</span></div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="properties-v-chkda" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E (X1 +·µ¢ Y1) (e_nxt x)</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (VisF q k1)</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E (X2 +·µ¢ Y2) (e_nxt x)</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (VisF q k2)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
it_wbisim (sum·µ£ RX RY) (e_nxt r) (k1 r) (k2 r)</span></span></span><br></div><label class="goal-separator" for="properties-v-chkda"><hr></label><div class="goal-conclusion">it_eat i
  <span class="kr">match</span> _observe (g i b) <span class="kr">with</span>
  | RetF (inl x) =&gt; TauF (iter g i x)
  | RetF (inr y) =&gt; RetF y
  | TauF t =&gt;
      TauF
        ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; t)
  | VisF e k =&gt;
      VisF e
        (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt;
         (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r0 <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; k r)
  <span class="kr">end</span> <span class="nl">?x2</span></div></blockquote><input class="alectryon-extra-goal-toggle" id="properties-v-chkdb" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E (X1 +·µ¢ Y1) (e_nxt x)</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (VisF q k1)</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E (X2 +·µ¢ Y2) (e_nxt x)</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (VisF q k2)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
it_wbisim (sum·µ£ RX RY) (e_nxt r) (k1 r) (k2 r)</span></span></span><br></div><label class="goal-separator" for="properties-v-chkdb"><hr></label><div class="goal-conclusion">it_eqF E RY (it_wbisim_t E RY R) i <span class="nl">?x1</span> <span class="nl">?x2</span></div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkdc" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkdc"><span class="bp">exact</span> (subst_eat _ _ (Vis&#39; _ _) r1).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E (X1 +·µ¢ Y1) (e_nxt x)</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (VisF q k1)</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E (X2 +·µ¢ Y2) (e_nxt x)</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (VisF q k2)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
it_wbisim (sum·µ£ RX RY) (e_nxt r) (k1 r) (k2 r)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eat i
  <span class="kr">match</span> _observe (g i b) <span class="kr">with</span>
  | RetF (inl x) =&gt; TauF (iter g i x)
  | RetF (inr y) =&gt; RetF y
  | TauF t =&gt;
      TauF
        ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; t)
  | VisF e k =&gt;
      VisF e
        (<span class="kr">fun</span> <span class="nv">r</span> : e_rsp e =&gt;
         (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r0</span> : (X2 +·µ¢ Y2) i) =&gt;
          {|
            _observe :=
              <span class="kr">match</span> r0 <span class="kr">with</span>
              | inl x =&gt; TauF (iter g i x)
              | inr y =&gt; RetF y
              <span class="kr">end</span>
          |}) =&lt;&lt; k r)
  <span class="kr">end</span> <span class="nl">?x2</span></div></blockquote><div class="alectryon-extra-goals"><input class="alectryon-extra-goal-toggle" id="properties-v-chkdd" style="display: none" type="checkbox"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E (X1 +·µ¢ Y1) (e_nxt x)</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (VisF q k1)</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E (X2 +·µ¢ Y2) (e_nxt x)</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (VisF q k2)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
it_wbisim (sum·µ£ RX RY) (e_nxt r) (k1 r) (k2 r)</span></span></span><br></div><label class="goal-separator" for="properties-v-chkdd"><hr></label><div class="goal-conclusion">it_eqF E RY (it_wbisim_t E RY R) i
  (_observe
     ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X1 +·µ¢ Y1) i) =&gt;
       {|
         _observe :=
           <span class="kr">match</span> r <span class="kr">with</span>
           | inl x =&gt; TauF (iter f i x)
           | inr y =&gt; RetF y
           <span class="kr">end</span>
       |}) =&lt;&lt; Vis&#39; q k1)) 
  <span class="nl">?x2</span></div></blockquote></div></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkde" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkde"><span class="bp">exact</span> (subst_eat _ _ (Vis&#39; _ _) r2).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E (X1 +·µ¢ Y1) (e_nxt x)</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (VisF q k1)</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E (X2 +·µ¢ Y2) (e_nxt x)</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (VisF q k2)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
it_wbisim (sum·µ£ RX RY) (e_nxt r) (k1 r) (k2 r)</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eqF E RY (it_wbisim_t E RY R) i
  (_observe
     ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X1 +·µ¢ Y1) i) =&gt;
       {|
         _observe :=
           <span class="kr">match</span> r <span class="kr">with</span>
           | inl x =&gt; TauF (iter f i x)
           | inr y =&gt; RetF y
           <span class="kr">end</span>
       |}) =&lt;&lt; Vis&#39; q k1))
  (_observe
     ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X2 +·µ¢ Y2) i) =&gt;
       {|
         _observe :=
           <span class="kr">match</span> r <span class="kr">with</span>
           | inl x =&gt; TauF (iter g i x)
           | inr y =&gt; RetF y
           <span class="kr">end</span>
       |}) =&lt;&lt; Vis&#39; q k2))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkdf" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkdf"><span class="nb">cbn</span>; <span class="nb">econstructor</span>; <span class="nb">intro</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E (X1 +·µ¢ Y1) (e_nxt x)</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (VisF q k1)</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E (X2 +·µ¢ Y2) (e_nxt x)</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (VisF q k2)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
it_wbisim (sum·µ£ RX RY) (e_nxt r) (k1 r) (k2 r)</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>e_rsp q</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_wbisim_t E RY R (e_nxt r0)
  ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X1 +·µ¢ Y1) i) =&gt;
    {|
      _observe :=
        <span class="kr">match</span> r <span class="kr">with</span>
        | inl x =&gt; TauF (iter f i x)
        | inr y =&gt; RetF y
        <span class="kr">end</span>
    |}) =&lt;&lt; k1 r0)
  ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X2 +·µ¢ Y2) i) =&gt;
    {|
      _observe :=
        <span class="kr">match</span> r <span class="kr">with</span>
        | inl x =&gt; TauF (iter g i x)
        | inr y =&gt; RetF y
        <span class="kr">end</span>
    |}) =&lt;&lt; k2 r0)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chke0" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chke0"><span class="nb">apply</span> (tt_t (it_wbisim_map E _)); <span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E (X1 +·µ¢ Y1) (e_nxt x)</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (VisF q k1)</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E (X2 +·µ¢ Y2) (e_nxt x)</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (VisF q k2)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
it_wbisim (sum·µ£ RX RY) (e_nxt r) (k1 r) (k2 r)</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>e_rsp q</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_wbisim_t E RY (it_wbisim_t E RY R) 
  (e_nxt r0)
  ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X1 +·µ¢ Y1) i) =&gt;
    {|
      _observe :=
        <span class="kr">match</span> r <span class="kr">with</span>
        | inl x =&gt; TauF (iter f i x)
        | inr y =&gt; RetF y
        <span class="kr">end</span>
    |}) =&lt;&lt; k1 r0)
  ((<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X2 +·µ¢ Y2) i) =&gt;
    {|
      _observe :=
        <span class="kr">match</span> r <span class="kr">with</span>
        | inl x =&gt; TauF (iter g i x)
        | inr y =&gt; RetF y
        <span class="kr">end</span>
    |}) =&lt;&lt; k2 r0)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chke1" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chke1"><span class="nb">apply</span> (it_wbisim_up2bind_t (sum·µ£ RX RY) RY); <span class="nb">econstructor</span>; [ <span class="nb">apply</span> k_rel | ].</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X1, X2, Y1, Y2</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RX</var><span class="hyp-type"><b>: </b><span>rel·µ¢ X1 X2</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span>rel·µ¢ Y1 Y2</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X1 x -&gt; itree E (X1 +·µ¢ Y1) x</span></span></span><br><span><var>g</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, X2 x -&gt; itree E (X2 +·µ¢ Y2) x</span></span></span><br><span><var>H</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim (sum·µ£ RX RY) i (f i a) (g i b)</span></span></span><br><span><var>R</var><span class="hyp-type"><b>: </b><span>rel·µ¢ (itree E Y1) (itree E Y2)</span></span></span><br><span><var>CIH</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">a</span> : X1 i) (<span class="nv">b</span> : X2 i),
RX i a b -&gt;
it_wbisim_t E RY R i (iter f i a) (iter g i b)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>a</var><span class="hyp-type"><b>: </b><span>X1 i</span></span></span><br><span><var>b</var><span class="hyp-type"><b>: </b><span>X2 i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>RX i a b</span></span></span><br><span><var>q</var><span class="hyp-type"><b>: </b><span>e_qry i</span></span></span><br><span><var>k1</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E (X1 +·µ¢ Y1) (e_nxt x)</span></span></span><br><span><var>r1</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (f i a)) (VisF q k1)</span></span></span><br><span><var>k2</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : e_rsp q, itree E (X2 +·µ¢ Y2) (e_nxt x)</span></span></span><br><span><var>r2</var><span class="hyp-type"><b>: </b><span>it_eat i (_observe (g i b)) (VisF q k2)</span></span></span><br><span><var>k_rel</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">r</span> : e_rsp q,
it_wbisim (sum·µ£ RX RY) (e_nxt r) (k1 r) (k2 r)</span></span></span><br><span><var>r0</var><span class="hyp-type"><b>: </b><span>e_rsp q</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion"><span class="kr">forall</span> (<span class="nv">i</span> : I) (<span class="nv">x1</span> : (X1 +·µ¢ Y1) i) (<span class="nv">x2</span> : (X2 +·µ¢ Y2) i),
sum·µ£ RX RY i x1 x2 -&gt;
it_wbisim_t E RY R i
  {|
    _observe :=
      <span class="kr">match</span> x1 <span class="kr">with</span>
      | inl x =&gt; TauF (iter f i x)
      | inr y =&gt; RetF y
      <span class="kr">end</span>
  |}
  {|
    _observe :=
      <span class="kr">match</span> x2 <span class="kr">with</span>
      | inl x =&gt; TauF (iter g i x)
      | inr y =&gt; RetF y
      <span class="kr">end</span>
  |}</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">      </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">intros</span> ? ? ? []; <span class="nb">apply</span> (tt_t (it_wbisim_map E RY)), (b_t (it_wbisim_map E RY)); <span class="nb">cbn</span>; <span class="nb">eauto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">
</span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input">#[<span class="kn">global</span>] <span class="kn">Instance</span> <span class="nf">iter_weq</span> {<span class="nv">X</span> <span class="nv">Y</span>} {<span class="nv">RX</span> : rel·µ¢ X X} {<span class="nv">RY</span> : rel·µ¢ Y Y} :
    Proper (dpointwise_relation (<span class="kr">fun</span> <span class="nv">i</span> =&gt; RX i ==&gt; it_wbisim (sum·µ£ RX RY) i)
              ==&gt; dpointwise_relation (<span class="kr">fun</span> <span class="nv">i</span> =&gt; RX i ==&gt; it_wbisim RY i))
      (@iter I E X Y)
    := iter_cong_weak.</span></span></pre><p>Iteration is a strong fixed point of the folowing guarded equation.</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chke2" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chke2"><span class="kn">Lemma</span> <span class="nf">iter_unfold</span> {<span class="nv">X</span> <span class="nv">Y</span> <span class="nv">RY</span>} `{Reflexive·µ¢ RY} (f : X ‚áí·µ¢ itree E (X +·µ¢ Y)) {i x} :
    it_eq RY
      (iter f i x)
      (bind (f i x) (<span class="kr">fun</span> <span class="nv">_</span> <span class="nv">r</span> =&gt; go (<span class="kr">match</span> r <span class="kr">with</span>
                                 | inl x =&gt; TauF (iter f _ x)
                                 | inr y =&gt; RetF y <span class="kr">end</span>))).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>Reflexive·µ¢0</var><span class="hyp-type"><b>: </b><span>Reflexive·µ¢ RY</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>X ‚áí·µ¢ itree E (X +·µ¢ Y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eq RY (iter f i x)
  (f i x &gt;&gt;=
   (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X +·µ¢ Y) i) =&gt;
    {|
      _observe :=
        <span class="kr">match</span> r <span class="kr">with</span>
        | inl x =&gt; TauF (iter f i x)
        | inr y =&gt; RetF y
        <span class="kr">end</span>
    |}))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chke3" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chke3"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>Reflexive·µ¢0</var><span class="hyp-type"><b>: </b><span>Reflexive·µ¢ RY</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>X ‚áí·µ¢ itree E (X +·µ¢ Y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eq RY (iter f i x)
  (f i x &gt;&gt;=
   (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X +·µ¢ Y) i) =&gt;
    {|
      _observe :=
        <span class="kr">match</span> r <span class="kr">with</span>
        | inl x =&gt; TauF (iter f i x)
        | inr y =&gt; RetF y
        <span class="kr">end</span>
    |}))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chke4" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chke4"><span class="nb">apply</span> (gfp_fp (it_eq_map E RY)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>Reflexive·µ¢0</var><span class="hyp-type"><b>: </b><span>Reflexive·µ¢ RY</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>X ‚áí·µ¢ itree E (X +·µ¢ Y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eq_map E RY (gfp (it_eq_map E RY)) i 
  (iter f i x)
  (f i x &gt;&gt;=
   (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X +·µ¢ Y) i) =&gt;
    {|
      _observe :=
        <span class="kr">match</span> r <span class="kr">with</span>
        | inl x =&gt; TauF (iter f i x)
        | inr y =&gt; RetF y
        <span class="kr">end</span>
    |}))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chke5" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chke5"><span class="nb">cbn</span>; <span class="nb">destruct</span> (_observe (f i x)); <span class="nb">auto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>RY</var><span class="hyp-type"><b>: </b><span><span class="kr">forall</span> <span class="nv">x</span> : I, relation (Y x)</span></span></span><br><span><var>Reflexive·µ¢0</var><span class="hyp-type"><b>: </b><span>Reflexive·µ¢ RY</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>X ‚áí·µ¢ itree E (X +·µ¢ Y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br><span><var>r</var><span class="hyp-type"><b>: </b><span>(X +·µ¢ Y) i</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_eqF E RY (gfp (it_eq_map E RY)) i
  <span class="kr">match</span> r <span class="kr">with</span>
  | inl x =&gt; TauF (iter f i x)
  | inr y =&gt; RetF y
  <span class="kr">end</span>
  <span class="kr">match</span> r <span class="kr">with</span>
  | inl x =&gt; TauF (iter f i x)
  | inr y =&gt; RetF y
  <span class="kr">end</span></div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="nb">destruct</span> r; <span class="nb">eauto</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span></span></pre><p>Iteration is a weak fixed point of the equation (Prop. 3).</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chke6" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chke6"><span class="kn">Lemma</span> <span class="nf">iter_fix</span> {<span class="nv">X</span> <span class="nv">Y</span>} (<span class="nv">f</span> : X ‚áí·µ¢ itree E (X +·µ¢ Y)) {<span class="nv">i</span> <span class="nv">x</span>} :
      (iter f i x)
      ‚âà
      (bind (f i x) (<span class="kr">fun</span> <span class="nv">_</span> <span class="nv">r</span> =&gt; <span class="kr">match</span> r <span class="kr">with</span>
                             | inl x =&gt; iter f _ x
                             | inr y =&gt; Ret&#39; y <span class="kr">end</span>)).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>X ‚áí·µ¢ itree E (X +·µ¢ Y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">iter f i x
‚âà (f i x &gt;&gt;=
   (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X +·µ¢ Y) i) =&gt;
    <span class="kr">match</span> r <span class="kr">with</span>
    | inl x =&gt; iter f i x
    | inr y =&gt; Ret&#39; y
    <span class="kr">end</span>))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chke7" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chke7"><span class="kn">Proof</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>X ‚áí·µ¢ itree E (X +·µ¢ Y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">iter f i x
‚âà (f i x &gt;&gt;=
   (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X +·µ¢ Y) i) =&gt;
    <span class="kr">match</span> r <span class="kr">with</span>
    | inl x =&gt; iter f i x
    | inr y =&gt; Ret&#39; y
    <span class="kr">end</span>))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chke8" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chke8"><span class="nb">rewrite</span> iter_unfold.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>X ‚áí·µ¢ itree E (X +·µ¢ Y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">(f i x &gt;&gt;=
 (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X +·µ¢ Y) i) =&gt;
  {|
    _observe :=
      <span class="kr">match</span> r <span class="kr">with</span>
      | inl x =&gt; TauF (iter f i x)
      | inr y =&gt; RetF y
      <span class="kr">end</span>
  |}))
‚âà (f i x &gt;&gt;=
   (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X +·µ¢ Y) i) =&gt;
    <span class="kr">match</span> r <span class="kr">with</span>
    | inl x =&gt; iter f i x
    | inr y =&gt; Ret&#39; y
    <span class="kr">end</span>))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chke9" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chke9"><span class="nb">apply</span> (tt_t (it_wbisim_map E _)); <span class="nb">cbn</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>X ‚áí·µ¢ itree E (X +·µ¢ Y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_wbisim_t E (eq·µ¢ Y) (it_wbisim_t E (eq·µ¢ Y) bot) i
  (f i x &gt;&gt;=
   (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X +·µ¢ Y) i) =&gt;
    {|
      _observe :=
        <span class="kr">match</span> r <span class="kr">with</span>
        | inl x =&gt; TauF (iter f i x)
        | inr y =&gt; RetF y
        <span class="kr">end</span>
    |}))
  (f i x &gt;&gt;=
   (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X +·µ¢ Y) i) =&gt;
    <span class="kr">match</span> r <span class="kr">with</span>
    | inl x =&gt; iter f i x
    | inr y =&gt; Ret&#39; y
    <span class="kr">end</span>))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkea" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkea"><span class="nb">apply</span> (it_wbisim_up2bind_t (eq·µ¢ (X +·µ¢ Y)) _).</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>X ‚áí·µ¢ itree E (X +·µ¢ Y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">bindR_w_map (eq·µ¢ (X +·µ¢ Y)) (it_wbisim_t E (eq·µ¢ Y) bot)
  i
  (f i x &gt;&gt;=
   (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X +·µ¢ Y) i) =&gt;
    {|
      _observe :=
        <span class="kr">match</span> r <span class="kr">with</span>
        | inl x =&gt; TauF (iter f i x)
        | inr y =&gt; RetF y
        <span class="kr">end</span>
    |}))
  (f i x &gt;&gt;=
   (<span class="kr">fun</span> (<span class="nv">i</span> : I) (<span class="nv">r</span> : (X +·µ¢ Y) i) =&gt;
    <span class="kr">match</span> r <span class="kr">with</span>
    | inl x =&gt; iter f i x
    | inr y =&gt; Ret&#39; y
    <span class="kr">end</span>))</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><input class="alectryon-toggle" id="properties-v-chkeb" style="display: none" type="checkbox"><label class="alectryon-input" for="properties-v-chkeb"><span class="nb">econstructor</span>; <span class="nb">eauto</span>; <span class="nb">intros</span> ?? [] -&gt;; <span class="nb">auto</span>.</label><small class="alectryon-output"><div><div class="alectryon-goals"><blockquote class="alectryon-goal"><div class="goal-hyps"><span><var>I</var><span class="hyp-type"><b>: </b><span><span class="kt">Type</span></span></span></span><br><span><var>E</var><span class="hyp-type"><b>: </b><span>event I I</span></span></span><br><span><var>X, Y</var><span class="hyp-type"><b>: </b><span>psh I</span></span></span><br><span><var>f</var><span class="hyp-type"><b>: </b><span>X ‚áí·µ¢ itree E (X +·µ¢ Y)</span></span></span><br><span><var>i</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x</var><span class="hyp-type"><b>: </b><span>X i</span></span></span><br><span><var>i0</var><span class="hyp-type"><b>: </b><span>I</span></span></span><br><span><var>x0</var><span class="hyp-type"><b>: </b><span>X i0</span></span></span><br></div><span class="goal-separator"><hr></span><div class="goal-conclusion">it_wbisim_t E (eq·µ¢ Y) bot i0 (Tau&#39; (iter f i0 x0))
  (iter f i0 x0)</div></blockquote></div></div></small><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">    </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="bp">exact</span> (skip_tau _).</span><span class="alectryon-wsp">
</span></span><span class="alectryon-wsp">  </span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Qed</span>.</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">End</span> <span class="nf">withE</span>.</span></span></pre><p>Misc. utilities.</p>
<pre class="alectryon-io highlight"><!-- Generator: Alectryon --><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Variant</span> <span class="nf">is_tau&#39;</span> {<span class="nv">I</span>} {<span class="nv">E</span> : event I I} {<span class="nv">X</span> <span class="nv">i</span>} : itree&#39; E X i -&gt; <span class="kt">Prop</span> :=
  | IsTau {t : itree E X i} : is_tau&#39; (TauF t) .</span><span class="alectryon-wsp">
</span></span><span class="alectryon-sentence"><span class="alectryon-input"><span class="kn">Definition</span> <span class="nf">is_tau</span> {<span class="nv">I</span>} {<span class="nv">E</span> : event I I} {<span class="nv">X</span> <span class="nv">i</span>} (<span class="nv">t</span> : itree E X i) : <span class="kt">Prop</span> := is_tau&#39; t.(_observe).</span></span></pre>
</div>
</div></body>
</html>
